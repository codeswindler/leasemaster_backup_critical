import{a as le,b as ce,d as N,f as E,j as e,T as u,x as o,P as de,C as k,G as U,I as $,S as v,r as y,s as f,v as w,w as t,z as me,A as oe,E as xe,L as B,ac as he,ad as ue,ae as H,af as d,ag as je,ah as m,ay as pe,H as ge,aC as K,au as O,D as V,g as G,h as _,i as z,k as Q,K as l,ak as Ne,a5 as ve,a6 as ye,B as fe,a4 as we,a0 as x,q as W,y as c}from"./index-BtknkMaH.js";import{r as h}from"./vendor-Dl_IvdXv.js";import{M as X}from"./map-pin-BiMmByZC.js";import{C as Ce}from"./circle-x-Qbe_jolQ.js";function Te(){const[j,J]=h.useState(""),[C,Y]=h.useState("all"),[S,Z]=h.useState("all"),[a,ee]=h.useState(null),[se,P]=h.useState(!1),[ae,p]=h.useState(!1),{toast:g}=le(),{selectedPropertyId:i,selectedLandlordId:r}=ce(),{data:T=[],isLoading:te,error:R}=N({queryKey:["/api/maintenance-requests",i,r],queryFn:async()=>{const s=new URLSearchParams;i&&s.append("propertyId",i),r&&s.append("landlordId",r);const n=`/api/maintenance-requests${s.toString()?`?${s}`:""}`;return await x("GET",n)}}),{data:D=[]}=N({queryKey:["/api/tenants",i,r],queryFn:async()=>{const s=new URLSearchParams;i&&s.append("propertyId",i),r&&s.append("landlordId",r);const n=`/api/tenants${s.toString()?`?${s}`:""}`;return await x("GET",n)}});N({queryKey:["/api/properties",r,i],queryFn:async()=>{const s=new URLSearchParams;r&&s.append("landlordId",r),i&&s.append("propertyId",i);const n=`/api/properties${s.toString()?`?${s}`:""}`;return await x("GET",n)}}),N({queryKey:["/api/units",i,r],queryFn:async()=>{const s=new URLSearchParams;i&&s.append("propertyId",i),r&&s.append("landlordId",r);const n=`/api/units${s.toString()?`?${s}`:""}`;return await x("GET",n)}});const q=E({mutationFn:({id:s,status:n})=>x("PUT",`/api/maintenance-requests/${s}`,{status:n}),onSuccess:()=>{W.invalidateQueries({queryKey:["/api/maintenance-requests"]}),g({title:"Status Updated",description:"Maintenance request status has been updated successfully."})},onError:s=>{g({title:"Error",description:s.message||"Failed to update status",variant:"destructive"})}}),b=E({mutationFn:s=>x("POST","/api/maintenance-requests",s),onSuccess:()=>{W.invalidateQueries({queryKey:["/api/maintenance-requests"]}),p(!1),g({title:"Request Added",description:"Maintenance request has been added successfully."})},onError:s=>{g({title:"Error",description:s.message||"Failed to add request",variant:"destructive"})}}),L=Array.isArray(T)?T.filter(s=>{const n=s.title?.toLowerCase().includes(j.toLowerCase())||s.description?.toLowerCase().includes(j.toLowerCase())||s.tenantName?.toLowerCase().includes(j.toLowerCase()),ie=C==="all"||s.status===C,re=S==="all"||s.priority===S;return n&&ie&&re}):[],A=(s,n)=>{q.mutate({id:s,status:n})},ne=s=>{b.mutate(s)},F=s=>{switch(s){case"completed":return e.jsx(O,{className:"h-4 w-4 text-green-500"});case"in_progress":return e.jsx(K,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(u,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(Ce,{className:"h-4 w-4 text-red-500"});default:return e.jsx(u,{className:"h-4 w-4 text-gray-500"})}},I=s=>{switch(s){case"completed":return e.jsx(c,{variant:"default",className:"bg-green-500",children:"Completed"});case"in_progress":return e.jsx(c,{variant:"secondary",className:"bg-blue-500 text-white",children:"In Progress"});case"pending":return e.jsx(c,{variant:"outline",className:"bg-yellow-500 text-white",children:"Pending"});case"cancelled":return e.jsx(c,{variant:"destructive",children:"Cancelled"});default:return e.jsx(c,{variant:"outline",children:"Unknown"})}},M=s=>{switch(s){case"urgent":return e.jsx(c,{variant:"destructive",children:"Urgent"});case"high":return e.jsx(c,{variant:"outline",className:"bg-orange-500 text-white",children:"High"});case"medium":return e.jsx(c,{variant:"outline",className:"bg-yellow-500 text-white",children:"Medium"});case"low":return e.jsx(c,{variant:"outline",className:"bg-green-500 text-white",children:"Low"});default:return e.jsx(c,{variant:"outline",children:"Normal"})}};return R?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsxs("span",{children:["Error loading maintenance requests: ",R.message]})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"maintenance-title",children:"Maintenance Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage tenant maintenance requests and track progress"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{onClick:()=>p(!0),"data-testid":"button-add-maintenance-request",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Add Request"]})})]}),e.jsx(k,{children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx($,{placeholder:"Search requests by title, description, or tenant...",value:j,onChange:s=>J(s.target.value),className:"max-w-sm"})}),e.jsxs(v,{value:C,onValueChange:Y,children:[e.jsx(y,{className:"w-48",children:e.jsx(f,{placeholder:"Filter by status"})}),e.jsxs(w,{children:[e.jsx(t,{value:"all",children:"All Status"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"in_progress",children:"In Progress"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(v,{value:S,onValueChange:Z,children:[e.jsx(y,{className:"w-48",children:e.jsx(f,{placeholder:"Filter by priority"})}),e.jsxs(w,{children:[e.jsx(t,{value:"all",children:"All Priority"}),e.jsx(t,{value:"urgent",children:"Urgent"}),e.jsx(t,{value:"high",children:"High"}),e.jsx(t,{value:"medium",children:"Medium"}),e.jsx(t,{value:"low",children:"Low"})]})]})]})})}),e.jsxs(k,{children:[e.jsxs(me,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Maintenance Requests"]}),e.jsxs(xe,{children:[L.length," request(s) found"]})]}),e.jsx(U,{children:te?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(B,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading requests..."})]}):e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(H,{children:[e.jsx(d,{children:"Request"}),e.jsx(d,{children:"Tenant"}),e.jsx(d,{children:"Property/Unit"}),e.jsx(d,{children:"Priority"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Date"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(je,{children:L.map(s=>e.jsxs(H,{children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-xs",children:s.description})]})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.tenantName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.tenantPhone})]})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.propertyName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.unitNumber})]})}),e.jsx(m,{children:M(s.priority)}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[F(s.status),I(s.status)]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.createdAt).toLocaleDateString()]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{ee(s),P(!0)},children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"View"]}),s.status==="pending"&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>A(s.id,"in_progress"),disabled:q.isPending,children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Start"]}),s.status==="in_progress"&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>A(s.id,"completed"),disabled:q.isPending,children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Complete"]})]})})]},s.id))})]})})]}),e.jsx(V,{open:se,onOpenChange:P,children:e.jsxs(G,{className:"max-w-2xl",children:[e.jsxs(_,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"Maintenance Request Details"]}),e.jsx(Q,{children:"Complete information about the maintenance request"})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Request Title"}),e.jsx("p",{className:"text-sm",children:a.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Priority"}),e.jsx("div",{children:M(a.priority)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[F(a.status),I(a.status)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Date Reported"}),e.jsx("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Tenant Information"}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a.tenantName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.tenantPhone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.tenantEmail})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Property Details"}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a.propertyName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.unitNumber})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.propertyAddress})]})]})]})]}),a.notes&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Additional Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]})]})]})}),e.jsx(V,{open:ae,onOpenChange:p,children:e.jsxs(G,{className:"max-w-md",children:[e.jsxs(_,{children:[e.jsx(z,{children:"Add Maintenance Request"}),e.jsx(Q,{children:"Create a new maintenance request for a tenant"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"request-title",children:"Request Title"}),e.jsx($,{id:"request-title",placeholder:"e.g., Water Leak in Kitchen"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"request-description",children:"Description"}),e.jsx(we,{id:"request-description",placeholder:"Detailed description of the issue...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"request-priority",children:"Priority"}),e.jsxs(v,{children:[e.jsx(y,{id:"request-priority",children:e.jsx(f,{placeholder:"Select priority"})}),e.jsxs(w,{children:[e.jsx(t,{value:"urgent",children:"Urgent"}),e.jsx(t,{value:"high",children:"High"}),e.jsx(t,{value:"medium",children:"Medium"}),e.jsx(t,{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"request-tenant",children:"Tenant"}),e.jsxs(v,{children:[e.jsx(y,{id:"request-tenant",children:e.jsx(f,{placeholder:"Select tenant"})}),e.jsx(w,{children:Array.isArray(D)?D.map(s=>e.jsx(t,{value:s.id,children:s.fullName},s.id)):null})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(o,{onClick:()=>ne({}),disabled:b.isPending,children:[b.isPending&&e.jsx(B,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Request"]})]})]})]})})]})}export{Te as MaintenanceRequests};

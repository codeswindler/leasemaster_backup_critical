import{a as W,d as Y,f as B,j as e,D as J,a3 as X,x as i,P as Z,g as _,h as ee,i as se,k as te,K as l,I as o,S as u,r as m,s as x,v as j,w as t,a4 as ae,C as b,G as S,z as k,A as T,E as F,ac as ne,ad as le,ae as L,af as r,ag as ie,ah as d,H as re,am as de,au as p,q as A,y as g,aj as ce,T as oe,aC as he,a0 as ue}from"./index-BtknkMaH.js";import{r as c}from"./vendor-Dl_IvdXv.js";function be(){const{toast:v}=W(),[h,I]=c.useState(""),[f,w]=c.useState("all"),[E,y]=c.useState(!1),[me,O]=c.useState(!1),[xe,K]=c.useState(!1),[je,C]=c.useState(!1),[pe,N]=c.useState(null),[ge,D]=c.useState({billId:"",amount:"",method:"mpesa",reference:""}),{data:a=[],isLoading:ve,error:fe}=Y({queryKey:["/api/bills"],queryFn:()=>ue("GET","/api/bills")});B({mutationFn:async s=>Promise.resolve({id:`PAY-${Date.now()}`,billId:s.billId,amount:s.amount,method:s.method,reference:s.reference,status:"completed",timestamp:new Date().toISOString()}),onSuccess:s=>{v({title:"Payment Successful",description:`Payment of KSh ${s.amount.toLocaleString()} has been processed successfully.`}),C(!1),D({billId:"",amount:"",method:"mpesa",reference:""}),A.invalidateQueries({queryKey:["/api/bills"]})},onError:s=>{v({title:"Payment Failed",description:s.message||"Failed to process payment",variant:"destructive"})}});const q=B({mutationFn:async({billId:s,status:n})=>Promise.resolve({id:s,status:n}),onSuccess:s=>{v({title:"Bill Updated",description:`Bill status updated to ${s.status}`}),A.invalidateQueries({queryKey:["/api/bills"]})},onError:s=>{v({title:"Update Failed",description:s.message||"Failed to update bill status",variant:"destructive"})}}),M=s=>{N(s),O(!0)},V=s=>{N(s),K(!0)},$=s=>{N(s),D({billId:s.id,amount:s.amount.toString(),method:"mpesa",reference:""}),C(!0)},z=s=>{q.mutate({billId:s.id,status:"pending"})},P=a.filter(s=>{const n=s.id.toLowerCase().includes(h.toLowerCase())||s.vendor.toLowerCase().includes(h.toLowerCase())||s.property.toLowerCase().includes(h.toLowerCase())||s.category.toLowerCase().includes(h.toLowerCase()),G=f==="all"||s.status===f;return n&&G}),R=s=>{switch(s){case"draft":return e.jsx(g,{variant:"secondary",children:"Draft"});case"pending":return e.jsx(g,{variant:"outline",children:"Pending"});case"paid":return e.jsx(g,{variant:"default",className:"bg-green-100 text-green-800",children:"Paid"});case"overdue":return e.jsx(g,{variant:"destructive",children:"Overdue"});default:return e.jsx(g,{variant:"outline",children:"Unknown"})}},H=s=>{switch(s){case"paid":return e.jsx(p,{className:"h-4 w-4 text-green-500"});case"pending":return e.jsx(he,{className:"h-4 w-4 text-blue-500"});case"overdue":return e.jsx(oe,{className:"h-4 w-4 text-red-500"});default:return e.jsx(ce,{className:"h-4 w-4 text-gray-500"})}},Q=()=>{console.log("Add bill form submitted"),y(!1)},U={all:a.length,draft:a.filter(s=>s.status==="draft").length,pending:a.filter(s=>s.status==="pending").length,paid:a.filter(s=>s.status==="paid").length,overdue:a.filter(s=>s.status==="overdue").length};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"bills-title",children:"Bills"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage property expenses and vendor bills"})]}),e.jsxs(J,{open:E,onOpenChange:y,children:[e.jsx(X,{asChild:!0,children:e.jsxs(i,{"data-testid":"button-add-bill",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add Bill"]})}),e.jsxs(_,{className:"sm:max-w-[500px]",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Add New Bill"}),e.jsx(te,{children:"Enter bill details to track property expenses."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"vendor",children:"Vendor Name"}),e.jsx(o,{id:"vendor",placeholder:"e.g., Kenya Power & Lighting","data-testid":"input-vendor"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"property",children:"Property"}),e.jsxs(u,{children:[e.jsx(m,{"data-testid":"select-property",children:e.jsx(x,{placeholder:"Select property"})}),e.jsxs(j,{children:[e.jsx(t,{value:"all",children:"All Properties"}),e.jsx(t,{value:"bigrock",children:"BigRock Apartments"}),e.jsx(t,{value:"riverside",children:"Riverside Complex"}),e.jsx(t,{value:"garden",children:"Garden View Estates"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"category",children:"Category"}),e.jsxs(u,{children:[e.jsx(m,{"data-testid":"select-category",children:e.jsx(x,{placeholder:"Select category"})}),e.jsxs(j,{children:[e.jsx(t,{value:"electricity",children:"Electricity"}),e.jsx(t,{value:"water",children:"Water"}),e.jsx(t,{value:"security",children:"Security"}),e.jsx(t,{value:"maintenance",children:"Maintenance"}),e.jsx(t,{value:"cleaning",children:"Cleaning"}),e.jsx(t,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"amount",children:"Amount"}),e.jsx(o,{id:"amount",type:"number",placeholder:"Enter bill amount","data-testid":"input-amount"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"due-date",children:"Due Date"}),e.jsx(o,{id:"due-date",type:"date","data-testid":"input-due-date"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"account-number",children:"Account Number"}),e.jsx(o,{id:"account-number",placeholder:"Vendor account number","data-testid":"input-account-number"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(ae,{id:"description",placeholder:"Bill description or notes",rows:3,"data-testid":"textarea-description"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(i,{onClick:Q,"data-testid":"button-submit-bill",children:"Add Bill"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:Object.entries(U).map(([s,n])=>e.jsx(b,{className:`cursor-pointer hover-elevate ${f===s?"ring-2 ring-primary":""}`,onClick:()=>w(s),children:e.jsxs(S,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:n}),e.jsx("div",{className:"text-sm text-muted-foreground capitalize",children:s==="all"?"Total":s})]})},s))}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(o,{placeholder:"Search bills...",value:h,onChange:s=>I(s.target.value),className:"max-w-sm","data-testid":"input-search-bills"})}),e.jsxs(u,{value:f,onValueChange:w,children:[e.jsx(m,{className:"w-48","data-testid":"select-status-filter",children:e.jsx(x,{placeholder:"Filter by status"})}),e.jsxs(j,{children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"draft",children:"Draft"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"paid",children:"Paid"}),e.jsx(t,{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs(b,{children:[e.jsxs(k,{children:[e.jsx(T,{children:"Bills List"}),e.jsxs(F,{children:["Showing ",P.length," of ",a.length," bills"]})]}),e.jsx(S,{children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(L,{children:[e.jsx(r,{children:"Bill ID"}),e.jsx(r,{children:"Vendor"}),e.jsx(r,{children:"Property"}),e.jsx(r,{children:"Category"}),e.jsx(r,{children:"Amount"}),e.jsx(r,{children:"Due Date"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(ie,{children:P.map(s=>e.jsxs(L,{className:"hover-elevate",children:[e.jsx(d,{className:"font-mono text-sm",children:s.id}),e.jsx(d,{className:"font-medium",children:s.vendor}),e.jsx(d,{children:s.property}),e.jsx(d,{children:s.category}),e.jsxs(d,{className:"font-mono",children:["KSh ",s.amount.toLocaleString()]}),e.jsx(d,{children:new Date(s.dueDate).toLocaleDateString()}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[H(s.status),R(s.status)]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"sm","data-testid":`button-view-${s.id}`,onClick:()=>M(s),children:e.jsx(re,{className:"h-4 w-4"})}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",size:"sm","data-testid":`button-edit-${s.id}`,onClick:()=>V(s),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm","data-testid":`button-confirm-${s.id}`,onClick:()=>z(s),children:e.jsx(p,{className:"h-4 w-4"})})]}),(s.status==="pending"||s.status==="overdue")&&e.jsx(i,{variant:"ghost",size:"sm","data-testid":`button-pay-${s.id}`,onClick:()=>$(s),children:e.jsx(p,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsxs(b,{children:[e.jsxs(k,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5 text-green-500"}),"Make Payment"]}),e.jsx(F,{children:"Settle outstanding bills and expenses"})]}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Payment"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"bill-select",children:"Select Bill"}),e.jsxs(u,{children:[e.jsx(m,{id:"bill-select",children:e.jsx(x,{placeholder:"Choose a bill to pay"})}),e.jsx(j,{children:a.filter(s=>s.status==="pending").map(s=>e.jsxs(t,{value:s.id,children:[s.id," - ",s.vendor," - KSh ",s.amount.toLocaleString()]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment-method",children:"Payment Method"}),e.jsxs(u,{children:[e.jsx(m,{id:"payment-method",children:e.jsx(x,{placeholder:"Select payment method"})}),e.jsxs(j,{children:[e.jsx(t,{value:"mpesa",children:"M-Pesa"}),e.jsx(t,{value:"bank-transfer",children:"Bank Transfer"}),e.jsx(t,{value:"cash",children:"Cash"}),e.jsx(t,{value:"cheque",children:"Cheque"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment-reference",children:"Payment Reference"}),e.jsx(o,{id:"payment-reference",placeholder:"Enter payment reference or transaction ID"})]}),e.jsxs(i,{className:"w-full","data-testid":"button-make-payment",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"Make Payment"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Payment Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Outstanding Bills"}),e.jsxs("span",{className:"font-mono font-semibold",children:["KSh ",a.filter(s=>s.status==="pending").reduce((s,n)=>s+n.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overdue Bills"}),e.jsxs("span",{className:"font-mono font-semibold text-destructive",children:["KSh ",a.filter(s=>s.status==="overdue").reduce((s,n)=>s+n.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Paid This Month"}),e.jsxs("span",{className:"font-mono font-semibold text-green-600 dark:text-green-400",children:["KSh ",a.filter(s=>s.status==="paid").reduce((s,n)=>s+n.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Payment Tips"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsx("li",{children:"• Always verify payment references"}),e.jsx("li",{children:"• Keep receipts for accounting"}),e.jsx("li",{children:"• Update bill status after payment"})]})]})]})]})})]})]})}export{be as Bills};

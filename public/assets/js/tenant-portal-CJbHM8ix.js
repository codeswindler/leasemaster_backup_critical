import{a as ts,d as A,f as De,a0 as M,az as h,j as e,C as m,G as x,z as j,A as p,ai as Te,a5 as as,a6 as ns,B as rs,ah as Pe,ax as is,E as v,L as Z,aa as B,ab as _,ac as u,ad as r,ae as E,af as n,x as N,H as ee,aw as cs,T as K,y as T,aB as ls,D as Ie,g as Ce,h as $e,i as Le,K as b,k as ds,I as qe,a3 as os,S as ms,r as xs,s as us,v as hs,w as O,aA as js,aq as ps}from"./index-D3-Phv8z.js";import{r as P}from"./vendor-BBpupLJz.js";import{P as Ns}from"./progress-RKh4RjZl.js";import{T as gs,a as fs,b as z,c as U}from"./tabs-CPhPIXkL.js";import{M as Re}from"./map-pin-B_2aw_SQ.js";import{D as se}from"./download-BIGyNlOu.js";import{C as ys}from"./circle-x-WQ2m2kCb.js";function Is(){const[Ae,Me]=P.useState("invoices"),[g,Fe]=P.useState(null),[Ke,te]=P.useState(!1),[ke,k]=P.useState(!1),[V,ae]=P.useState(""),[G,ne]=P.useState(""),[re,ie]=P.useState("medium"),[H,Y]=P.useState([]),{toast:F}=ts(),{data:Be}=A({queryKey:["/api/auth/tenant-check"],queryFn:async()=>{const s=await fetch("/api/auth/tenant-check",{credentials:"include"});if(s.status===401)return null;if(!s.ok){const t=await s.text();throw new Error(t||"Failed to load tenant session")}return await s.json()},retry:!1}),i=Be?.tenant??null,d=i?.id||null,c={name:i?.full_name??i?.fullName??"Tenant",phone:i?.phone??"—",email:i?.email??"—",property:i?.property_name??i?.propertyName??"—",unit:i?.unit_number??i?.unitNumber??"—",address:i?.property_address??i?.propertyAddress??"—",accountPrefix:i?.account_prefix??i?.accountPrefix??""},_e=c.accountPrefix&&c.unit&&c.unit!=="—"?`${c.accountPrefix}${c.unit}`:"—",{data:ce=[]}=A({queryKey:["/api/leases",d],queryFn:async()=>await(await M("GET",`/api/leases?tenantId=${d}`)).json(),enabled:!!d}),C=Array.isArray(ce)?ce.map(s=>s.id).filter(Boolean):[],le=i?.property_id??i?.propertyId??null,de=i?.unit_id??i?.unitId??null,{data:oe=[],isLoading:Ee}=A({queryKey:[`/api/maintenance-requests/tenant/${d}`],queryFn:async()=>await(await M("GET",`/api/maintenance-requests/tenant/${d}`)).json(),enabled:!!d}),W=De({mutationFn:async()=>{const s=new FormData;s.append("title",V),s.append("description",G),s.append("priority",re),le&&s.append("propertyId",le),de&&s.append("unitId",de),H.forEach(a=>s.append("media[]",a));const t=await fetch("/api/maintenance-requests",{method:"POST",body:s,credentials:"include"});if(!t.ok){const a=await t.text();throw new Error(a||"Failed to submit request")}return await t.json()},onSuccess:()=>{F({title:"Request submitted"}),k(!1),ae(""),ne(""),ie("medium"),Y([])},onError:s=>{F({title:"Submit failed",description:s.message||"Unable to submit maintenance request.",variant:"destructive"})}}),Oe=s=>{const t=Array.from(s.target.files||[]);if(!t.length)return;if(t.reduce((D,R)=>D+R.size,0)>5*1024*1024){F({title:"Files too large",description:"Maintenance uploads must be 5MB or less.",variant:"destructive"});return}Y(t)},ze=s=>{Y(t=>t.filter((a,D)=>D!==s))},{data:me=[],isLoading:Ue}=A({queryKey:["tenant-invoices",d,C.join(",")],queryFn:async()=>C.length?(await Promise.all(C.map(async t=>await(await M("GET",`/api/invoices?leaseId=${t}`)).json()))).flat():[],enabled:!!d}),{data:xe=[]}=A({queryKey:["/api/invoice-items",d],queryFn:async()=>await(await M("GET","/api/invoice-items")).json(),enabled:!!d}),{data:ue=[],isLoading:Ve}=A({queryKey:["tenant-payments",d,C.join(",")],queryFn:async()=>C.length?(await Promise.all(C.map(async t=>await(await M("GET",`/api/payments?leaseId=${t}`)).json()))).flat():[],enabled:!!d}),f=Array.isArray(ue)?ue.map(s=>({id:s.id,invoiceId:s.invoiceId??s.invoice_id??null,receiptNumber:s.reference??s.reference_number??s.id,paymentDate:s.paymentDate??s.payment_date,amount:s.amount??0,paymentMethod:s.paymentMethod??s.payment_method??"—"})):[],Ge=f.reduce((s,t)=>{if(!t.invoiceId)return s;const a=Number(t.amount)||0;return s[t.invoiceId]=(s[t.invoiceId]||0)+a,s},{}),w=Array.isArray(me)?me.map(s=>{const t=Number(s.amount??s.total_amount??0),a=Number(Ge[s.id]??0),D=Math.max(0,t-a),R=D<=0&&t>0?"paid":a>0?"partially_paid":"pending";return{id:s.id,invoiceNumber:s.invoiceNumber??s.invoice_number??s.id,description:s.description??s.itemDescription??s.item_description??"Invoice",amount:t,paidAmount:a,balance:D,dueDate:s.dueDate??s.due_date??s.issueDate??s.issue_date,status:R}}):[],he=Array.isArray(xe)?xe:[],He=he.reduce((s,t)=>{const a=t.invoiceId??t.invoice_id;return a&&(s[a]=s[a]||[],s[a].push({description:t.description??t.itemDescription??t.item_description??"Invoice item",amount:Number(t.amount??0)})),s},{}),$=w.reduce((s,t)=>{const a=Number(t.amount)||0;return s+a},0),L=f.reduce((s,t)=>{const a=Number(t.amount)||0;return s+a},0),Ye=$-L,je=new Date,We=f.reduce((s,t)=>{if(!t.paymentDate)return s;const a=new Date(t.paymentDate);return a.getMonth()===je.getMonth()&&a.getFullYear()===je.getFullYear()?s+(Number(t.amount)||0):s},0),pe=f.filter(s=>s.paymentDate).sort((s,t)=>new Date(t.paymentDate).getTime()-new Date(s.paymentDate).getTime())[0],I=w.filter(s=>s.dueDate).sort((s,t)=>new Date(t.dueDate).getTime()-new Date(s.dueDate).getTime())[0],q=f.filter(s=>s.paymentDate).sort((s,t)=>new Date(t.paymentDate).getTime()-new Date(s.paymentDate).getTime())[0],Je=$>0?Math.min(100,Math.round(L/$*100)):0,Ne=f.reduce((s,t)=>{const a=t.paymentMethod||"Other";return s[a]=(s[a]||0)+1,s},{}),ge=he.reduce((s,t)=>{const a=t.description??"Invoice item";return s[a]=(s[a]||0)+Number(t.amount||0),s},{}),fe=De({mutationFn:async s=>{const t=String(c.phone||"").replace(/\s+/g,"");if(!t||t==="—")throw new Error("Tenant phone number is missing.");const a=Number(s.balance??s.amount??0);if(!a||a<=0)throw new Error("Invoice balance is already cleared.");return await(await M("POST","/api/mpesa/stk-push",{invoiceId:s.id,amount:a,phone:t})).json()},onSuccess:()=>{F({title:"STK Push sent",description:"Check your phone to complete the payment."})},onError:s=>{F({title:"STK Push failed",description:s?.message||"Please try again.",variant:"destructive"})}}),ye=w.length,Qe=w.filter(s=>s.status==="pending").length,Xe=w.filter(s=>s.status==="partially_paid").length,Ze=w.filter(s=>s.status==="paid").length,es=f.length,J=Math.max(0,$-L),l=[h(0),h(1),h(2),h(3),h(4)],S=[h(1),h(2),h(3)],o=[h(2),h(4),h(0)],Q=[...w.flatMap(s=>{const t=He[s.id]||[];return t.length===0?[{date:s.dueDate||"",type:"Invoice",description:s.description||"Invoice",debit:Number(s.amount)||0,credit:0}]:t.map(a=>({date:s.dueDate||"",type:"Invoice",description:`${s.invoiceNumber} • ${a.description}`,debit:Number(a.amount)||0,credit:0}))}),...f.map(s=>({date:s.paymentDate||"",type:"Payment",description:s.paymentMethod||"Payment",debit:0,credit:Number(s.amount)||0}))].sort((s,t)=>new Date(t.date).getTime()-new Date(s.date).getTime()),ss=()=>{const s=["Date","Type","Description","Debit","Credit"],t=Q.map(y=>[y.date?new Date(y.date).toLocaleDateString():"",y.type,y.description,y.debit?y.debit.toFixed(2):"",y.credit?y.credit.toFixed(2):""]),a=[s,...t].map(y=>y.join(",")).join(`
`),D=new Blob([a],{type:"text/csv;charset=utf-8;"}),R=URL.createObjectURL(D),X=document.createElement("a");X.href=R,X.download="tenant-statement.csv",X.click(),URL.revokeObjectURL(R)},ve=s=>{const t=s?.mediaUrls??s?.media_urls;if(!t)return[];if(Array.isArray(t))return t;try{const a=JSON.parse(t);return Array.isArray(a)?a:[]}catch{return[]}},be=s=>{switch(s){case"completed":return e.jsx(ps,{className:"h-4 w-4 text-green-500"});case"in_progress":return e.jsx(js,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(K,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(ys,{className:"h-4 w-4 text-red-500"});default:return e.jsx(K,{className:"h-4 w-4 text-gray-500"})}},we=s=>{switch(s){case"completed":return e.jsx(T,{variant:"default",className:"bg-green-500",children:"Completed"});case"in_progress":return e.jsx(T,{variant:"secondary",className:"bg-blue-500 text-white",children:"In Progress"});case"pending":return e.jsx(T,{variant:"outline",className:"bg-yellow-500 text-white",children:"Pending"});case"cancelled":return e.jsx(T,{variant:"destructive",children:"Cancelled"});default:return e.jsx(T,{variant:"outline",children:"Unknown"})}},Se=s=>{const t=(s||"").toLowerCase();return t==="paid"?e.jsx(T,{variant:"default",className:"bg-green-500",children:"Paid"}):t==="partially_paid"?e.jsx(T,{variant:"outline",className:"bg-blue-500 text-white",children:"Partially Paid"}):e.jsx(T,{variant:"outline",className:"bg-yellow-500 text-white",children:"Pending"})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tenant Portal"}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome back, ",c.name]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Property"}),e.jsxs("div",{className:"font-semibold",children:[c.property," - ",c.unit]})]})]}),!d&&e.jsx(m,{children:e.jsx(x,{className:"p-4 text-sm text-muted-foreground",children:"Tenant access is not configured yet. Please log in from the tenant portal or contact your property manager to activate your account."})}),e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Your Information"]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Name"})]}),e.jsx("p",{className:"text-sm",children:c.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Phone"})]}),e.jsx("p",{className:"text-sm",children:c.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Email"})]}),e.jsx("p",{className:"text-sm",children:c.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Property"})]}),e.jsx("p",{className:"text-sm",children:c.property})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Unit"})]}),e.jsx("p",{className:"text-sm",children:c.unit})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Address"})]}),e.jsx("p",{className:"text-sm",children:c.address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Account Number"})]}),e.jsx("p",{className:"text-sm",children:_e})]})]})})]}),e.jsxs(gs,{value:Ae,onValueChange:Me,className:"space-y-4",children:[e.jsxs(fs,{className:"grid w-full grid-cols-4",children:[e.jsx(z,{value:"invoices",children:"Invoices"}),e.jsx(z,{value:"receipts",children:"Receipts"}),e.jsx(z,{value:"statements",children:"Statements"}),e.jsx(z,{value:"maintenance",children:"Maintenance"})]}),e.jsx(U,{value:"invoices",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5"}),"Invoices"]}),e.jsx(v,{children:"Your rent and utility invoices"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:`p-4 rounded-lg border ${l[0].card} ${l[0].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Invoiced"}),e.jsxs("div",{className:`text-2xl font-bold ${l[0].accentText}`,children:["KSh ",$.toLocaleString()]})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${l[1].card} ${l[1].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Invoices"}),e.jsx("div",{className:`text-2xl font-bold ${l[1].accentText}`,children:ye})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${l[2].card} ${l[2].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Paid"}),e.jsx("div",{className:`text-2xl font-bold ${l[2].accentText}`,children:Ze})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${l[3].card} ${l[3].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Partially Paid"}),e.jsx("div",{className:`text-2xl font-bold ${l[3].accentText}`,children:Xe})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${l[4].card} ${l[4].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pending"}),e.jsx("div",{className:`text-2xl font-bold ${l[4].accentText}`,children:Qe})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs(m,{className:"border bg-card/80",children:[e.jsxs(j,{children:[e.jsx(p,{className:"text-base",children:"Latest Invoice"}),e.jsx(v,{children:"Most recent invoice issued"})]}),e.jsx(x,{className:"space-y-2 text-sm",children:I?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Invoice"}),e.jsx("span",{className:"font-medium",children:I.invoiceNumber})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount"}),e.jsxs("span",{className:"font-mono",children:["KSh ",Number(I.amount).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Balance"}),e.jsxs("span",{className:"font-mono",children:["KSh ",Number(I.balance).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Due"}),e.jsx("span",{children:I.dueDate?new Date(I.dueDate).toLocaleDateString():"—"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status"}),Se(I.status)]})]}):e.jsx("div",{className:"text-muted-foreground",children:"No invoices yet."})})]}),e.jsxs(m,{className:"border bg-card/80",children:[e.jsxs(j,{children:[e.jsx(p,{className:"text-base",children:"Payment Progress"}),e.jsx(v,{children:"Collected vs invoiced"})]}),e.jsxs(x,{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Collected"}),e.jsxs("span",{className:"font-mono",children:["KSh ",L.toLocaleString()]})]}),e.jsx(Ns,{value:Je}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Outstanding"}),e.jsxs("span",{className:"font-mono",children:["KSh ",J.toLocaleString()]})]})]})]})]}),Ue?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Z,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading invoices..."})]}):e.jsxs(B,{children:[e.jsx(_,{children:e.jsxs(u,{children:[e.jsx(r,{children:"Invoice #"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Amount"}),e.jsx(r,{children:"Balance"}),e.jsx(r,{children:"Due Date"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(E,{children:Array.isArray(w)?w.map(s=>e.jsxs(u,{children:[e.jsx(n,{className:"font-mono text-sm",children:s.invoiceNumber}),e.jsx(n,{children:s.description}),e.jsxs(n,{className:"font-mono",children:["KSh ",parseFloat(s.amount).toLocaleString()]}),e.jsxs(n,{className:"font-mono",children:["KSh ",parseFloat(s.balance).toLocaleString()]}),e.jsx(n,{children:new Date(s.dueDate).toLocaleDateString()}),e.jsx(n,{children:Se(s.status)}),e.jsx(n,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"View"]}),Number(s.balance??0)>0&&e.jsx(N,{variant:"default",size:"sm",onClick:()=>fe.mutate(s),disabled:fe.isPending,children:"Pay Now"}),e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),"Download"]})]})})]},s.id)):e.jsx(u,{children:e.jsx(n,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No invoices found"})})})]})]})]})}),e.jsx(U,{value:"receipts",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5"}),"Payment Receipts"]}),e.jsx(v,{children:"Your payment confirmations and receipts"})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:`p-4 rounded-lg border ${S[0].card} ${S[0].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Paid"}),e.jsxs("div",{className:`text-2xl font-bold ${S[0].accentText}`,children:["KSh ",L.toLocaleString()]})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${S[1].card} ${S[1].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Receipts"}),e.jsx("div",{className:`text-2xl font-bold ${S[1].accentText}`,children:es})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${S[2].card} ${S[2].border}`,children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Outstanding"}),e.jsxs("div",{className:`text-2xl font-bold ${S[2].accentText}`,children:["KSh ",J.toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs(m,{className:"border bg-card/80",children:[e.jsxs(j,{children:[e.jsx(p,{className:"text-base",children:"Latest Receipt"}),e.jsx(v,{children:"Most recent payment record"})]}),e.jsx(x,{className:"space-y-2 text-sm",children:q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Receipt"}),e.jsx("span",{className:"font-medium",children:q.receiptNumber})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount"}),e.jsxs("span",{className:"font-mono",children:["KSh ",Number(q.amount).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Method"}),e.jsx("span",{children:q.paymentMethod})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date"}),e.jsx("span",{children:q.paymentDate?new Date(q.paymentDate).toLocaleDateString():"—"})]})]}):e.jsx("div",{className:"text-muted-foreground",children:"No receipts yet."})})]}),e.jsxs(m,{className:"border bg-card/80",children:[e.jsxs(j,{children:[e.jsx(p,{className:"text-base",children:"Payment Methods"}),e.jsx(v,{children:"Distribution of receipts"})]}),e.jsx(x,{className:"space-y-2 text-sm",children:Object.keys(Ne).length?Object.entries(Ne).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s}),e.jsx("span",{className:"font-medium",children:t})]},s)):e.jsx("div",{className:"text-muted-foreground",children:"No payment methods yet."})})]})]}),Ve?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Z,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading receipts..."})]}):e.jsxs(B,{children:[e.jsx(_,{children:e.jsxs(u,{children:[e.jsx(r,{children:"Receipt #"}),e.jsx(r,{children:"Payment Date"}),e.jsx(r,{children:"Amount"}),e.jsx(r,{children:"Method"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(E,{children:Array.isArray(f)?f.map(s=>e.jsxs(u,{children:[e.jsx(n,{className:"font-mono text-sm",children:s.receiptNumber}),e.jsx(n,{children:new Date(s.paymentDate).toLocaleDateString()}),e.jsxs(n,{className:"font-mono",children:["KSh ",parseFloat(s.amount).toLocaleString()]}),e.jsx(n,{children:s.paymentMethod}),e.jsx(n,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"View"]}),e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),"Download"]})]})})]},s.id)):e.jsx(u,{children:e.jsx(n,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No receipts found"})})})]})]})]})}),e.jsx(U,{value:"statements",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),"Account Statements"]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:ss,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsx(v,{children:"Your account balance and transaction history"})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border ${o[0].card} ${o[0].border}`,children:[e.jsx("div",{className:`text-sm ${o[0].accentText}`,children:"Current Balance"}),e.jsxs("div",{className:`text-2xl font-bold ${o[0].accentText}`,children:["KSh ",Ye.toLocaleString()]})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${o[1].card} ${o[1].border}`,children:[e.jsx("div",{className:`text-sm ${o[1].accentText}`,children:"This Month"}),e.jsxs("div",{className:`text-2xl font-bold ${o[1].accentText}`,children:["KSh ",We.toLocaleString()]})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${o[2].card} ${o[2].border}`,children:[e.jsx("div",{className:`text-sm ${o[2].accentText}`,children:"Last Payment"}),e.jsx("div",{className:`text-2xl font-bold ${o[2].accentText}`,children:pe?`KSh ${Number(pe.amount||0).toLocaleString()}`:"—"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(m,{className:"border bg-card/80",children:[e.jsxs(j,{children:[e.jsx(p,{className:"text-base",children:"Invoice Breakdown"}),e.jsx(v,{children:"Charges by category"})]}),e.jsx(x,{className:"space-y-2 text-sm",children:Object.keys(ge).length?Object.entries(ge).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s}),e.jsxs("span",{className:"font-mono",children:["KSh ",Number(t).toLocaleString()]})]},s)):e.jsx("div",{className:"text-muted-foreground",children:"No invoice items yet."})})]}),e.jsxs(m,{className:"border bg-card/80",children:[e.jsxs(j,{children:[e.jsx(p,{className:"text-base",children:"Statement Snapshot"}),e.jsx(v,{children:"Totals for this tenant"})]}),e.jsxs(x,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Invoiced"}),e.jsxs("span",{className:"font-mono",children:["KSh ",$.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("span",{className:"font-mono",children:["KSh ",L.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Outstanding"}),e.jsxs("span",{className:"font-mono",children:["KSh ",J.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Invoices"}),e.jsx("span",{className:"font-medium",children:ye})]})]})]})]}),e.jsxs(B,{children:[e.jsx(_,{children:e.jsxs(u,{children:[e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Description"}),e.jsx(r,{className:"text-right",children:"Debit"}),e.jsx(r,{className:"text-right",children:"Credit"})]})}),e.jsx(E,{children:Q.length>0?Q.map((s,t)=>e.jsxs(u,{children:[e.jsx(n,{children:s.date?new Date(s.date).toLocaleDateString():"—"}),e.jsx(n,{children:s.type}),e.jsx(n,{children:s.description}),e.jsx(n,{className:"text-right font-mono",children:s.debit?`KSh ${s.debit.toLocaleString()}`:"—"}),e.jsx(n,{className:"text-right font-mono",children:s.credit?`KSh ${s.credit.toLocaleString()}`:"—"})]},`${s.type}-${t}`)):e.jsx(u,{children:e.jsx(n,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No statement activity yet"})})})]})]})})]})}),e.jsx(U,{value:"maintenance",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Maintenance Requests"]}),e.jsx(v,{children:"Report and track maintenance issues"})]}),e.jsxs(N,{onClick:()=>k(!0),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"New Request"]})]}),e.jsx(x,{children:Ee?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Z,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading requests..."})]}):e.jsxs(B,{children:[e.jsx(_,{children:e.jsxs(u,{children:[e.jsx(r,{children:"Request"}),e.jsx(r,{children:"Priority"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(E,{children:Array.isArray(oe)?oe.map(s=>e.jsxs(u,{children:[e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-xs",children:s.description})]})}),e.jsx(n,{children:e.jsx(T,{variant:s.priority==="urgent"?"destructive":"outline",children:s.priority})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[be(s.status),we(s.status)]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.createdAt).toLocaleDateString()]})}),e.jsx(n,{children:e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{Fe(s),te(!0)},children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"View"]})})]},s.id)):e.jsx(u,{children:e.jsx(n,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No maintenance requests found"})})})]})})]})})]}),e.jsx(Ie,{open:Ke,onOpenChange:te,children:e.jsxs(Ce,{className:"max-w-2xl",children:[e.jsx($e,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Maintenance Request Details"]})}),g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-sm font-medium",children:"Title"}),e.jsx("p",{className:"text-sm",children:g.title})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm font-medium",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[be(g.status),we(g.status)]})]})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm",children:g.description})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-sm font-medium",children:"Date Reported"}),e.jsx("p",{className:"text-sm",children:new Date(g.createdAt).toLocaleDateString()})]}),g.response&&e.jsxs("div",{children:[e.jsx(b,{className:"text-sm font-medium",children:"Response"}),e.jsx("p",{className:"text-sm",children:g.response})]}),ve(g).length>0&&e.jsxs("div",{children:[e.jsx(b,{className:"text-sm font-medium",children:"Attachments"}),e.jsx("div",{className:"space-y-2 text-sm",children:ve(g).map(s=>e.jsx("a",{href:s,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:s.split("/").pop()},s))})]})]})]})}),e.jsx(Ie,{open:ke,onOpenChange:k,children:e.jsxs(Ce,{className:"max-w-md",children:[e.jsxs($e,{children:[e.jsx(Le,{children:"New Maintenance Request"}),e.jsx(ds,{children:"Report a maintenance issue in your unit"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"request-title",children:"Issue Title"}),e.jsx(qe,{id:"request-title",placeholder:"e.g., Water Leak in Kitchen",value:V,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"request-description",children:"Description"}),e.jsx(os,{id:"request-description",placeholder:"Please describe the issue in detail...",rows:4,value:G,onChange:s=>ne(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"request-priority",children:"Priority"}),e.jsxs(ms,{value:re,onValueChange:ie,children:[e.jsx(xs,{id:"request-priority",children:e.jsx(us,{placeholder:"Select priority"})}),e.jsxs(hs,{children:[e.jsx(O,{value:"urgent",children:"Urgent (Emergency)"}),e.jsx(O,{value:"high",children:"High (Needs attention soon)"}),e.jsx(O,{value:"medium",children:"Medium (Can wait a few days)"}),e.jsx(O,{value:"low",children:"Low (Minor issue)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"request-media",children:"Upload Media (max 5MB)"}),e.jsx(qe,{id:"request-media",type:"file",multiple:!0,onChange:Oe,accept:"image/*,video/*"}),H.length>0&&e.jsx("div",{className:"space-y-2 text-sm",children:H.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2",children:[e.jsx("span",{className:"truncate",children:s.name}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>ze(t),children:"Remove"})]},`${s.name}-${t}`))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(N,{onClick:()=>W.mutate(),disabled:!V.trim()||!G.trim()||W.isPending,children:W.isPending?"Submitting...":"Submit Request"})]})]})]})})]})}export{Is as TenantPortal};

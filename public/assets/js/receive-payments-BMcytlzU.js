import{b as V,d as c,j as e,D as z,a3 as H,x as u,P as X,g as Q,h as J,i as W,k as Y,K as o,S as A,r as L,s as $,v as D,w as m,I as F,a4 as Z,C as E,z as K,A as U,E as B,G,a2 as _,a8 as ee,y as se,a0 as p}from"./index-BtknkMaH.js";import{r as d}from"./vendor-Dl_IvdXv.js";function ne(){const[h,f]=d.useState(""),[x,N]=d.useState(""),[j,v]=d.useState(""),[S,b]=d.useState(""),[w,C]=d.useState(""),[k,g]=d.useState(!1),{selectedPropertyId:a,selectedLandlordId:t}=V(),{data:P=[]}=c({queryKey:["/api/tenants",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/tenants${s.toString()?`?${s}`:""}`;return await(await p("GET",n)).json()}}),{data:I=[]}=c({queryKey:["/api/units",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/units${s.toString()?`?${s}`:""}`;return await(await p("GET",n)).json()}}),{data:R=[]}=c({queryKey:["/api/properties",t,a],queryFn:async()=>{const s=new URLSearchParams;t&&s.append("landlordId",t),a&&s.append("propertyId",a);const n=`/api/properties${s.toString()?`?${s}`:""}`;return await(await p("GET",n)).json()}}),{data:T=[]}=c({queryKey:["/api/leases",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/leases${s.toString()?`?${s}`:""}`;return await(await p("GET",n)).json()}}),y=Array.isArray(P)?P.map(s=>{const n=Array.isArray(T)?T.find(i=>i.tenantId===s.id&&i.status==="active"):null,r=Array.isArray(I)?I.find(i=>i.id===n?.unitId):null,q=Array.isArray(R)?R.find(i=>i.id===r?.propertyId):null;return{id:s.id,name:s.fullName,unit:r?.unitNumber||"No unit",property:q?.name||"No property",balance:0,accountNumber:`${q?.name?.substring(0,2).toUpperCase()||"XX"}${String(s.id.substring(0,3)).toUpperCase()}`}}).filter(s=>s.name):[],l=y.find(s=>s.id===h),M=()=>{if(!h||!x||!j){alert("Please fill in all required fields");return}console.log("Recording payment:",{tenant:l,amount:parseFloat(x),paymentMethod:j,reference:S,notes:w}),alert("Payment recorded successfully!"),f(""),N(""),v(""),b(""),C(""),g(!1)},{data:O=[]}=c({queryKey:["/api/payments",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/payments${s.toString()?`?${s}`:""}`;return await(await p("GET",n)).json()}});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"receive-payments-title",children:"Receive Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Record tenant payments and manage transactions"})]}),e.jsxs(z,{open:k,onOpenChange:g,children:[e.jsx(H,{asChild:!0,children:e.jsxs(u,{"data-testid":"button-record-payment",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Record Payment"]})}),e.jsxs(Q,{className:"sm:max-w-[500px]",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Record New Payment"}),e.jsx(Y,{children:"Enter payment details to record a tenant payment."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"tenant",children:"Tenant"}),e.jsxs(A,{value:h,onValueChange:f,children:[e.jsx(L,{"data-testid":"select-tenant",children:e.jsx($,{placeholder:"Select tenant"})}),e.jsx(D,{children:y.map(s=>e.jsxs(m,{value:s.id,children:[s.name," - ",s.unit,s.balance>0&&e.jsxs("span",{className:"text-red-600 ml-2",children:["(Balance: KSh ",s.balance.toLocaleString(),")"]})]},s.id))})]})]}),l&&e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Account Number"}),e.jsx("p",{className:"font-mono",children:l.accountNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Outstanding Balance"}),e.jsxs("p",{className:`font-mono ${l.balance>0?"text-red-600":"text-green-600"}`,children:["KSh ",l.balance.toLocaleString()]})]})]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"amount",children:"Amount"}),e.jsx(F,{id:"amount",type:"number",placeholder:"Enter payment amount",value:x,onChange:s=>N(s.target.value),"data-testid":"input-amount"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"payment-method",children:"Payment Method"}),e.jsxs(A,{value:j,onValueChange:v,children:[e.jsx(L,{"data-testid":"select-payment-method",children:e.jsx($,{placeholder:"Select payment method"})}),e.jsxs(D,{children:[e.jsx(m,{value:"mpesa",children:"M-Pesa"}),e.jsx(m,{value:"bank",children:"Bank Transfer"}),e.jsx(m,{value:"cash",children:"Cash"}),e.jsx(m,{value:"cheque",children:"Cheque"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"reference",children:"Reference Number"}),e.jsx(F,{id:"reference",placeholder:"Transaction reference (optional)",value:S,onChange:s=>b(s.target.value),"data-testid":"input-reference"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"notes",children:"Notes"}),e.jsx(Z,{id:"notes",placeholder:"Additional notes (optional)",value:w,onChange:s=>C(s.target.value),rows:3,"data-testid":"textarea-notes"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(u,{onClick:M,"data-testid":"button-submit-payment",children:"Record Payment"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsxs(K,{children:[e.jsx(U,{children:"Outstanding Balances"}),e.jsx(B,{children:"Tenants with pending payments"})]}),e.jsx(G,{className:"space-y-4",children:y.filter(s=>s.balance>0).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover-elevate",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.unit," - ",s.property]}),e.jsxs("p",{className:"text-xs font-mono text-muted-foreground",children:["Account: ",s.accountNumber]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-mono text-red-600",children:["KSh ",s.balance.toLocaleString()]}),e.jsx(u,{size:"sm",variant:"outline",className:"mt-1",children:"Record Payment"})]})]},s.id))})]}),e.jsxs(E,{children:[e.jsxs(K,{children:[e.jsx(U,{children:"Recent Payments"}),e.jsx(B,{children:"Latest payment transactions"})]}),e.jsx(G,{className:"space-y-4",children:O.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.method==="M-Pesa"?e.jsx(_,{className:"h-5 w-5 text-green-600"}):e.jsx(ee,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.tenant}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.unit}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.date})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-mono",children:["KSh ",s.amount.toLocaleString()]}),e.jsx(se,{variant:s.status==="verified"?"default":"secondary",className:"text-xs",children:s.status})]})]},s.id))})]})]})]})}export{ne as ReceivePayments};

import{b as v,u as b,d as y,j as e,S as w,r as C,s as S,v as _,w as t,x as L,C as R,z as T,A as k,a6 as E,E as F,G as P,aC as d,aH as A,au as o,y as a,a0 as B}from"./index-BtknkMaH.js";import{r as M}from"./vendor-Dl_IvdXv.js";import{F as D,R as x}from"./refresh-cw-B_4VM2wj.js";function U(){const{selectedPropertyId:r}=v(),[,m]=b(),[l,u]=M.useState("all"),{data:n=[],isLoading:h,refetch:j}=y({queryKey:["/api/message-recipients","email",r,l],queryFn:async()=>{const s=new URLSearchParams;s.append("channel","email"),r&&s.append("propertyId",r),l!=="all"&&s.append("category",l);const c=`/api/message-recipients?${s.toString()}`;return await(await B("GET",c)).json()}}),p=s=>{switch(s){case"delivered":return e.jsx(o,{className:"h-4 w-4 text-green-500"});case"sent":return e.jsx(o,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(d,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(A,{className:"h-4 w-4 text-red-500"});default:return e.jsx(d,{className:"h-4 w-4 text-gray-500"})}},g=s=>{switch(s){case"delivered":return e.jsx(a,{variant:"default",className:"bg-green-100 text-green-800",children:"Delivered"});case"sent":return e.jsx(a,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Sent"});case"pending":return e.jsx(a,{variant:"secondary",children:"Pending"});case"failed":return e.jsx(a,{variant:"destructive",children:"Failed"});default:return e.jsx(a,{variant:"outline",children:"Unknown"})}},f=s=>{const i={manual:{label:"Manual",variant:"outline"},otp:{label:"OTP",variant:"secondary"},login_credentials:{label:"Login Credentials",variant:"secondary"},password_reset:{label:"Password Reset",variant:"secondary"},welcome_email:{label:"Welcome",variant:"secondary"}}[s]||{label:s,variant:"outline"};return e.jsx(a,{variant:i.variant,children:i.label})},N=s=>s==="landlord"?e.jsx(a,{variant:"outline",className:"bg-purple-50 text-purple-700",children:"Landlord"}):e.jsx(a,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Tenant"});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"email-outbox-title",children:"Email Outbox"}),e.jsx("p",{className:"text-muted-foreground",children:"Track email delivery status and history"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(w,{value:l,onValueChange:u,children:[e.jsx(C,{className:"w-[180px]",children:e.jsx(S,{placeholder:"All Categories"})}),e.jsxs(_,{children:[e.jsx(t,{value:"all",children:"All Categories"}),e.jsx(t,{value:"manual",children:"Manual"}),e.jsx(t,{value:"login_credentials",children:"Login Credentials"}),e.jsx(t,{value:"password_reset",children:"Password Reset"}),e.jsx(t,{value:"welcome_email",children:"Welcome"})]})]})]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>j(),children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsxs(R,{children:[e.jsxs(T,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Email Messages"]}),e.jsxs(F,{children:[n.length," email(s) found"]})]}),e.jsx(P,{children:h?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(x,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No email messages found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Delivery Status"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Recipient"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Category"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Subject"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Sent At"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50 cursor-pointer",onClick:()=>m(`/message-details/${s.id}`),children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[p(s.status),g(s.status)]})}),e.jsx("td",{className:"p-2 text-sm",children:e.jsx("span",{className:"text-muted-foreground text-xs",children:"Not Available"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.recipient_name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.recipient_contact})]})}),e.jsx("td",{className:"p-2",children:N(s.recipient_type)}),e.jsx("td",{className:"p-2",children:f(s.message_category)}),e.jsx("td",{className:"p-2 max-w-xs",children:e.jsx("p",{className:"text-sm truncate",title:s.subject,children:s.subject||"No Subject"})}),e.jsx("td",{className:"p-2 text-sm text-muted-foreground",children:s.sent_at?new Date(s.sent_at).toLocaleString():"Pending"})]},s.id))})]})})})]})]})}export{U as MessagingEmailOutbox};

import{a as me,b as xe,d as v,f as L,j as e,T as j,x as o,P as he,C as H,G as O,I as V,S as y,r as f,s as w,v as C,w as n,z as ue,A as pe,E as je,L as z,aa as ge,ab as Ne,ac as G,ad as m,ae as ve,af as x,aB as ye,H as fe,aA as _,aq as Q,D as W,g as X,h as J,i as Y,k as Z,K as i,ai as we,a5 as Ce,a6 as Se,B as qe,a3 as ee,aC as be,a0 as h,q as A,y as c}from"./index-D3-Phv8z.js";import{r as d}from"./vendor-BBpupLJz.js";import{M as se}from"./map-pin-B_2aw_SQ.js";import{C as Pe}from"./circle-x-WQ2m2kCb.js";function Ae(){const[g,ae]=d.useState(""),[S,te]=d.useState("all"),[q,ne]=d.useState("all"),[a,ie]=d.useState(null),[re,b]=d.useState(!1),[le,N]=d.useState(!1),[P,T]=d.useState(""),{toast:u}=me(),{selectedPropertyId:r,selectedLandlordId:l}=xe(),{data:F=[],isLoading:ce,error:I}=v({queryKey:["/api/maintenance-requests",r,l],queryFn:async()=>{const s=new URLSearchParams;r&&s.append("propertyId",r),l&&s.append("landlordId",l);const t=`/api/maintenance-requests${s.toString()?`?${s}`:""}`;return await(await h("GET",t)).json()}}),{data:M=[]}=v({queryKey:["/api/tenants",r,l],queryFn:async()=>{const s=new URLSearchParams;r&&s.append("propertyId",r),l&&s.append("landlordId",l);const t=`/api/tenants${s.toString()?`?${s}`:""}`;return await(await h("GET",t)).json()}});v({queryKey:["/api/properties",l,r],queryFn:async()=>{const s=new URLSearchParams;l&&s.append("landlordId",l),r&&s.append("propertyId",r);const t=`/api/properties${s.toString()?`?${s}`:""}`;return await(await h("GET",t)).json()}}),v({queryKey:["/api/units",r,l],queryFn:async()=>{const s=new URLSearchParams;r&&s.append("propertyId",r),l&&s.append("landlordId",l);const t=`/api/units${s.toString()?`?${s}`:""}`;return await(await h("GET",t)).json()}});const R=L({mutationFn:({id:s,status:t})=>h("PUT",`/api/maintenance-requests/${s}`,{status:t}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/maintenance-requests"]}),u({title:"Status Updated",description:"Maintenance request status has been updated successfully."})},onError:s=>{u({title:"Error",description:s.message||"Failed to update status",variant:"destructive"})}}),E=L({mutationFn:({id:s,response:t})=>h("PUT",`/api/maintenance-requests/${s}`,{response:t}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/maintenance-requests"]}),u({title:"Response sent",description:"Tenant will see your response in the portal."}),T(""),b(!1)},onError:s=>{u({title:"Error",description:s.message||"Failed to send response",variant:"destructive"})}}),D=L({mutationFn:s=>h("POST","/api/maintenance-requests",s),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/maintenance-requests"]}),N(!1),u({title:"Request Added",description:"Maintenance request has been added successfully."})},onError:s=>{u({title:"Error",description:s.message||"Failed to add request",variant:"destructive"})}}),U=Array.isArray(F)?F.filter(s=>{const t=s.title?.toLowerCase().includes(g.toLowerCase())||s.description?.toLowerCase().includes(g.toLowerCase())||s.tenantName?.toLowerCase().includes(g.toLowerCase()),p=S==="all"||s.status===S,oe=q==="all"||s.priority===q;return t&&p&&oe}):[],k=(s,t)=>{R.mutate({id:s,status:t})},de=s=>{D.mutate(s)};d.useEffect(()=>{a&&T(a.response||"")},[a]);const $=s=>{switch(s){case"completed":return e.jsx(Q,{className:"h-4 w-4 text-green-500"});case"in_progress":return e.jsx(_,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(j,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(Pe,{className:"h-4 w-4 text-red-500"});default:return e.jsx(j,{className:"h-4 w-4 text-gray-500"})}},B=s=>{switch(s){case"completed":return e.jsx(c,{variant:"default",className:"bg-green-500",children:"Completed"});case"in_progress":return e.jsx(c,{variant:"secondary",className:"bg-blue-500 text-white",children:"In Progress"});case"pending":return e.jsx(c,{variant:"outline",className:"bg-yellow-500 text-white",children:"Pending"});case"cancelled":return e.jsx(c,{variant:"destructive",children:"Cancelled"});default:return e.jsx(c,{variant:"outline",children:"Unknown"})}},K=s=>{switch(s){case"urgent":return e.jsx(c,{variant:"destructive",children:"Urgent"});case"high":return e.jsx(c,{variant:"outline",className:"bg-orange-500 text-white",children:"High"});case"medium":return e.jsx(c,{variant:"outline",className:"bg-yellow-500 text-white",children:"Medium"});case"low":return e.jsx(c,{variant:"outline",className:"bg-green-500 text-white",children:"Low"});default:return e.jsx(c,{variant:"outline",children:"Normal"})}};return I?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsxs("span",{children:["Error loading maintenance requests: ",I.message]})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"maintenance-title",children:"Maintenance Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage tenant maintenance requests and track progress"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{onClick:()=>N(!0),"data-testid":"button-add-maintenance-request",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Add Request"]})})]}),e.jsx(H,{children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(V,{placeholder:"Search requests by title, description, or tenant...",value:g,onChange:s=>ae(s.target.value),className:"max-w-sm"})}),e.jsxs(y,{value:S,onValueChange:te,children:[e.jsx(f,{className:"w-48",children:e.jsx(w,{placeholder:"Filter by status"})}),e.jsxs(C,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"in_progress",children:"In Progress"}),e.jsx(n,{value:"completed",children:"Completed"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(y,{value:q,onValueChange:ne,children:[e.jsx(f,{className:"w-48",children:e.jsx(w,{placeholder:"Filter by priority"})}),e.jsxs(C,{children:[e.jsx(n,{value:"all",children:"All Priority"}),e.jsx(n,{value:"urgent",children:"Urgent"}),e.jsx(n,{value:"high",children:"High"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"low",children:"Low"})]})]})]})})}),e.jsxs(H,{children:[e.jsxs(ue,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"Maintenance Requests"]}),e.jsxs(je,{children:[U.length," request(s) found"]})]}),e.jsx(O,{children:ce?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(z,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading requests..."})]}):e.jsxs(ge,{children:[e.jsx(Ne,{children:e.jsxs(G,{children:[e.jsx(m,{children:"Request"}),e.jsx(m,{children:"Tenant"}),e.jsx(m,{children:"Property/Unit"}),e.jsx(m,{children:"Priority"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(ve,{children:U.map(s=>e.jsxs(G,{children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate max-w-xs",children:s.description})]})}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.tenantName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.tenantPhone})]})}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.propertyName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.unitNumber})]})}),e.jsx(x,{children:K(s.priority)}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[$(s.status),B(s.status)]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.createdAt).toLocaleDateString()]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>{ie(s),b(!0)},children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"View"]}),s.status==="pending"&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>k(s.id,"in_progress"),disabled:R.isPending,children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Start"]}),s.status==="in_progress"&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>k(s.id,"completed"),disabled:R.isPending,children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Complete"]})]})})]},s.id))})]})})]}),e.jsx(W,{open:re,onOpenChange:b,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsxs(J,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"Maintenance Request Details"]}),e.jsx(Z,{children:"Complete information about the maintenance request"})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Request Title"}),e.jsx("p",{className:"text-sm",children:a.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Priority"}),e.jsx("div",{children:K(a.priority)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[$(a.status),B(a.status)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Date Reported"}),e.jsx("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Tenant Information"}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a.tenantName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.tenantPhone})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.tenantEmail})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Property Details"}),e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a.propertyName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.unitNumber})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a.propertyAddress})]})]})]})]}),a.notes&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Additional Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Response to Tenant"}),a.response&&e.jsx("div",{className:"p-3 bg-muted rounded-lg text-sm",children:a.response}),e.jsx(ee,{placeholder:"Write a response the tenant will see...",rows:3,value:P,onChange:s=>T(s.target.value)}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(o,{size:"sm",onClick:()=>a?.id&&E.mutate({id:a.id,response:P}),disabled:!P.trim()||E.isPending,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Send Response"]})})]})]})]})}),e.jsx(W,{open:le,onOpenChange:N,children:e.jsxs(X,{className:"max-w-md",children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Add Maintenance Request"}),e.jsx(Z,{children:"Create a new maintenance request for a tenant"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"request-title",children:"Request Title"}),e.jsx(V,{id:"request-title",placeholder:"e.g., Water Leak in Kitchen"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"request-description",children:"Description"}),e.jsx(ee,{id:"request-description",placeholder:"Detailed description of the issue...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"request-priority",children:"Priority"}),e.jsxs(y,{children:[e.jsx(f,{id:"request-priority",children:e.jsx(w,{placeholder:"Select priority"})}),e.jsxs(C,{children:[e.jsx(n,{value:"urgent",children:"Urgent"}),e.jsx(n,{value:"high",children:"High"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"request-tenant",children:"Tenant"}),e.jsxs(y,{children:[e.jsx(f,{id:"request-tenant",children:e.jsx(w,{placeholder:"Select tenant"})}),e.jsx(C,{children:Array.isArray(M)?M.map(s=>e.jsx(n,{value:s.id,children:s.fullName},s.id)):null})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsxs(o,{onClick:()=>de({}),disabled:D.isPending,children:[D.isPending&&e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Request"]})]})]})]})})]})}export{Ae as MaintenanceRequests};

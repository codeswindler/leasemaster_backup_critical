import{b as z,d as c,j as e,D as H,aj as X,x as u,P as Q,g as J,h as W,i as Y,k as Z,K as o,S as D,r as L,s as $,v as F,w as p,I as E,a3 as _,C as K,z as U,A as B,E as G,G as k,a2 as ee,aw as se,y as ae,a0 as m}from"./index-D3-Phv8z.js";import{r as d}from"./vendor-BBpupLJz.js";function re(){const[h,f]=d.useState(""),[x,N]=d.useState(""),[j,v]=d.useState(""),[S,b]=d.useState(""),[w,C]=d.useState(""),[M,g]=d.useState(!1),{selectedPropertyId:a,selectedLandlordId:t}=z(),P=!a,{data:I=[]}=c({queryKey:["/api/tenants",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/tenants${s.toString()?`?${s}`:""}`;return await(await m("GET",n)).json()}}),{data:R=[]}=c({queryKey:["/api/units",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/units${s.toString()?`?${s}`:""}`;return await(await m("GET",n)).json()}}),{data:T=[]}=c({queryKey:["/api/properties",t,a],queryFn:async()=>{const s=new URLSearchParams;t&&s.append("landlordId",t),a&&s.append("propertyId",a);const n=`/api/properties${s.toString()?`?${s}`:""}`;return await(await m("GET",n)).json()}}),{data:q=[]}=c({queryKey:["/api/leases",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/leases${s.toString()?`?${s}`:""}`;return await(await m("GET",n)).json()}}),y=Array.isArray(I)?I.map(s=>{const n=Array.isArray(q)?q.find(i=>i.tenantId===s.id&&i.status==="active"):null,r=Array.isArray(R)?R.find(i=>i.id===n?.unitId):null,A=Array.isArray(T)?T.find(i=>i.id===r?.propertyId):null;return{id:s.id,name:s.fullName,unit:r?.unitNumber||"No unit",property:A?.name||"No property",balance:0,accountNumber:`${A?.name?.substring(0,2).toUpperCase()||"XX"}${String(s.id.substring(0,3)).toUpperCase()}`}}).filter(s=>s.name):[],l=y.find(s=>s.id===h),O=()=>{if(P){alert("Select a property in the header before recording payments.");return}if(!h||!x||!j){alert("Please fill in all required fields");return}console.log("Recording payment:",{tenant:l,amount:parseFloat(x),paymentMethod:j,reference:S,notes:w}),alert("Payment recorded successfully!"),f(""),N(""),v(""),b(""),C(""),g(!1)},{data:V=[]}=c({queryKey:["/api/payments",a,t],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),t&&s.append("landlordId",t);const n=`/api/payments${s.toString()?`?${s}`:""}`;return await(await m("GET",n)).json()}});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"receive-payments-title",children:"Receive Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Record tenant payments and manage transactions"})]}),e.jsxs(H,{open:M,onOpenChange:g,children:[e.jsx(X,{asChild:!0,children:e.jsxs(u,{"data-testid":"button-record-payment",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Record Payment"]})}),e.jsxs(J,{className:"sm:max-w-[500px]",children:[e.jsxs(W,{children:[e.jsx(Y,{children:"Record New Payment"}),e.jsx(Z,{children:"Enter payment details to record a tenant payment."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"tenant",children:"Tenant"}),e.jsxs(D,{value:h,onValueChange:f,children:[e.jsx(L,{"data-testid":"select-tenant",children:e.jsx($,{placeholder:"Select tenant"})}),e.jsx(F,{children:y.map(s=>e.jsxs(p,{value:s.id,children:[s.name," - ",s.unit,s.balance>0&&e.jsxs("span",{className:"text-red-600 ml-2",children:["(Balance: KSh ",s.balance.toLocaleString(),")"]})]},s.id))})]})]}),l&&e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Account Number"}),e.jsx("p",{className:"font-mono",children:l.accountNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Outstanding Balance"}),e.jsxs("p",{className:`font-mono ${l.balance>0?"text-red-600":"text-green-600"}`,children:["KSh ",l.balance.toLocaleString()]})]})]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"amount",children:"Amount"}),e.jsx(E,{id:"amount",type:"number",placeholder:"Enter payment amount",value:x,onChange:s=>N(s.target.value),"data-testid":"input-amount"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"payment-method",children:"Payment Method"}),e.jsxs(D,{value:j,onValueChange:v,children:[e.jsx(L,{"data-testid":"select-payment-method",children:e.jsx($,{placeholder:"Select payment method"})}),e.jsxs(F,{children:[e.jsx(p,{value:"mpesa",children:"M-Pesa"}),e.jsx(p,{value:"bank",children:"Bank Transfer"}),e.jsx(p,{value:"cash",children:"Cash"}),e.jsx(p,{value:"cheque",children:"Cheque"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"reference",children:"Reference Number"}),e.jsx(E,{id:"reference",placeholder:"Transaction reference (optional)",value:S,onChange:s=>b(s.target.value),"data-testid":"input-reference"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"notes",children:"Notes"}),e.jsx(_,{id:"notes",placeholder:"Additional notes (optional)",value:w,onChange:s=>C(s.target.value),rows:3,"data-testid":"textarea-notes"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(u,{onClick:O,disabled:P,"data-testid":"button-submit-payment",children:"Record Payment"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx(B,{children:"Outstanding Balances"}),e.jsx(G,{children:"Tenants with pending payments"})]}),e.jsx(k,{className:"space-y-4",children:y.filter(s=>s.balance>0).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover-elevate",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.unit," - ",s.property]}),e.jsxs("p",{className:"text-xs font-mono text-muted-foreground",children:["Account: ",s.accountNumber]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-mono text-red-600",children:["KSh ",s.balance.toLocaleString()]}),e.jsx(u,{size:"sm",variant:"outline",className:"mt-1",children:"Record Payment"})]})]},s.id))})]}),e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx(B,{children:"Recent Payments"}),e.jsx(G,{children:"Latest payment transactions"})]}),e.jsx(k,{className:"space-y-4",children:V.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.method==="M-Pesa"?e.jsx(ee,{className:"h-5 w-5 text-green-600"}):e.jsx(se,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.tenant}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.unit}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.date})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-mono",children:["KSh ",s.amount.toLocaleString()]}),e.jsx(ae,{variant:s.status==="verified"?"default":"secondary",className:"text-xs",children:s.status})]})]},s.id))})]})]})]})}export{re as ReceivePayments};

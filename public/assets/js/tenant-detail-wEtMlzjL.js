import{av as Me,u as ze,b as Be,a as Ge,d as N,f as F,j as s,x as y,a1 as Ve,y as we,C as D,z as S,A as w,ai as He,ar as Oe,G as A,K as r,I as m,a4 as Qe,a6 as We,a5 as Ye,a7 as Je,ah as Xe,O as Ze,Q as es,V as ss,W as ts,X as as,Y as ns,Z as is,_ as rs,$ as ls,D as cs,aj as ds,g as os,h as ms,i as us,k as hs,S as M,r as z,s as B,v as G,w as I,aa as ee,ab as se,ac as E,ad as l,ae as te,af as c,aw as xs,a0 as h,q as R,au as ps}from"./index-D3-Phv8z.js";import{r as b}from"./vendor-BBpupLJz.js";import{T as js,a as gs,b as V,c as H}from"./tabs-CPhPIXkL.js";import{P as ys}from"./pencil-BpDMQQo5.js";import{U as vs}from"./undo-2-BRAlXuVT.js";const U=({text:_,className:O,speed:u=18})=>{const[$,P]=b.useState("");return b.useEffect(()=>{if(P(""),!_)return;let d=0;const x=setInterval(()=>{d+=1,P(_.slice(0,d)),d>=_.length&&clearInterval(x)},u);return()=>clearInterval(x)},[_,u]),s.jsx("span",{className:O,children:$})};function ws(){const[_,O]=Me("/tenants/:id"),u=O?.id,[,$]=ze(),{selectedPropertyId:P}=Be(),{toast:d}=Ge(),x=!P,[ae,Q]=b.useState(!1),[Ae,W]=b.useState(!1),[f,Y]=b.useState("all"),q=b.useRef({}),[v,T]=b.useState({unitId:"",startDate:"",endDate:"",rentAmount:"",depositAmount:"",waterRatePerUnit:"15.50"}),[a,p]=b.useState({fullName:"",email:"",phone:"",idNumber:"",emergencyContact:"",emergencyPhone:"",secondaryContactName:"",secondaryContactPhone:"",secondaryContactEmail:"",notifySecondary:"false"}),j=e=>{const t=Number(e);return Number.isFinite(t)?t:0},{data:n,isLoading:Te}=N({queryKey:["/api/tenants",u],queryFn:async()=>await(await h("GET",`/api/tenants/${u}`)).json(),enabled:!!u}),{data:ne}=N({queryKey:["/api/auth/check"],queryFn:async()=>await(await h("GET","/api/auth/check")).json()}),C=ne?.authenticated?ne.user:null,Ie=C&&(C.role==="admin"||C.role==="super_admin"),ie=(()=>{if(!C?.permissions)return[];if(Array.isArray(C.permissions))return C.permissions;if(typeof C.permissions=="string")try{const e=JSON.parse(C.permissions);return Array.isArray(e)?e:[]}catch{return[]}return[]})(),_e=Ie||ie.includes("tenants.send_login")||ie.includes("tenants.bulk_send_login");b.useEffect(()=>{n&&p({fullName:n.fullName??n.full_name??"",email:n.email??"",phone:n.phone??"",idNumber:n.idNumber??n.id_number??"",emergencyContact:n.emergencyContact??n.emergency_contact??"",emergencyPhone:n.emergencyPhone??n.emergency_phone??"",secondaryContactName:n.secondaryContactName??n.secondary_contact_name??"",secondaryContactPhone:n.secondaryContactPhone??n.secondary_contact_phone??"",secondaryContactEmail:n.secondaryContactEmail??n.secondary_contact_email??"",notifySecondary:n.notifySecondary??n.notify_secondary??"false"})},[n]);const J=F({mutationFn:async e=>{if(x)throw new Error("Select a property in the header before editing tenants.");return await(await h("PUT",`/api/tenants/${u}`,e)).json()},onSuccess:()=>{R.invalidateQueries({queryKey:["/api/tenants"]}),R.invalidateQueries({queryKey:["/api/tenants",u]}),Q(!1)}}),re=F({mutationFn:async()=>await(await h("POST",`/api/tenants/${u}/send-login-details`,{generateNewAccessCode:!0,sendSms:!0,sendEmail:!0})).json(),onSuccess:e=>{const t=[];e?.sent?.sms&&t.push("SMS"),e?.sent?.email&&t.push("Email");const i=t.length?t.join(" & "):"no channels",o=e?.accessCode||"";d({title:"Tenant login details sent",description:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("span",{children:["Access Code:"," ",s.jsx("span",{className:"font-mono font-semibold select-text",children:o||"—"})]}),s.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:async()=>{if(o)try{await navigator.clipboard.writeText(o),d({title:"Copied",description:"Access code copied to clipboard."})}catch{d({title:"Copy failed",description:"Please copy manually.",variant:"destructive"})}},disabled:!o,children:"Copy"})]}),s.jsxs("div",{children:["Sent via ",i]})]}),duration:1e6})},onError:e=>{d({title:"Failed to send tenant login",description:e?.message||"Please try again.",variant:"destructive"})}}),{data:le=[]}=N({queryKey:["/api/leases",u],queryFn:async()=>await(await h("GET",`/api/leases?tenantId=${u}`)).json(),enabled:!!u}),{data:ce=[]}=N({queryKey:["/api/units"],queryFn:async()=>await(await h("GET","/api/units")).json()}),{data:de=[]}=N({queryKey:["/api/house-types"],queryFn:async()=>await(await h("GET","/api/house-types")).json()}),{data:oe=[]}=N({queryKey:["/api/properties"],queryFn:async()=>await(await h("GET","/api/properties")).json()}),{data:me=[]}=N({queryKey:["/api/invoices"],queryFn:async()=>await(await h("GET","/api/invoices")).json()}),{data:ue=[]}=N({queryKey:["/api/invoice-items"],queryFn:async()=>await(await h("GET","/api/invoice-items")).json()}),{data:he=[]}=N({queryKey:["/api/payments"],queryFn:async()=>await(await h("GET","/api/payments")).json()}),xe=Array.isArray(le)?le.map(e=>({id:e.id,unitId:e.unitId??e.unit_id,tenantId:e.tenantId??e.tenant_id,startDate:e.startDate??e.start_date,endDate:e.endDate??e.end_date,rentAmount:e.rentAmount??e.rent_amount,depositAmount:e.depositAmount??e.deposit_amount,waterRatePerUnit:e.waterRatePerUnit??e.water_rate_per_unit,status:e.status})):[],pe=Array.isArray(ce)?ce.map(e=>({id:e.id,propertyId:e.propertyId??e.property_id,houseTypeId:e.houseTypeId??e.house_type_id,unitNumber:e.unitNumber??e.unit_number,rentAmount:e.rentAmount??e.rent_amount,rentDepositAmount:e.rentDepositAmount??e.rent_deposit_amount,waterRateAmount:e.waterRateAmount??e.water_rate_amount??e.water_rate_per_unit,status:e.status})):[],Pe=Array.isArray(de)?de.map(e=>({id:e.id,propertyId:e.propertyId??e.property_id,name:e.name,baseRentAmount:e.baseRentAmount??e.base_rent_amount,rentDepositAmount:e.rentDepositAmount??e.rent_deposit_amount,waterRateType:e.waterRateType??e.water_rate_type,waterRatePerUnit:e.waterRatePerUnit??e.water_rate_per_unit,waterFlatRate:e.waterFlatRate??e.water_flat_rate})):[],Le=Array.isArray(oe)?oe.map(e=>({id:e.id,name:e.name,address:e.address})):[],Ee=Array.isArray(me)?me.map(e=>({id:e.id,leaseId:e.leaseId??e.lease_id,amount:e.amount,issueDate:e.issueDate??e.issue_date,dueDate:e.dueDate??e.due_date,status:e.status,description:e.description,invoiceNumber:e.invoiceNumber??e.invoice_number})):[],Re=(Array.isArray(ue)?ue.map(e=>({invoiceId:e.invoiceId??e.invoice_id,description:e.description??e.itemDescription??e.item_description??"Invoice item",amount:j(e.amount)})):[]).reduce((e,t)=>(t.invoiceId&&(e[t.invoiceId]=e[t.invoiceId]||[],e[t.invoiceId].push(t)),e),{}),Ke=Array.isArray(he)?he.map(e=>({id:e.id,leaseId:e.leaseId??e.lease_id,invoiceId:e.invoiceId??e.invoice_id,amount:e.amount,paymentDate:e.paymentDate??e.payment_date,paymentMethod:e.paymentMethod??e.payment_method,reference:e.reference})):[],g=xe.map(e=>{const t=pe.find(o=>o.id===e.unitId),i=Le.find(o=>o.id===t?.propertyId);return{lease:e,unit:t,property:i}}),Ue=f==="all"?g.find(e=>e.lease.status==="active")||g[0]:g.find(e=>e.lease.id===f),je=pe.filter(e=>(P?e.propertyId===P:!0)&&e.status==="vacant").map(e=>{const t=Pe.find(i=>i.id===e.houseTypeId);return{...e,houseType:t}}),ge=new Set(xe.map(e=>e.id)),ye=Ee.filter(e=>ge.has(e.leaseId)),ve=Ke.filter(e=>ge.has(e.leaseId)),X=f==="all"?ye:ye.filter(e=>e.leaseId===f),Z=f==="all"?ve:ve.filter(e=>e.leaseId===f),fe=X.reduce((e,t)=>e+j(t.amount),0),Ne=Z.reduce((e,t)=>e+j(t.amount),0),K=fe-Ne,$e=K<0?"text-green-600":K>0?"text-red-500":"text-muted-foreground",qe=[...X.flatMap(e=>{const t=Re[e.id]||[];return t.length?t.map((i,o)=>({id:`invoice-${e.id}-${o}`,date:e.issueDate||e.dueDate,type:"Invoice",description:`${e.invoiceNumber} • ${i.description}`,debit:j(i.amount),credit:0})):[{id:`invoice-${e.id}`,date:e.issueDate||e.dueDate,type:"Invoice",description:e.description||e.invoiceNumber,debit:j(e.amount),credit:0}]}),...Z.map(e=>({id:`payment-${e.id}`,date:e.paymentDate,type:"Payment",description:e.reference||e.paymentMethod,debit:0,credit:j(e.amount)}))].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());let be=0;const ke=qe.map(e=>(be+=e.debit-e.credit,{...e,balance:be})),Ce=F({mutationFn:async e=>{if(x)throw new Error("Select a property in the header before assigning a unit.");return await(await h("POST","/api/leases",e)).json()},onSuccess:()=>{R.invalidateQueries({queryKey:["/api/leases"]}),R.invalidateQueries({queryKey:["/api/units"]}),W(!1),T({unitId:"",startDate:"",endDate:"",rentAmount:"",depositAmount:"",waterRatePerUnit:"15.50"}),d({title:"Lease created",description:"Tenant has been assigned to the selected unit."})},onError:e=>{d({title:"Failed to create lease",description:e.message||"Please check the lease details.",variant:"destructive"})}}),De=F({mutationFn:async e=>{if(x)throw new Error("Select a property in the header before terminating leases.");const t=new Date().toISOString().split("T")[0];return await(await h("PUT",`/api/leases/${e}`,{status:"terminated",endDate:t})).json()},onSuccess:()=>{R.invalidateQueries({queryKey:["/api/leases"]}),R.invalidateQueries({queryKey:["/api/units"]}),d({title:"Lease terminated",description:"The tenant has been marked as moved out."})},onError:e=>{d({title:"Failed to terminate lease",description:e.message||"Please try again.",variant:"destructive"})}}),Fe=e=>{const t=q.current[e];t&&clearTimeout(t);const i=setTimeout(()=>{De.mutate(e),delete q.current[e]},5e3);q.current[e]=i,d({title:"Termination scheduled",description:"Lease will be terminated in 5 seconds.",action:s.jsxs(ps,{altText:"Undo termination",onClick:()=>{clearTimeout(i),delete q.current[e],d({title:"Termination canceled",description:"The lease was not terminated."})},children:[s.jsx(vs,{className:"h-4 w-4 mr-1"}),"Undo"]})})};return _?s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(y,{variant:"outline",size:"sm",onClick:()=>$("/tenants"),children:[s.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Back to Tenants"]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:n?.fullName||"Tenant"}),s.jsx("p",{className:"text-muted-foreground",children:"Tenant profile, invoices, and payments"})]})]}),n?.status&&s.jsx(we,{variant:n.status==="active"?"default":"secondary",children:n.status})]}),Te?s.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading tenant..."}):n?s.jsxs(js,{defaultValue:"details",className:"space-y-4",children:[s.jsxs(gs,{children:[s.jsx(V,{value:"details",children:"Details"}),s.jsx(V,{value:"invoices",children:"Invoices"}),s.jsx(V,{value:"payments",children:"Payments"}),s.jsx(V,{value:"statement",children:"Statement"})]}),s.jsx(H,{value:"details",className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[s.jsxs(D,{className:"min-h-[240px]",children:[s.jsxs(S,{className:"flex flex-row items-center justify-between gap-2",children:[s.jsxs(w,{className:"flex items-center gap-2",children:[s.jsx(He,{className:"h-5 w-5"}),"Tenant Info"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[_e&&s.jsxs(y,{variant:"outline",size:"sm",onClick:()=>re.mutate(),disabled:re.isPending,children:[s.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Generate & Send Login"]}),s.jsxs(y,{variant:"outline",size:"sm",onClick:()=>Q(e=>!e),disabled:J.isPending,children:[s.jsx(ys,{className:"h-4 w-4 mr-2"}),ae?"Cancel":"Edit"]})]})]}),s.jsx(A,{className:"space-y-4 text-sm",children:ae?s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Full Name"}),s.jsx(m,{value:a.fullName,onChange:e=>p({...a,fullName:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Email"}),s.jsx(m,{type:"email",value:a.email,onChange:e=>p({...a,email:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Phone"}),s.jsx(m,{value:a.phone,onChange:e=>p({...a,phone:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"ID Number"}),s.jsx(m,{value:a.idNumber,onChange:e=>p({...a,idNumber:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Emergency Contact"}),s.jsx(m,{value:a.emergencyContact,onChange:e=>p({...a,emergencyContact:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Emergency Phone"}),s.jsx(m,{value:a.emergencyPhone,onChange:e=>p({...a,emergencyPhone:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Secondary Contact Name"}),s.jsx(m,{value:a.secondaryContactName,onChange:e=>p({...a,secondaryContactName:e.target.value})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Secondary Contact Phone"}),s.jsx(m,{value:a.secondaryContactPhone,onChange:e=>p({...a,secondaryContactPhone:e.target.value})})]}),s.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[s.jsx(r,{children:"Secondary Contact Email"}),s.jsx(m,{type:"email",value:a.secondaryContactEmail,onChange:e=>p({...a,secondaryContactEmail:e.target.value})})]}),s.jsxs("div",{className:"flex items-center justify-between border rounded-md p-3 lg:col-span-2",children:[s.jsxs("div",{children:[s.jsx(r,{children:"Notify Secondary Contact"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Enable notifications for secondary contact"})]}),s.jsx(Qe,{checked:a.notifySecondary==="true",onCheckedChange:e=>p({...a,notifySecondary:e?"true":"false"})})]}),s.jsxs("div",{className:"lg:col-span-2 flex justify-end gap-2",children:[s.jsx(y,{variant:"outline",onClick:()=>Q(!1),children:"Cancel"}),s.jsx(y,{onClick:()=>J.mutate(a),disabled:x||J.isPending,children:"Save Changes"})]}),x&&s.jsx("p",{className:"text-xs text-muted-foreground lg:col-span-2",children:"Select a property in the header to enable editing."})]}):s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:n?.email||"—"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:n?.phone||"—"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("span",{children:Ue?.property?.name||"No property"})]}),s.jsxs("div",{children:["Emergency Contact: ",a.emergencyContact||"—"]}),s.jsxs("div",{children:["Emergency Phone: ",a.emergencyPhone||"—"]}),s.jsxs("div",{children:["Secondary Contact: ",a.secondaryContactName||"—"]}),s.jsxs("div",{children:["Secondary Phone: ",a.secondaryContactPhone||"—"]}),s.jsxs("div",{className:"lg:col-span-2",children:["Secondary Email: ",a.secondaryContactEmail||"—"]}),s.jsxs("div",{className:"lg:col-span-2",children:["Notify Secondary: ",a.notifySecondary==="true"?"Yes":"No"]})]})})]}),s.jsxs(D,{className:"min-h-[220px]",children:[s.jsxs(S,{className:"flex flex-row items-center justify-between",children:[s.jsxs(w,{className:"flex items-center gap-2",children:[s.jsx(Xe,{className:"h-5 w-5"}),"Lease Summary"]}),s.jsx("div",{})]}),s.jsxs(A,{className:"space-y-2 text-sm",children:[g.length===0&&s.jsx("div",{className:"text-muted-foreground",children:"No leases found for this tenant."}),g.map(e=>{const t=e.lease.status==="terminated",i=`${e.unit?.unitNumber||"Unit"}${e.property?.name?` • ${e.property.name}`:""}`,o=`Rent: KSh ${j(e.lease.rentAmount).toLocaleString()}`,k=`Deposit: KSh ${j(e.lease.depositAmount).toLocaleString()}`,L=`Water Rate: KSh ${j(e.lease.waterRatePerUnit).toLocaleString()} / m³`,Se=`Lease: ${e.lease.startDate?new Date(e.lease.startDate).toLocaleDateString():"—"} - ${e.lease.endDate?new Date(e.lease.endDate).toLocaleDateString():"—"}`;return s.jsxs("div",{className:`border rounded-md p-3 space-y-2 ${t?"border-red-500/70 bg-red-950/20 text-red-500":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"font-medium",children:t?s.jsx(U,{text:i,className:"text-red-500"}):i}),s.jsx(we,{variant:e.lease.status==="active"?"default":"secondary",className:t?"bg-red-600 text-white":void 0,children:e.lease.status})]}),s.jsx("div",{children:t?s.jsx(U,{text:o,className:"text-red-500"}):o}),s.jsx("div",{children:t?s.jsx(U,{text:k,className:"text-red-500"}):k}),s.jsx("div",{children:t?s.jsx(U,{text:L,className:"text-red-500"}):L}),s.jsx("div",{children:t?s.jsx(U,{text:Se,className:"text-red-500"}):Se}),e.lease.status==="active"&&s.jsxs(Ze,{children:[s.jsx(es,{asChild:!0,children:s.jsx(y,{variant:"destructive",size:"sm",disabled:x||De.isPending,children:"Terminate Lease"})}),s.jsxs(ss,{children:[s.jsxs(ts,{children:[s.jsx(as,{children:"Terminate lease?"}),s.jsx(ns,{children:"This will schedule the lease termination and mark the tenant as moved out."})]}),s.jsxs(is,{children:[s.jsx(rs,{children:"Cancel"}),s.jsx(ls,{onClick:()=>Fe(e.lease.id),children:"Confirm Termination"})]})]})]})]},e.lease.id)}),s.jsxs("div",{className:"border-t pt-4 space-y-2",children:[s.jsx("div",{className:"text-sm font-medium",children:"Assign New Unit"}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"Tenants can hold multiple active leases. Assign another unit if needed."}),s.jsxs(cs,{open:Ae,onOpenChange:W,children:[s.jsx(ds,{asChild:!0,children:s.jsx(y,{variant:"outline",size:"sm",disabled:x,children:"Assign New Unit"})}),s.jsxs(os,{className:"sm:max-w-[900px] max-h-[85vh] overflow-y-auto",children:[s.jsxs(ms,{children:[s.jsx(us,{children:"Assign Unit"}),s.jsx(hs,{children:"Assign a vacant unit and create a lease."})]}),s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2 md:col-span-2",children:[s.jsx(r,{children:"Available Unit"}),s.jsxs(M,{value:v.unitId,onValueChange:e=>{const t=je.find(L=>L.id===e),i=t?.rentAmount??t?.houseType?.baseRentAmount??"",o=t?.rentDepositAmount??t?.houseType?.rentDepositAmount??"",k=t?.waterRateAmount??(t?.houseType?.waterRateType==="unit_based"?t?.houseType?.waterRatePerUnit:t?.houseType?.waterFlatRate)??"15.50";T(L=>({...L,unitId:e,rentAmount:i,depositAmount:o,waterRatePerUnit:k}))},children:[s.jsx(z,{children:s.jsx(B,{placeholder:"Select unit"})}),s.jsx(G,{children:je.map(e=>s.jsxs(I,{value:e.id,children:[e.unitNumber," ",e.houseType?.name?`- ${e.houseType.name}`:""]},e.id))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Lease Start Date"}),s.jsx(m,{type:"date",value:v.startDate,onChange:e=>T(t=>({...t,startDate:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Lease End Date"}),s.jsx(m,{type:"date",value:v.endDate,onChange:e=>T(t=>({...t,endDate:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Monthly Rent (KSH)"}),s.jsx(m,{type:"number",value:v.rentAmount,onChange:e=>T(t=>({...t,rentAmount:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Security Deposit (KSH)"}),s.jsx(m,{type:"number",value:v.depositAmount,onChange:e=>T(t=>({...t,depositAmount:e.target.value}))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{children:"Water Rate per Unit (KSH)"}),s.jsx(m,{type:"number",value:v.waterRatePerUnit,onChange:e=>T(t=>({...t,waterRatePerUnit:e.target.value}))})]})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(y,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),s.jsx(y,{onClick:()=>{if(!v.unitId||!v.startDate||!v.endDate){d({title:"Missing details",description:"Select a unit and lease dates before creating the lease.",variant:"destructive"});return}Ce.mutate({...v,tenantId:u})},disabled:Ce.isPending,children:"Create Lease"})]})]})]})]})]}),x&&s.jsx("div",{className:"text-xs text-muted-foreground",children:"Select a property in the header to manage leases."})]})]})]})}),s.jsx(H,{value:"invoices",children:s.jsxs(D,{children:[s.jsxs(S,{children:[s.jsx(w,{children:"Invoices"}),g.length>0&&s.jsx("div",{className:"pt-2",children:s.jsxs(M,{value:f,onValueChange:Y,children:[s.jsx(z,{className:"h-8 w-[200px]",children:s.jsx(B,{placeholder:"All leases"})}),s.jsxs(G,{children:[s.jsx(I,{value:"all",children:"All leases"}),g.map(e=>s.jsxs(I,{value:e.lease.id,children:[e.unit?.unitNumber||"Unit"," (",e.lease.status,")"]},e.lease.id))]})]})})]}),s.jsx(A,{className:"p-0",children:s.jsxs(ee,{children:[s.jsx(se,{children:s.jsxs(E,{children:[s.jsx(l,{children:"Invoice"}),s.jsx(l,{children:"Description"}),s.jsx(l,{children:"Issue Date"}),s.jsx(l,{children:"Due Date"}),s.jsx(l,{children:"Status"}),s.jsx(l,{className:"text-right",children:"Amount"})]})}),s.jsx(te,{children:X.map(e=>s.jsxs(E,{children:[s.jsx(c,{className:"font-mono text-sm",children:e.invoiceNumber||e.id}),s.jsx(c,{children:e.description}),s.jsx(c,{children:e.issueDate?new Date(e.issueDate).toLocaleDateString():"—"}),s.jsx(c,{children:e.dueDate?new Date(e.dueDate).toLocaleDateString():"—"}),s.jsx(c,{children:e.status}),s.jsxs(c,{className:"text-right font-mono",children:["KSh ",j(e.amount).toLocaleString()]})]},e.id))})]})})]})}),s.jsx(H,{value:"payments",children:s.jsxs(D,{children:[s.jsxs(S,{children:[s.jsx(w,{children:"Payments"}),g.length>0&&s.jsx("div",{className:"pt-2",children:s.jsxs(M,{value:f,onValueChange:Y,children:[s.jsx(z,{className:"h-8 w-[200px]",children:s.jsx(B,{placeholder:"All leases"})}),s.jsxs(G,{children:[s.jsx(I,{value:"all",children:"All leases"}),g.map(e=>s.jsxs(I,{value:e.lease.id,children:[e.unit?.unitNumber||"Unit"," (",e.lease.status,")"]},e.lease.id))]})]})})]}),s.jsx(A,{className:"p-0",children:s.jsxs(ee,{children:[s.jsx(se,{children:s.jsxs(E,{children:[s.jsx(l,{children:"Payment Date"}),s.jsx(l,{children:"Method"}),s.jsx(l,{children:"Reference"}),s.jsx(l,{className:"text-right",children:"Amount"})]})}),s.jsx(te,{children:Z.map(e=>s.jsxs(E,{children:[s.jsx(c,{children:e.paymentDate?new Date(e.paymentDate).toLocaleDateString():"—"}),s.jsx(c,{children:e.paymentMethod}),s.jsx(c,{children:e.reference||"—"}),s.jsxs(c,{className:"text-right font-mono",children:["KSh ",j(e.amount).toLocaleString()]})]},e.id))})]})})]})}),s.jsxs(H,{value:"statement",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[s.jsxs(D,{children:[s.jsx(S,{children:s.jsx(w,{children:"Total Invoiced"})}),s.jsxs(A,{className:"text-xl font-mono",children:["KSh ",fe.toLocaleString()]})]}),s.jsxs(D,{children:[s.jsx(S,{children:s.jsx(w,{children:"Total Paid"})}),s.jsxs(A,{className:"text-xl font-mono",children:["KSh ",Ne.toLocaleString()]})]}),s.jsxs(D,{children:[s.jsx(S,{children:s.jsx(w,{children:"Current Balance"})}),s.jsx(A,{className:`text-xl font-mono ${$e}`,children:K<0?`-KSh ${Math.abs(K).toLocaleString()}`:`KSh ${K.toLocaleString()}`})]})]}),s.jsxs(D,{children:[s.jsxs(S,{children:[s.jsxs(w,{className:"flex items-center gap-2",children:[s.jsx(xs,{className:"h-5 w-5"}),"Statement"]}),g.length>0&&s.jsx("div",{className:"pt-2",children:s.jsxs(M,{value:f,onValueChange:Y,children:[s.jsx(z,{className:"h-8 w-[200px]",children:s.jsx(B,{placeholder:"All leases"})}),s.jsxs(G,{children:[s.jsx(I,{value:"all",children:"All leases"}),g.map(e=>s.jsxs(I,{value:e.lease.id,children:[e.unit?.unitNumber||"Unit"," (",e.lease.status,")"]},e.lease.id))]})]})})]}),s.jsx(A,{className:"p-0",children:s.jsxs(ee,{children:[s.jsx(se,{children:s.jsxs(E,{children:[s.jsx(l,{children:"Date"}),s.jsx(l,{children:"Type"}),s.jsx(l,{children:"Description"}),s.jsx(l,{className:"text-right",children:"Debit"}),s.jsx(l,{className:"text-right",children:"Credit"}),s.jsx(l,{className:"text-right",children:"Balance"})]})}),s.jsx(te,{children:ke.map(e=>{const t=e.balance<0?"text-green-600":e.balance>0?"text-red-500":"text-muted-foreground";return s.jsxs(E,{children:[s.jsx(c,{children:e.date?new Date(e.date).toLocaleDateString():"—"}),s.jsx(c,{children:e.type}),s.jsx(c,{children:e.description}),s.jsx(c,{className:"text-right font-mono",children:e.debit?`KSh ${e.debit.toLocaleString()}`:"—"}),s.jsx(c,{className:"text-right font-mono",children:e.credit?`KSh ${e.credit.toLocaleString()}`:"—"}),s.jsx(c,{className:`text-right font-mono ${t}`,children:e.balance<0?`-KSh ${Math.abs(e.balance).toLocaleString()}`:`KSh ${e.balance.toLocaleString()}`})]},e.id)})})]})})]})]})]}):s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Tenant not found."," ",s.jsx(y,{variant:"link",onClick:()=>$("/tenants"),children:"Back to Tenants"})]})]}):null}export{ws as TenantDetail};

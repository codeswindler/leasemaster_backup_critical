import{ag as M,u as z,a as V,b as G,d as g,e as O,f as B,j as e,x as l,a1 as H,ah as w,C as S,z as C,A as I,G as L,K as d,y as F,ai as Q,E as W,D as J,aj as X,P,g as Y,h as Z,i as _,k as ee,F as se,l as c,m as o,n as m,S as te,o as u,r as ae,s as ne,v as re,w as ie,p as x,I as f,ak as de,H as le,al as ce,R as oe,t as me,a0 as N,q as T}from"./index-D3-Phv8z.js";import{r as ue}from"./vendor-BBpupLJz.js";import{b as xe}from"./schema-ChL10cc-.js";function Ne(){const{unitId:p}=M(),[,E]=z(),[U,y]=ue.useState(!1),{toast:h}=V(),{selectedPropertyId:a,selectedLandlordId:n}=G(),{data:pe,isLoading:$}=g({queryKey:["/api/units",p]}),{data:q=[]}=g({queryKey:["/api/units",a,n],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),n&&s.append("landlordId",n);const t=`/api/units${s.toString()?`?${s}`:""}`;return await(await N("GET",t)).json()}}),r=q.find(s=>s.id===p),{data:A=[]}=g({queryKey:["/api/properties",n,a],queryFn:async()=>{const s=new URLSearchParams;n&&s.append("landlordId",n),a&&s.append("propertyId",a);const t=`/api/properties${s.toString()?`?${s}`:""}`;return await(await N("GET",t)).json()}}),K=r?A.find(s=>s.id===r.propertyId):null,{data:b=[]}=g({queryKey:["/api/tenants",a,n],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),n&&s.append("landlordId",n);const t=`/api/tenants${s.toString()?`?${s}`:""}`;return await(await N("GET",t)).json()}}),{data:R=[]}=g({queryKey:["/api/leases",a,n],queryFn:async()=>{const s=new URLSearchParams;a&&s.append("propertyId",a),n&&s.append("landlordId",n);const t=`/api/leases${s.toString()?`?${s}`:""}`;return await(await N("GET",t)).json()}}),v=R.filter(s=>s.unitId===p).map(s=>{const t=b.find(j=>j.id===s.tenantId);return{...s,tenantName:t?.fullName||"Unknown Tenant",tenantEmail:t?.email||"",tenantPhone:t?.phone||""}}),i=O({resolver:me(xe),defaultValues:{unitId:p||"",tenantId:"",startDate:"",endDate:"",rentAmount:"",depositAmount:"",waterRatePerUnit:"15.50"}}),D=B({mutationFn:async s=>N("POST","/api/leases",s),onSuccess:()=>{T.invalidateQueries({queryKey:["/api/leases"]}),T.invalidateQueries({queryKey:["/api/units"]}),h({title:"Success",description:"Lease created successfully"}),y(!1),i.reset()},onError:s=>{h({title:"Error",description:s.message||"Failed to create lease",variant:"destructive"})}}),k=s=>{D.mutate({...s,unitId:p})};return $||!r?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>E(`/properties/${r.propertyId}`),"data-testid":"button-back-to-property",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Back to Property"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2","data-testid":"lease-management-title",children:[e.jsx(w,{className:"h-8 w-8"}),"Lease Management - Unit ",r.unitNumber]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage occupancy and lease agreements for this unit"})]})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Unit Details"]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Property"}),e.jsx("p",{className:"font-medium",children:K?.name||"Unknown Property"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Unit Number"}),e.jsx("p",{className:"font-medium",children:r.unitNumber})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Unit Type"}),e.jsx("p",{className:"font-medium capitalize",children:r.type})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Monthly Rent"}),e.jsxs("p",{className:"font-medium",children:["KSh ",parseFloat(r.rentAmount).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(F,{variant:r.status==="occupied"?"default":"outline",children:r.status})]})]})})]}),e.jsxs(S,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Lease Agreements (",v.length,")"]}),e.jsx(W,{children:"Manage lease agreements and tenant assignments for this unit"})]}),e.jsxs(J,{open:U,onOpenChange:y,children:[e.jsx(X,{asChild:!0,children:e.jsxs(l,{"data-testid":"button-add-lease",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"New Lease"]})}),e.jsxs(Y,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsx(_,{children:"Create New Lease"}),e.jsxs(ee,{children:["Create a new lease agreement for Unit ",r.unitNumber]})]}),e.jsx(se,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(k),className:"space-y-4",children:[e.jsx(c,{control:i.control,name:"tenantId",render:({field:s})=>e.jsxs(o,{children:[e.jsx(m,{children:"Tenant"}),e.jsxs(te,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(u,{children:e.jsx(ae,{"data-testid":"select-tenant",children:e.jsx(ne,{placeholder:"Select tenant"})})}),e.jsx(re,{children:b.map(t=>e.jsxs(ie,{value:t.id,children:[t.fullName," (",t.email,")"]},t.id))})]}),e.jsx(x,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:i.control,name:"startDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(m,{children:"Start Date"}),e.jsx(u,{children:e.jsx(f,{type:"date","data-testid":"input-start-date",...s})}),e.jsx(x,{})]})}),e.jsx(c,{control:i.control,name:"endDate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(m,{children:"End Date"}),e.jsx(u,{children:e.jsx(f,{type:"date","data-testid":"input-end-date",...s})}),e.jsx(x,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:i.control,name:"rentAmount",render:({field:s})=>e.jsxs(o,{children:[e.jsx(m,{children:"Monthly Rent (KSh)"}),e.jsx(u,{children:e.jsx(f,{type:"number",placeholder:r.rentAmount,"data-testid":"input-rent-amount",...s})}),e.jsx(x,{})]})}),e.jsx(c,{control:i.control,name:"depositAmount",render:({field:s})=>e.jsxs(o,{children:[e.jsx(m,{children:"Deposit (KSh)"}),e.jsx(u,{children:e.jsx(f,{type:"number",placeholder:"50000","data-testid":"input-deposit-amount",...s})}),e.jsx(x,{})]})})]}),e.jsx(c,{control:i.control,name:"waterRatePerUnit",render:({field:s})=>e.jsxs(o,{children:[e.jsx(m,{children:"Water Rate per Unit (KSh)"}),e.jsx(u,{children:e.jsx(f,{type:"number",step:"0.01","data-testid":"input-water-rate",...s})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:D.isPending,children:"Create Lease"})]})]})})]})]})]}),e.jsx(L,{children:v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No lease agreements"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"This unit is currently vacant. Create a lease agreement to assign a tenant."}),e.jsxs(l,{onClick:()=>y(!0),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Create First Lease"]})]}):e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsx(S,{className:"border",children:e.jsxs(L,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium","data-testid":`tenant-name-${s.id}`,children:s.tenantName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.tenantEmail}),s.tenantPhone&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.tenantPhone})]}),e.jsx(F,{variant:s.status==="active"?"default":"outline","data-testid":`lease-status-${s.id}`,children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"font-medium",children:new Date(s.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-muted-foreground",children:"Monthly Rent"}),e.jsxs("p",{className:"font-medium",children:["KSh ",parseFloat(s.rentAmount).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-muted-foreground",children:"Deposit"}),e.jsxs("p",{className:"font-medium",children:["KSh ",parseFloat(s.depositAmount).toLocaleString()]})]})]}),e.jsx(de,{className:"my-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{h({title:"Lease Details",description:`Viewing details for lease ${s.id}`})},"data-testid":`button-view-lease-${s.id}`,children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),"View"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{h({title:"Edit Lease",description:`Editing lease ${s.id}`})},"data-testid":`button-edit-lease-${s.id}`,children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Edit"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{h({title:"Terminate Lease",description:`Terminating lease ${s.id}`})},"data-testid":`button-terminate-lease-${s.id}`,children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Terminate"]})]})]})},s.id))})})]})]})}export{Ne as LeaseManagement};

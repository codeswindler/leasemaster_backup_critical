import{d as m,j as s,C as j,z as f,A as y,E as v,G as g,K as d,S as G,r as A,s as V,v as W,w as z,av as H,I as N,y as Q,aB as J,x as M,aA as O,B as X}from"./index-BtknkMaH.js";import{r as o}from"./vendor-Dl_IvdXv.js";function _(){const[F,L]=o.useState(""),[r,x]=o.useState([]),[R,q]=o.useState(""),[h,S]=o.useState(""),[p,K]=o.useState(""),[u,w]=o.useState(0),{selectedPropertyId:n,selectedLandlordId:i}=useFilter(),{data:$=[]}=m({queryKey:["/api/properties",i,n],queryFn:async()=>{const e=new URLSearchParams;i&&e.append("landlordId",i),n&&e.append("propertyId",n);const t=`/api/properties${e.toString()?`?${e}`:""}`;return await(await apiRequest("GET",t)).json()}}),{data:E=[]}=m({queryKey:["/api/tenants",n,i],queryFn:async()=>{const e=new URLSearchParams;n&&e.append("propertyId",n),i&&e.append("landlordId",i);const t=`/api/tenants${e.toString()?`?${e}`:""}`;return await(await apiRequest("GET",t)).json()}}),{data:P=[]}=m({queryKey:["/api/units",n,i],queryFn:async()=>{const e=new URLSearchParams;n&&e.append("propertyId",n),i&&e.append("landlordId",i);const t=`/api/units${e.toString()?`?${e}`:""}`;return await(await apiRequest("GET",t)).json()}}),{data:T=[]}=m({queryKey:["/api/leases",n,i],queryFn:async()=>{const e=new URLSearchParams;n&&e.append("propertyId",n),i&&e.append("landlordId",i);const t=`/api/leases${e.toString()?`?${e}`:""}`;return await(await apiRequest("GET",t)).json()}}),k=$.map(e=>({id:e.id,name:e.name,prefix:e.name.split(" ").map(t=>t[0]).join("").substring(0,2).toUpperCase()})),C=[{id:"rent",name:"Rent",amount:"KSh 20,000"},{id:"water",name:"Water (Unit Based)",type:"variable"},{id:"garbage",name:"Garbage Fee",amount:"KSh 500"},{id:"security",name:"Security Fee",amount:"KSh 1,000"}],b=P.map(e=>{const t=T.find(l=>l.unitId===e.id&&l.status==="active"),a=t?E.find(l=>l.id===t.tenantId):null;return{id:e.id,unit:e.unitNumber,tenant:a?a.fullName:"Vacant",type:e.type||"Unknown",rent:t?parseFloat(t.rentAmount):0}}),U=b.filter(e=>e.unit.toLowerCase().includes(p.toLowerCase())||e.tenant.toLowerCase().includes(p.toLowerCase())),c=b.find(e=>e.id===h),B=(e,t)=>{x(t?[...r,e]:r.filter(a=>a!==e))},I=()=>{let e=0;return c&&r.forEach(t=>{t==="rent"?e+=c.rent:t==="water"?e+=u*50:t==="garbage"?e+=500:t==="security"&&(e+=1e3)}),e},D=()=>{if(!h||r.length===0){alert("Please select a unit and at least one charge code");return}console.log("Creating single invoice:",{unit:c,charges:r,waterUnits:u,total:I()}),alert("Invoice created successfully!"),S(""),x([]),w(0)};return s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold","data-testid":"single-invoicing-title",children:"Single Invoicing"}),s.jsx("p",{className:"text-muted-foreground",children:"Create individual invoices for specific tenants"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs(j,{className:"lg:col-span-1",children:[s.jsxs(f,{children:[s.jsx(y,{children:"Invoice Configuration"}),s.jsx(v,{children:"Select property, charges, and date"})]}),s.jsxs(g,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"property",children:"Property"}),s.jsxs(G,{value:F,onValueChange:L,children:[s.jsx(A,{"data-testid":"select-property",children:s.jsx(V,{placeholder:"Select property"})}),s.jsx(W,{children:k.map(e=>s.jsx(z,{value:e.id,children:e.name},e.id))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{children:"Charge Codes"}),s.jsx("div",{className:"space-y-2",children:C.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(H,{id:e.id,checked:r.includes(e.id),onCheckedChange:t=>B(e.id,!!t),"data-testid":`checkbox-${e.id}`}),s.jsx(d,{htmlFor:e.id,className:"flex-1 cursor-pointer",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:e.name}),e.amount&&s.jsx("span",{className:"text-muted-foreground font-mono text-sm",children:e.amount})]})})]},e.id))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"invoice-date",children:"Invoice Date"}),s.jsx(N,{id:"invoice-date",type:"date",value:R,onChange:e=>q(e.target.value),"data-testid":"input-invoice-date"})]})]})]}),s.jsxs(j,{children:[s.jsxs(f,{children:[s.jsx(y,{children:"Select Unit"}),s.jsx(v,{children:"Search and select the tenant unit"})]}),s.jsxs(g,{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"unit-search",children:"Search Units"}),s.jsx(N,{id:"unit-search",placeholder:"Type unit or tenant name...",value:p,onChange:e=>K(e.target.value),"data-testid":"input-unit-search"})]}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:U.map(e=>s.jsx("div",{className:`p-3 border rounded-lg cursor-pointer hover-elevate ${h===e.id?"ring-2 ring-primary bg-primary/5":""}`,onClick:()=>S(e.id),"data-testid":`unit-option-${e.id}`,children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.unit}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.tenant}),s.jsx("p",{className:"text-xs text-muted-foreground",children:e.type})]}),s.jsxs(Q,{variant:"outline",className:"font-mono text-xs",children:["KSh ",e.rent.toLocaleString()]})]})},e.id))}),U.length===0&&p&&s.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[s.jsx(J,{className:"h-8 w-8 mx-auto mb-2"}),s.jsxs("p",{children:['No units found matching "',p,'"']})]})]})]}),s.jsxs(j,{children:[s.jsxs(f,{children:[s.jsx(y,{children:"Invoice Details"}),s.jsx(v,{children:"Review and customize the invoice"})]}),s.jsx(g,{className:"space-y-4",children:c?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[s.jsxs("h4",{className:"font-medium",children:[c.unit," - ",c.tenant]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:c.type})]}),r.includes("water")&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"water-units",children:"Water Units"}),s.jsx(N,{id:"water-units",type:"number",value:u,onChange:e=>w(parseInt(e.target.value)||0),placeholder:"Enter water units used","data-testid":"input-water-units"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Rate: KSh 50 per unit"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium",children:"Invoice Breakdown"}),s.jsx("div",{className:"space-y-1 text-sm",children:r.map(e=>{const t=C.find(l=>l.id===e);if(!t)return null;let a=0;return e==="rent"?a=c.rent:e==="water"?a=u*50:e==="garbage"?a=500:e==="security"&&(a=1e3),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:[t.name,":"]}),s.jsxs("span",{className:"font-mono",children:["KSh ",a.toLocaleString()]})]},e)})}),r.length>0&&s.jsx("div",{className:"pt-2 border-t",children:s.jsxs("div",{className:"flex justify-between font-medium",children:[s.jsx("span",{children:"Total:"}),s.jsxs("span",{className:"font-mono",children:["KSh ",I().toLocaleString()]})]})})]}),s.jsxs(M,{onClick:D,className:"w-full",disabled:r.length===0,"data-testid":"button-submit-invoice",children:[s.jsx(O,{className:"h-4 w-4 mr-2"}),"Submit Invoice"]})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(X,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a Unit"}),s.jsx("p",{className:"text-muted-foreground",children:"Search and select a unit to create an invoice"})]})})]})]})]})}export{_ as SingleInvoicing};

import{b as C,u as S,j as e,C as d,z as o,A as x,E as m,d as _,S as L,r as R,s as E,v as T,w as l,x as k,a6 as A,G as F,aA as u,aK as P,aq as h,y as a,a0 as B}from"./index-D3-Phv8z.js";import{r as D}from"./vendor-BBpupLJz.js";import{F as M,R as j}from"./refresh-cw-Dshf7di6.js";function z(){const{selectedPropertyId:t}=C(),[,p]=S(),[r,g]=D.useState("all");if(!t||t==="all")return e.jsx("div",{className:"p-6",children:e.jsx(d,{children:e.jsxs(o,{children:[e.jsx(x,{children:"Email Outbox"}),e.jsx(m,{children:"Select a property to view messages."})]})})});const{data:n=[],isLoading:f,refetch:N}=_({queryKey:["/api/message-recipients","email",t,r],queryFn:async()=>{const s=new URLSearchParams;s.append("channel","email"),t&&s.append("propertyId",t),r!=="all"&&s.append("category",r);const c=`/api/message-recipients?${s.toString()}`;return await(await B("GET",c)).json()}}),v=s=>{switch(s){case"delivered":return e.jsx(h,{className:"h-4 w-4 text-green-500"});case"sent":return e.jsx(h,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(u,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(P,{className:"h-4 w-4 text-red-500"});default:return e.jsx(u,{className:"h-4 w-4 text-gray-500"})}},b=s=>{switch(s){case"delivered":return e.jsx(a,{variant:"default",className:"bg-green-100 text-green-800",children:"Delivered"});case"sent":return e.jsx(a,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Sent"});case"pending":return e.jsx(a,{variant:"secondary",children:"Pending"});case"failed":return e.jsx(a,{variant:"destructive",children:"Failed"});default:return e.jsx(a,{variant:"outline",children:"Unknown"})}},y=s=>{const i={manual:{label:"Manual",variant:"outline"},otp:{label:"OTP",variant:"secondary"},login_credentials:{label:"Login Credentials",variant:"secondary"},password_reset:{label:"Password Reset",variant:"secondary"},welcome_email:{label:"Welcome",variant:"secondary"}}[s]||{label:s,variant:"outline"};return e.jsx(a,{variant:i.variant,children:i.label})},w=s=>s==="landlord"?e.jsx(a,{variant:"outline",className:"bg-purple-50 text-purple-700",children:"Landlord"}):e.jsx(a,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Tenant"});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"email-outbox-title",children:"Email Outbox"}),e.jsx("p",{className:"text-muted-foreground",children:"Track email delivery status and history"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(L,{value:r,onValueChange:g,children:[e.jsx(R,{className:"w-[180px]",children:e.jsx(E,{placeholder:"All Categories"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"All Categories"}),e.jsx(l,{value:"manual",children:"Manual"}),e.jsx(l,{value:"login_credentials",children:"Login Credentials"}),e.jsx(l,{value:"password_reset",children:"Password Reset"}),e.jsx(l,{value:"welcome_email",children:"Welcome"})]})]})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>N(),children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Email Messages"]}),e.jsxs(m,{children:[n.length," email(s) found"]})]}),e.jsx(F,{children:f?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No email messages found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Delivery Status"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Recipient"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Category"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Subject"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Sent At"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50 cursor-pointer",onClick:()=>p(`/message-details/${s.id}`),children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.status),b(s.status)]})}),e.jsx("td",{className:"p-2 text-sm",children:e.jsx("span",{className:"text-muted-foreground text-xs",children:"Not Available"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.recipient_name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.recipient_contact})]})}),e.jsx("td",{className:"p-2",children:w(s.recipient_type)}),e.jsx("td",{className:"p-2",children:y(s.message_category)}),e.jsx("td",{className:"p-2 max-w-xs",children:e.jsx("p",{className:"text-sm truncate",title:s.subject,children:s.subject||"No Subject"})}),e.jsx("td",{className:"p-2 text-sm text-muted-foreground",children:s.sent_at?new Date(s.sent_at).toLocaleString():"Pending"})]},s.id))})]})})})]})]})}export{z as MessagingEmailOutbox};

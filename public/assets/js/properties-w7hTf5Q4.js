import{c as be,u as Ie,a as Pe,b as ke,d as Z,e as ue,t as pe,f as $,q as u,j as e,D as Q,g as R,h as X,i as z,k as B,F as xe,l as y,m as g,n as f,o as N,I as v,p as w,S as Te,r as Ue,s as qe,v as Oe,w as oe,B as L,P as ce,x as n,L as C,y as me,T as Ve,C as Me,z as $e,A as Ke,E as Qe,G as Re,H as Xe,J as Ne,K as F,U as ze,M as Be,N as Ge,O as He,Q as We,R as Je,V as Ye,W as _e,X as Ze,Y as es,Z as ss,_ as as,$ as ts,a0 as j}from"./index-BtknkMaH.js";import{r as x,H as G}from"./vendor-Dl_IvdXv.js";import{i as ve}from"./schema-yUJfXApV.js";import{M as we}from"./map-pin-BiMmByZC.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=be("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=be("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function ms(){const[H,ee]=x.useState(""),[I,S]=x.useState(!1),[t,k]=x.useState(null),[se,i]=x.useState(!1),[he,h]=x.useState(!1),[ae,W]=x.useState(!1),[Ce,te]=x.useState(null),[Se,J]=x.useState(!1),[,T]=Ie(),{toast:d}=Pe(),{selectedPropertyId:U,selectedLandlordId:c,clearFilters:je}=ke(),{data:ye}=Z({queryKey:["/api/auth/check"],queryFn:async()=>await(await j("GET","/api/auth/check")).json()}),Y=ye?.authenticated?ye.user:null,b=Y?.role==="admin"||Y?.role==="super_admin",E=ue({resolver:pe(ve.pick({name:!0,address:!0,landlordName:!0})),defaultValues:{name:"",address:"",landlordName:""}}),re=$({mutationFn:async s=>j("PUT",`/api/properties/${s.id}`,{name:s.name,address:s.address,landlordName:s.landlordName}),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/properties"]}),W(!1),d({title:"Property Updated",description:"Property details have been saved successfully."})},onError:s=>{d({title:"Error",description:s.message||"Failed to update property",variant:"destructive"})}}),ne=$({mutationFn:async s=>(te(s),j("POST",`/api/properties/${s}/disable`)),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/properties"]}),u.invalidateQueries({queryKey:["/api/units"]}),te(null),d({title:"Property Disabled",description:"Property has been disabled and all leases suspended."})},onError:s=>{te(null),d({title:"Error",description:s.message||"Failed to disable property",variant:"destructive"})}}),ie=$({mutationFn:async s=>j("POST",`/api/properties/${s}/enable`),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/properties"]}),u.invalidateQueries({queryKey:["/api/units"]}),d({title:"Property Enabled",description:"Property has been enabled and all leases resumed."})},onError:s=>{d({title:"Error",description:s.message||"Failed to enable property",variant:"destructive"})}}),le=$({mutationFn:async s=>j("DELETE",`/api/properties/${s}`),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/properties"]}),d({title:"Property Deleted",description:"Property has been deleted successfully."})},onError:s=>{d({title:"Error",description:s.message||"Failed to delete property",variant:"destructive"})}});x.useEffect(()=>{t&&ae&&E.reset({name:t.name||"",address:t.address||"",landlordName:t.landlordName||""})},[t,ae,E]);const{data:q=[],isLoading:_,error:O}=Z({queryKey:["/api/properties",c,U],queryFn:async()=>{try{let s="/api/properties";const a=new URLSearchParams;c&&a.append("landlordId",c),U&&a.append("propertyId",U),a.toString()&&(s+=`?${a.toString()}`);const o=await(await j("GET",s)).json();return(Array.isArray(o)?o:[]).map(p=>!p||typeof p!="object"||!p.id?null:p).filter(Boolean)}catch(s){throw console.error("Error fetching properties:",s),s}},staleTime:5*60*1e3,retry:1}),{data:ge=[]}=Z({queryKey:["/api/units",U,c],queryFn:async()=>{const s=new URLSearchParams;U&&s.append("propertyId",U),c&&s.append("landlordId",c);const a=`/api/units${s.toString()?`?${s}`:""}`;return await(await j("GET",a)).json()},staleTime:0}),{data:de=[],refetch:Ee}=Z({queryKey:["/api/landlords"],queryFn:async()=>await(await j("GET","/api/landlords")).json()}),m=ue({resolver:pe(ve),defaultValues:{name:"",address:"",landlordId:"",landlordName:"",landlordPhone:"",landlordEmail:""}});x.useEffect(()=>{I&&c?m.setValue("landlordId",c):I&&!c&&m.setValue("landlordId","all")},[I,c,m]);const D=$({mutationFn:async s=>{if(!s.name||!s.address)throw new Error("Property name and address are required");return await(await j("POST","/api/properties",s)).json()},onMutate:async s=>(await u.cancelQueries({queryKey:["/api/properties"]}),{previousProperties:u.getQueryData(["/api/properties"])}),onSuccess:s=>{u.setQueryData(["/api/properties"],a=>Array.isArray(a)?[...a,s]:[s]),u.invalidateQueries({queryKey:["/api/properties"]}),d({title:"Success",description:"Property created successfully"}),S(!1),m.reset()},onError:(s,a,r)=>{console.error("Property creation failed:",s),r?.previousProperties&&u.setQueryData(["/api/properties"],r.previousProperties);let o="Failed to create property. Please try again.";if(s?.message){const P=s.message,K=P.match(/\d+:\s*({.*})/);if(K)try{const p=JSON.parse(K[1]);o=p.error||p.message||o}catch{const p=P.split(":");o=p.length>1?p.slice(1).join(":").trim():P}else o=P}d({title:"Error",description:o,variant:"destructive"})},onSettled:()=>{u.invalidateQueries({queryKey:["/api/properties"]})}}),V=Array.isArray(q)?q.map(s=>{if(!s||typeof s!="object")return console.warn("Invalid property in properties array:",s),null;const a={id:s.id||"",name:s.name||"Unnamed Property",address:s.address||"No Address",landlordName:s.landlordName||"Unknown Landlord",landlordPhone:s.landlordPhone||"",landlordEmail:s.landlordEmail||"",status:s.status||"active",createdAt:s.createdAt||new Date().toISOString(),...s},r=Array.isArray(ge)?ge.filter(l=>l.propertyId===a.id):[],o=r.filter(l=>l.status==="occupied").length,P=r.length,K=r.reduce((l,M)=>{const A=M.type||"Unknown";return l[A]||(l[A]={type:A,count:0,prices:[]}),l[A].count++,l[A].prices.push(parseFloat(M.rentAmount)||0),l},{}),p=Object.values(K).map(l=>{const M=l.prices.length>0?Math.round(l.prices.reduce((A,Fe)=>A+Fe,0)/l.prices.length):0;return{type:l.type,count:l.count,price:`KSh ${M.toLocaleString()}`}}),Le=r.filter(l=>l.status==="occupied").reduce((l,M)=>l+(parseFloat(M.rentAmount)||0),0);return{...a,totalUnits:P,occupiedUnits:o,monthlyRevenue:`KSh ${Le.toLocaleString()}`,unitTypes:p}}).filter(Boolean):[],De=V.filter(s=>{if(!s||typeof s!="object")return console.warn("Invalid property object:",s),!1;const a=H.toLowerCase(),r=String(s.name||"").toLowerCase(),o=String(s.landlordName||"").toLowerCase(),P=String(s.address||"").toLowerCase();return r.includes(a)||o.includes(a)||P.includes(a)});x.useEffect(()=>{u.invalidateQueries({queryKey:["/api/properties"]})},[]),_?console.log("ðŸ“¡ Loading properties..."):O?console.error("âŒ Error loading properties:",O):console.log(`âœ… Properties loaded: ${V.length} properties`);const fe=s=>{if(!s.name?.trim()){d({title:"Validation Error",description:"Property name is required",variant:"destructive"});return}if(!s.address?.trim()){d({title:"Validation Error",description:"Property address is required",variant:"destructive"});return}const a=s.landlordId==="all"?"":s.landlordId,r=c||a||(Y&&!b?Y.id:null);if(!r){d(b?{title:"Validation Error",description:"Please select a landlord or create a new one",variant:"destructive"}:{title:"Validation Error",description:"Unable to determine landlord. Please try again.",variant:"destructive"});return}const o={name:s.name,address:s.address,landlordId:r,...s.landlordName&&{landlordName:s.landlordName},...s.landlordPhone&&{landlordPhone:s.landlordPhone},...s.landlordEmail&&{landlordEmail:s.landlordEmail}};D.mutate(o)},Ae=()=>{const s=m.getValues();if(!s.name?.trim()){d({title:"Validation Error",description:"Property name is required",variant:"destructive"});return}if(!s.address?.trim()){d({title:"Validation Error",description:"Property address is required",variant:"destructive"});return}D.mutate(s,{onSuccess:a=>{setTimeout(()=>{T("/houses?property=new")},500)},onError:a=>{}})};return e.jsxs("div",{className:"p-6 space-y-6",children:[b&&e.jsx(Q,{open:I,onOpenChange:S,children:e.jsxs(R,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto p-8",children:[e.jsxs(X,{children:[e.jsx(z,{children:"Add New Property"}),e.jsx(B,{children:"Create a new property and configure its details."})]}),e.jsx(xe,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(fe),className:"space-y-6",children:[e.jsx(y,{control:m.control,name:"name",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Property Name"}),e.jsx(N,{children:e.jsx(v,{placeholder:"e.g., Sunset Apartments","data-testid":"input-property-name",...s})}),e.jsx(w,{})]})}),e.jsx(y,{control:m.control,name:"address",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Address"}),e.jsx(N,{children:e.jsx(v,{placeholder:"e.g., 123 Westlands Road, Nairobi","data-testid":"input-address",...s})}),e.jsx(w,{})]})}),e.jsx(y,{control:m.control,name:"landlordId",render:({field:s})=>e.jsxs(g,{children:[e.jsxs(f,{children:["Landlord ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{children:e.jsxs(Te,{onValueChange:a=>{if(a==="create-new")J(!0);else if(a==="all")s.onChange(""),setSelectedLandlordId(null);else{s.onChange(a),setSelectedLandlordId(a);const r=de.find(o=>o.id===a);r&&m.setValue("landlordEmail",r.username||"")}},value:s.value||"all",children:[e.jsx(Ue,{children:e.jsx(qe,{placeholder:"Select landlord or create new"})}),e.jsxs(Oe,{children:[b&&e.jsx(oe,{value:"all",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"All Landlords"]})}),!c&&b&&e.jsx(oe,{value:"create-new",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Create New Landlord"]})}),Array.isArray(de)&&de.map(a=>e.jsx(oe,{value:a.id,children:a.username||a.id},a.id))]})]})}),e.jsx(w,{})]})})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>S(!1),disabled:D.isPending,children:"Cancel"}),e.jsxs(n,{type:"button",variant:"outline","data-testid":"button-save-close-property",disabled:D.isPending,onClick:()=>fe(m.getValues()),children:[D.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Save and Close"]}),e.jsxs(n,{type:"button","data-testid":"button-save-add-units-property",disabled:D.isPending,onClick:Ae,children:[D.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Save and Add Houses"]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"properties-title",children:"Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your rental properties and units"})]}),b&&V.length>0&&e.jsxs(n,{onClick:()=>S(!0),"data-testid":"button-add-property",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Property"]})]}),e.jsx(Q,{open:Se,onOpenChange:J,children:e.jsxs(R,{className:"sm:max-w-[500px]",children:[e.jsxs(X,{children:[e.jsx(z,{children:"Create New Landlord"}),e.jsx(B,{children:"Create a new landlord account. Credentials will be sent via email and SMS."})]}),e.jsx(is,{onSuccess:s=>{J(!1),Ee(),m.setValue("landlordId",s.id),m.setValue("landlordEmail",s.username),d({title:"Landlord Created",description:`Landlord account created. Credentials sent to ${s.username}. Temporary password: ${s.tempPassword||"Check email"}`})},onCancel:()=>J(!1)})]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(v,{placeholder:"Search properties...",value:H,onChange:s=>ee(s.target.value),className:"max-w-sm","data-testid":"input-search-properties"}),b&&c&&e.jsxs(n,{variant:"outline",onClick:()=>{je()},className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"View All Properties"]}),b&&c&&e.jsxs(me,{variant:"secondary",className:"flex items-center gap-2",children:["Filtered by landlord",e.jsx(n,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0",onClick:()=>je(),children:"Ã—"})]})]})]}),_&&e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Loading properties..."})]}),O&&e.jsxs("div",{className:"flex items-center justify-center py-20 text-destructive",children:[e.jsx(Ve,{className:"h-6 w-6 mr-2"}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{children:"Failed to load properties"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:O?.message||"Unknown error occurred"})]})]}),!_&&!O&&V.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-muted-foreground",children:[e.jsx(L,{className:"h-12 w-12 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No properties found"}),b&&e.jsxs(n,{onClick:()=>S(!0),className:"mt-4",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Property"]}),e.jsx("p",{className:"text-center max-w-md mt-4",children:'Get started by creating your first property. Click the "Add Property" button below.'})]}),!_&&!O&&V.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:De.map(s=>e.jsxs(Me,{className:`hover-elevate relative ${s.status==="inactive"?"opacity-60 bg-muted/30":""} ${Ce===s.id?"animate-pulse":""}`,children:[e.jsx($e,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:e.jsx(L,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(Ke,{className:"text-lg cursor-pointer hover:text-primary transition-colors",onClick:()=>T(`/houses?property=${s.id}`),children:s.name}),e.jsxs(Qe,{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),s.address]})]})]}),e.jsx(me,{variant:s.status==="active"?"default":"destructive","data-testid":`status-${s.name.toLowerCase().replace(/\s+/g,"-")}`,children:s.status==="inactive"?"SUSPENDED":s.status})]})}),e.jsxs(Re,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Landlord"}),e.jsx("p",{className:"font-medium",children:s.landlordName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Occupancy"}),e.jsxs("p",{className:"font-medium",children:[s.occupiedUnits,"/",s.totalUnits," units"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Monthly Revenue"}),e.jsx("p",{className:"font-medium font-mono",children:s.monthlyRevenue})]})]}),s.unitTypes&&s.unitTypes.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Unit Types"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:s.unitTypes.map((a,r)=>e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-muted/50 rounded",children:[e.jsxs("span",{children:[a.type," (",a.count," units)"]}),e.jsx("span",{className:"font-mono text-muted-foreground",children:a.price})]},r))})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>T(`/houses?property=${s.id}`),"data-testid":`button-view-${s.name.toLowerCase().replace(/\s+/g,"-")}`,children:[e.jsx(Xe,{className:"h-4 w-4 mr-1"}),"View Details"]}),e.jsx(n,{variant:s.status==="inactive"?"default":"outline",size:"sm",className:"flex-1",onClick:()=>{V.some(r=>r.id===s.id)?(k(s),h(!0)):(d({title:"Property Not Found",description:"This property may have been deleted or is not accessible with the current filter.",variant:"destructive"}),setSelectedPropertyId(null))},"data-testid":`button-manage-${s.name.toLowerCase().replace(/\s+/g,"-")}`,children:s.status==="inactive"?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"h-4 w-4 mr-1"}),"Activate"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Manage"]})})]}),s.status==="inactive"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"text-6xl font-bold text-muted-foreground/20 rotate-12 select-none",children:"SUSPENDED"})})]})]},s.id))}),e.jsx(Q,{open:se,onOpenChange:i,children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs(X,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),t?(Array.isArray(q)&&q.find(s=>s.id===t.id)||t)?.name:""]}),e.jsx(B,{children:"Detailed property information"})]}),t&&(()=>{const s=Array.isArray(q)&&q.find(a=>a.id===t.id)||t;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Property Name"}),e.jsx("p",{className:"text-sm",children:s.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Status"}),e.jsx(me,{variant:s.status==="active"?"default":"secondary",children:s.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Address"}),e.jsx("p",{className:"text-sm",children:s.address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Landlord"}),e.jsx("p",{className:"text-sm",children:s.landlordName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Occupancy"}),e.jsxs("p",{className:"text-sm",children:[s.occupiedUnits,"/",s.totalUnits," units"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Monthly Revenue"}),e.jsx("p",{className:"text-sm font-mono",children:s.monthlyRevenue})]})]}),s.unitTypes&&s.unitTypes.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(F,{className:"text-sm font-medium",children:"Unit Types"}),e.jsx("div",{className:"space-y-2",children:s.unitTypes.map((a,r)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-md",children:[e.jsx("span",{className:"font-medium",children:a.type}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm",children:[a.count," units"]}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:a.price})]})]},r))})]})]})})()]})}),e.jsx(Q,{open:he,onOpenChange:h,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs(X,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Manage ",t?.name]}),e.jsx(B,{children:"Property management options"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsxs(n,{variant:"outline",className:"justify-start",onClick:()=>{h(!1),W(!0)},"data-testid":"button-edit-property",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Edit Property Details"]}),e.jsxs(n,{variant:"outline",className:"justify-start",onClick:()=>{h(!1),T(`/accounting/water-units?property=${t?.id}`)},"data-testid":"button-view-units",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"View Units"]}),e.jsxs(n,{variant:"outline",className:"justify-start",onClick:()=>{h(!1),T(`/tenants?property=${t?.id}`)},"data-testid":"button-view-tenants",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"View Tenants"]}),e.jsxs(n,{variant:"outline",className:"justify-start",onClick:()=>{h(!1),T(`/reports?property=${t?.id}`)},"data-testid":"button-financial-reports",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Financial Reports"]}),t?.status==="active"?e.jsxs(n,{variant:"outline",className:"justify-start",onClick:()=>{ne.mutate(t.id),h(!1)},disabled:ne.isPending,"data-testid":"button-disable-property",children:[ne.isPending?e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Disable Property"]}):e.jsxs(n,{variant:"outline",className:"justify-start",onClick:()=>{ie.mutate(t.id),h(!1)},disabled:ie.isPending,"data-testid":"button-enable-property",children:[ie.isPending?e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Enable Property"]}),e.jsxs(He,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(n,{variant:"destructive",className:"justify-start","data-testid":"button-delete-property",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Delete Property"]})}),e.jsxs(Ye,{children:[e.jsxs(_e,{children:[e.jsx(Ze,{children:"Delete Property"}),e.jsxs(es,{children:['Are you sure you want to delete "',t?.name,'"? This action cannot be undone.',t?.occupiedUnits>0&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Warning:"})," This property has ",t.occupiedUnits," occupied unit(s). You must terminate all active leases before deleting this property."]})})]})]}),e.jsxs(ss,{children:[e.jsx(as,{children:"Cancel"}),e.jsx(ts,{onClick:()=>{t&&le.mutate(t.id),h(!1)},disabled:le.isPending||t?.occupiedUnits>0,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:le.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Property"})]})]})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsx(n,{variant:"secondary",className:"w-full",onClick:()=>h(!1),children:"Close"})})]})]})}),e.jsx(Q,{open:ae,onOpenChange:W,children:e.jsxs(R,{className:"max-w-md",children:[e.jsxs(X,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Edit ",t?.name]}),e.jsx(B,{children:"Update property information"})]}),t&&e.jsx(xe,{...E,children:e.jsxs("form",{onSubmit:E.handleSubmit(s=>{re.mutate({id:t.id,...s})}),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{control:E.control,name:"name",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Property Name"}),e.jsx(N,{children:e.jsx(v,{...s,"data-testid":"input-edit-property-name"})}),e.jsx(w,{})]})}),e.jsx(y,{control:E.control,name:"address",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Address"}),e.jsx(N,{children:e.jsx(v,{...s,"data-testid":"input-edit-property-address"})}),e.jsx(w,{})]})}),e.jsx(y,{control:E.control,name:"landlordName",render:({field:s})=>e.jsxs(g,{children:[e.jsx(f,{children:"Landlord Name"}),e.jsx(N,{children:e.jsx(v,{...s,"data-testid":"input-edit-landlord-name"})}),e.jsx(w,{})]})})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsx(n,{type:"button",variant:"outline",className:"flex-1",onClick:()=>W(!1),children:"Cancel"}),e.jsx(n,{type:"submit",className:"flex-1",disabled:re.isPending,"data-testid":"button-save-property",children:re.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})})]})}function is({onSuccess:H,onCancel:ee}){const{toast:I}=Pe(),S=G.object({username:G.string().email("Invalid email address"),fullName:G.string().min(1,"Full name is required"),phone:G.string().min(1,"Phone is required"),idNumber:G.string().optional()}),t=ue({resolver:pe(S),defaultValues:{username:"",fullName:"",phone:"",idNumber:""}}),k=$({mutationFn:async i=>await(await j("POST","/api/landlords",{username:i.username,fullName:i.fullName,phone:i.phone,idNumber:i.idNumber||void 0})).json(),onSuccess:i=>{u.invalidateQueries({queryKey:["/api/landlords"]}),H(i),t.reset()},onError:i=>{I({title:"Error",description:i.message||"Failed to create landlord",variant:"destructive"})}}),se=i=>{k.mutate(i)};return e.jsx(xe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(se),className:"space-y-4",children:[e.jsx(y,{control:t.control,name:"username",render:({field:i})=>e.jsxs(g,{children:[e.jsxs(f,{children:["Username (Email) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{children:e.jsx(v,{type:"email",placeholder:"landlord@email.com",...i})}),e.jsx(w,{})]})}),e.jsx(y,{control:t.control,name:"fullName",render:({field:i})=>e.jsxs(g,{children:[e.jsxs(f,{children:["Full Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{children:e.jsx(v,{placeholder:"Landlord Full Name",...i})}),e.jsx(w,{})]})}),e.jsx(y,{control:t.control,name:"phone",render:({field:i})=>e.jsxs(g,{children:[e.jsxs(f,{children:["Phone ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{children:e.jsx(v,{type:"tel",placeholder:"+254 7XX XXX XXX",...i})}),e.jsx(w,{})]})}),e.jsx(y,{control:t.control,name:"idNumber",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:"Identification Number (Optional)"}),e.jsx(N,{children:e.jsx(v,{placeholder:"ID Number",...i})}),e.jsx(w,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:ee,disabled:k.isPending,children:"Cancel"}),e.jsxs(n,{type:"submit",disabled:k.isPending,children:[k.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Landlord"]})]})]})})}export{ms as Properties};

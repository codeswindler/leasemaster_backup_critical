import{b as B,u as V,d as q,j as e,S as $,r as z,s as G,v as H,w as d,I as l,x as f,a0 as S,D as J,a3 as K,g as Q,h as W,i as X,K as m,aG as Y,C as Z,z as ee,A as se,a2 as ae,E as te,G as re,y as t,aC as y,aH as ne,au as b}from"./index-BtknkMaH.js";import{r}from"./vendor-Dl_IvdXv.js";import{F as le,R as w}from"./refresh-cw-B_4VM2wj.js";function oe(){const{selectedPropertyId:n}=B(),[,C]=V(),[o,E]=r.useState("all"),[x,D]=r.useState(""),[p,L]=r.useState(""),[h,R]=r.useState(""),[u,F]=r.useState(""),[j,T]=r.useState(""),[g,_]=r.useState(""),{data:v=[],isLoading:I,refetch:U}=q({queryKey:["/api/message-recipients","sms",n,o,x,p],queryFn:async()=>{const s=new URLSearchParams;s.append("channel","sms"),n&&s.append("propertyId",n),o!=="all"&&s.append("category",o),x&&s.append("search",x),p&&s.append("sender",p);const a=`/api/message-recipients?${s.toString()}`;return await(await S("GET",a)).json()}}),M=s=>{switch(s){case"delivered":return e.jsx(b,{className:"h-4 w-4 text-green-500"});case"sent":return e.jsx(b,{className:"h-4 w-4 text-blue-500"});case"pending":return e.jsx(y,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(ne,{className:"h-4 w-4 text-red-500"});default:return e.jsx(y,{className:"h-4 w-4 text-gray-500"})}},P=s=>{switch(s){case"delivered":return e.jsx(t,{variant:"default",className:"bg-green-100 text-green-800",children:"Delivered"});case"sent":return e.jsx(t,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Sent"});case"pending":return e.jsx(t,{variant:"secondary",children:"Pending"});case"failed":return e.jsx(t,{variant:"destructive",children:"Failed"});default:return e.jsx(t,{variant:"outline",children:"Unknown"})}},k=s=>{if(s.delivery_status){const a=String(s.delivery_status).toUpperCase();if(["DELIVRD","DELIVERED","SUCCESS","SUCCESSFUL"].includes(a))return"delivered";if(["UNDELIV","FAILED","REJECTD","REJECTED","FAIL","EXPIRED"].includes(a))return"failed"}return s.status||"pending"},A=s=>{const i={manual:{label:"Manual",variant:"outline"},otp:{label:"OTP",variant:"secondary"},login_credentials:{label:"Login Credentials",variant:"secondary"},password_reset:{label:"Password Reset",variant:"secondary"},welcome_email:{label:"Welcome",variant:"secondary"}}[s]||{label:s,variant:"outline"};return e.jsx(t,{variant:i.variant,children:i.label})},O=s=>s==="landlord"?e.jsx(t,{variant:"outline",className:"bg-purple-50 text-purple-700",children:"Landlord"}):e.jsx(t,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Tenant"});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"sms-outbox-title",children:"SMS Outbox"}),e.jsx("p",{className:"text-muted-foreground",children:"Track SMS delivery status and history"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs($,{value:o,onValueChange:E,children:[e.jsx(z,{className:"w-[180px]",children:e.jsx(G,{placeholder:"All Categories"})}),e.jsxs(H,{children:[e.jsx(d,{value:"all",children:"All Categories"}),e.jsx(d,{value:"manual",children:"Manual"}),e.jsx(d,{value:"otp",children:"OTP"}),e.jsx(d,{value:"login_credentials",children:"Login Credentials"}),e.jsx(d,{value:"password_reset",children:"Password Reset"})]})]})]}),e.jsx(l,{placeholder:"Search mobile or name",value:x,onChange:s=>D(s.target.value),className:"w-[220px]"}),e.jsx(l,{placeholder:"Sender shortcode",value:p,onChange:s=>L(s.target.value),className:"w-[180px]"}),e.jsxs(f,{variant:"outline",size:"sm",onClick:async()=>{await S("POST","/api/sms-dlr-refresh",{propertyId:n||null}),U()},children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"sm",children:"Export"})}),e.jsxs(Q,{children:[e.jsx(W,{children:e.jsx(X,{children:"Export SMS Report"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"export-from",children:"From (required)"}),e.jsx(l,{id:"export-from",type:"date",value:h,onChange:s=>R(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"export-to",children:"To (required)"}),e.jsx(l,{id:"export-to",type:"date",value:u,onChange:s=>F(s.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"export-search",children:"Mobile (optional)"}),e.jsx(l,{id:"export-search",value:j,onChange:s=>T(s.target.value),placeholder:"Mobile or name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"export-sender",children:"Sender (optional)"}),e.jsx(l,{id:"export-sender",value:g,onChange:s=>_(s.target.value),placeholder:"Shortcode"})]})]})]}),e.jsx(Y,{children:e.jsx(f,{onClick:async()=>{const s=new URLSearchParams;s.append("channel","sms"),s.append("dateFrom",h),s.append("dateTo",u),j&&s.append("search",j),g&&s.append("sender",g),n&&s.append("propertyId",n);const i=await(await fetch(`/api/message-export?${s.toString()}`,{credentials:"include"})).blob(),N=window.URL.createObjectURL(i),c=document.createElement("a");c.href=N,c.download=`sms-export-${h}-to-${u}.csv`,document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(N)},disabled:!h||!u,children:"Download CSV"})})]})]})]})]}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"SMS Messages"]}),e.jsxs(te,{children:[v.length," message(s) found"]})]}),e.jsx(re,{children:I?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(w,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):v.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No SMS messages found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Delivery Status"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Recipient"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Type"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Category"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Sender"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Message"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Sent At"})]})}),e.jsx("tbody",{children:v.map(s=>(()=>{const a=k(s);return e.jsxs("tr",{className:"border-b hover:bg-muted/50 cursor-pointer",onClick:()=>C(`/message-details/${s.id}`),children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[M(a),P(a)]})}),e.jsx("td",{className:"p-2 text-sm",children:s.delivery_status?e.jsx(t,{variant:"outline",className:"text-xs",children:s.delivery_status}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"Pending DLR"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.recipient_name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.recipient_contact})]})}),e.jsx("td",{className:"p-2",children:O(s.recipient_type)}),e.jsx("td",{className:"p-2",children:A(s.message_category)}),e.jsx("td",{className:"p-2 text-sm",children:s.sender_shortcode||e.jsx("span",{className:"text-muted-foreground text-xs",children:"N/A"})}),e.jsx("td",{className:"p-2 max-w-xs",children:e.jsx("p",{className:"text-sm truncate",title:s.content,children:s.content||"N/A"})}),e.jsx("td",{className:"p-2 text-sm text-muted-foreground",children:s.sent_at?new Date(s.sent_at).toLocaleString():"Pending"})]},s.id)})())})]})})})]})]})}export{oe as MessagingSmsOutbox};

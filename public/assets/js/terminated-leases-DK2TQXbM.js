import{b as P,a as C,d as p,f as D,j as t,C as U,z as R,A as $,G as E,aa as F,ab as z,ac as j,ad as i,ae as _,af as d,y as K,x as k,a0 as c,q as w}from"./index-D3-Phv8z.js";import"./vendor-BBpupLJz.js";function B(){const{selectedPropertyId:l,selectedLandlordId:s}=P(),{toast:m}=C(),h=!l,a=l&&l!=="all"?l:null,I=e=>String(e??"").trim().toLowerCase(),{data:N=[]}=p({queryKey:["/api/leases",a,s],queryFn:async()=>{const e=new URLSearchParams;a&&e.append("propertyId",a),s&&e.append("landlordId",s);const n=`/api/leases${e.toString()?`?${e}`:""}`;return await(await c("GET",n)).json()}}),{data:v=[]}=p({queryKey:["/api/units",a,s],queryFn:async()=>{const e=new URLSearchParams;a&&e.append("propertyId",a),s&&e.append("landlordId",s);const n=`/api/units${e.toString()?`?${e}`:""}`;return await(await c("GET",n)).json()}}),{data:T=[]}=p({queryKey:["/api/tenants",a,s],queryFn:async()=>{const e=new URLSearchParams;a&&e.append("propertyId",a),s&&e.append("landlordId",s);const n=`/api/tenants${e.toString()?`?${e}`:""}`;return await(await c("GET",n)).json()}}),{data:b=[]}=p({queryKey:["/api/properties",s,a],queryFn:async()=>{const e=new URLSearchParams;s&&e.append("landlordId",s),a&&e.append("propertyId",a);const n=`/api/properties${e.toString()?`?${e}`:""}`;return await(await c("GET",n)).json()}}),g=N.map(e=>({id:e.id,unitId:e.unitId??e.unit_id,tenantId:e.tenantId??e.tenant_id,startDate:e.startDate??e.start_date,endDate:e.endDate??e.end_date,status:I(e.status)})).filter(e=>e.status==="terminated"),x=v.map(e=>({id:e.id,unitNumber:e.unitNumber??e.unit_number,propertyId:e.propertyId??e.property_id})),S=T.map(e=>({id:e.id,fullName:e.fullName??e.full_name})),q=b.map(e=>({id:e.id,name:e.name})),u=a,y=g.filter(e=>u?x.find(r=>r.id===e.unitId)?.propertyId===u:!0),f=D({mutationFn:async e=>{if(h)throw new Error("Select a property in the header to reactivate leases.");return await(await c("PUT",`/api/leases/${e}`,{status:"active"})).json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/leases"]}),w.invalidateQueries({queryKey:["/api/units"]}),m({title:"Lease reactivated",description:"The lease is active again."})},onError:e=>{m({title:"Failed to reactivate",description:e.message||"Please try again.",variant:"destructive"})}});return t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Terminated Leases"}),t.jsx("p",{className:"text-muted-foreground",children:"Review terminated leases and reactivate when needed"})]}),t.jsxs(U,{children:[t.jsx(R,{children:t.jsx($,{children:"Terminated Leases"})}),t.jsxs(E,{className:"p-0",children:[t.jsxs(F,{className:"table-fixed w-full",children:[t.jsx(z,{children:t.jsxs(j,{children:[t.jsx(i,{className:"w-48",children:"Tenant"}),t.jsx(i,{className:"w-32",children:"Unit"}),t.jsx(i,{children:"Property"}),t.jsx(i,{className:"w-32",children:"End Date"}),t.jsx(i,{className:"w-28",children:"Status"}),t.jsx(i,{className:"w-28 text-right",children:"Actions"})]})}),t.jsx(_,{children:y.map(e=>{const n=x.find(o=>o.id===e.unitId),r=S.find(o=>o.id===e.tenantId),L=q.find(o=>o.id===n?.propertyId);return t.jsxs(j,{className:"text-red-600 dark:text-red-400",children:[t.jsx(d,{className:"font-medium",children:r?.fullName||"Unknown"}),t.jsx(d,{children:n?.unitNumber||"Unknown"}),t.jsx(d,{children:L?.name||"Unknown"}),t.jsx(d,{children:e.endDate?new Date(e.endDate).toLocaleDateString():"â€”"}),t.jsx(d,{children:t.jsx(K,{variant:"destructive",children:"terminated"})}),t.jsx(d,{className:"text-right",children:t.jsx(k,{size:"sm",disabled:h||f.isPending,onClick:()=>f.mutate(e.id),children:"Reactivate"})})]},e.id)})})]}),y.length===0&&t.jsx("div",{className:"p-6 text-sm text-muted-foreground",children:u?"No terminated leases for the selected property. Switch to View All Properties to see all terminated leases.":"No terminated leases found."})]})]})]})}export{B as TerminatedLeases};

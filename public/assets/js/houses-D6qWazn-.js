import{c as at,b as nt,u as rt,a as it,e as Ge,d as he,q as v,f as U,j as e,T as ys,x as r,a1 as lt,B as Ce,a2 as fs,J as vs,D as Fe,a3 as ot,P as Ns,g as Pe,h as Ue,i as Te,k as ke,F as Ye,l as b,m as S,n as A,o as C,I as c,p as F,a4 as ws,S as bs,r as Ss,s as As,v as Cs,w as De,L,R as Xe,K as V,C as B,z as Re,A as Ee,U as Ze,G as Q,a5 as dt,a6 as Fs,a7 as ct,E as es,a8 as ut,a9 as ht,y as me,aa as O,ab as se,O as ss,Q as mt,V as ts,W as as,X as ns,Y as rs,Z as is,_ as ls,$ as Ps,ac as pt,ad as xt,ae as Us,af as k,ag as gt,ah as D,H as jt,t as Ts,a0 as te}from"./index-BtknkMaH.js";import{r as d}from"./vendor-Dl_IvdXv.js";import{h as yt,a as ft}from"./schema-yUJfXApV.js";import{M as ks}from"./map-pin-BiMmByZC.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=at("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function Ct(){const[ae,Ds]=d.useState(""),[He,$e]=d.useState(!1),[Rs,pe]=d.useState(!1),[Es,Ie]=d.useState(!1),{selectedPropertyId:l,selectedLandlordId:N,setSelectedPropertyId:Ke}=nt();d.useState("all");const[ne,Os]=d.useState(null),[xe,ge]=d.useState(null),[vt,Hs]=d.useState(""),[H,Le]=d.useState(null),[W,M]=d.useState(""),[re,ie]=d.useState(null),[q,le]=d.useState(null),[G,T]=d.useState(""),[$,je]=d.useState([]),[$s,Y]=d.useState(!1),[Me,X]=d.useState(null),[os,ye]=d.useState({}),[qe,ze]=d.useState(null),[Is,_e]=d.useState(!1),[Je,ds]=d.useState(""),[Ks,fe]=d.useState(!1),[Z,z]=d.useState({apiUrl:"",apiKey:"",partnerId:"",shortcode:"",enabled:!1}),[oe,cs]=d.useState([]),[,us]=rt(),{toast:i}=it(),hs=()=>typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,g=Ge({resolver:Ts(yt),defaultValues:{name:"",description:"",baseRentAmount:"",rentDepositAmount:"",waterRatePerUnit:"15.50",waterRateType:"unit_based",waterFlatRate:"0.00",isActive:"true"}}),y=Ge({defaultValues:{numberOfUnits:1,unitPrefix:"A",startNumber:101}}),_=Ge({resolver:Ts(ft),defaultValues:{propertyId:"",name:"",description:"",isActive:"true"}}),{data:P=[],isLoading:Ls,error:ms}=he({queryKey:["/api/house-types",l,N],queryFn:async()=>{const s=new URLSearchParams;l&&s.append("propertyId",l),N&&s.append("landlordId",N);const t=`/api/house-types${s.toString()?`?${s}`:""}`;return await(await te("GET",t)).json()}}),{data:j=[],isLoading:ps}=he({queryKey:["/api/properties",N,l],queryFn:async()=>{const s=new URLSearchParams;N&&s.append("landlordId",N),l&&s.append("propertyId",l);const t=`/api/properties${s.toString()?`?${s}`:""}`;return await(await te("GET",t)).json()}}),o=l?j.find(s=>s.id===l):null,{data:I=[],isLoading:Nt}=he({queryKey:["/api/units",l,N],queryFn:async()=>{const s=new URLSearchParams;l&&s.append("propertyId",l),N&&s.append("landlordId",N);const t=`/api/units${s.toString()?`?${s}`:""}`;return await(await te("GET",t)).json()}}),{data:R=[],isLoading:Ms}=he({queryKey:["/api/charge-codes",l,N],queryFn:async()=>{const s=new URLSearchParams;l&&s.append("propertyId",l),N&&s.append("landlordId",N);const t=`/api/charge-codes${s.toString()?`?${s}`:""}`;return await(await te("GET",t)).json()},enabled:!!l||!!N}),{data:J,refetch:qs}=he({queryKey:["/api/property-sms-settings",l],queryFn:async()=>await(await te("GET",`/api/property-sms-settings?propertyId=${l}`)).json(),enabled:!!l});d.useEffect(()=>{z(J?{apiUrl:J.api_url||"",apiKey:J.api_key||"",partnerId:J.partner_id||"",shortcode:J.shortcode||"",enabled:J.enabled===1}:{apiUrl:"",apiKey:"",partnerId:"",shortcode:"",enabled:!1})},[J]),d.useEffect(()=>{v.invalidateQueries({queryKey:["/api/house-types"]}),v.invalidateQueries({queryKey:["/api/units"]}),v.invalidateQueries({queryKey:["/api/charge-codes"]})},[]),d.useEffect(()=>{if(ps)return;const t=hs().get("property");if(t==="new"&&Array.isArray(j)&&j.length>0){const a=j[j.length-1];Ke(a.id)}else if(t&&t!=="new"&&Array.isArray(j)&&j.length>0){const a=j.find(n=>n.id===t);a?Ke(a.id):i({title:"Property Not Found",description:"The requested property could not be found.",variant:"destructive"})}},[j,ps,Ke,i]),d.useEffect(()=>{const s=g.watch("waterRateType");s==="unit_based"?g.setValue("waterFlatRate","0.00"):s==="flat_rate"&&g.setValue("waterRatePerUnit","0.00")},[g.watch("waterRateType")]),d.useEffect(()=>{He||ye({})},[He]),d.useEffect(()=>{ye({})},[l]);const Ve=U({mutationFn:async s=>{console.log("Sending house type data to API:",s);const t=await fetch("http://localhost:3000/api/house-types",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok){const n=await t.text();throw console.error("API Error:",n),new Error(`HTTP ${t.status}: ${n}`)}const a=await t.json();return console.log("API Response:",a),a},onSuccess:s=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/house-types"]}),$e(!1),g.reset(),ye({}),i({title:"House Type Added",description:"New house type has been created successfully."})},onError:s=>{console.error("House type creation failed:",s),i({title:"Error",description:s.message||"Failed to add house type",variant:"destructive"})}}),Be=U({mutationFn:async({numberOfUnits:s,unitPrefix:t,startNumber:a,propertyId:n,houseTypeId:m,houseType:u})=>{const h=[];for(let x=0;x<s;x++){const f=`${t}${a+x}`;let K={};try{u?.chargeAmounts&&u.chargeAmounts!=="null"&&u.chargeAmounts!==""&&(K=JSON.parse(u.chargeAmounts))}catch(tt){console.warn("Failed to parse house type chargeAmounts:",tt),K={}}h.push({propertyId:n,houseTypeId:m,unitNumber:f,rentAmount:u.baseRentAmount,rentDepositAmount:u.rentDepositAmount||"0.00",waterRateAmount:u.waterRateType==="unit_based"?u.waterRatePerUnit||"0.00":u.waterFlatRate||"0.00",chargeAmounts:Object.keys(K).length>0?JSON.stringify(K):void 0,status:"vacant"})}const p=h.map(x=>fetch("http://localhost:3000/api/units",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(x)}).then(f=>{if(!f.ok){const K=f.text();throw new Error(`HTTP ${f.status}: ${K}`)}return f.json()}));return Promise.all(p)},onSuccess:s=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/units"]}),pe(!1),y.reset(),i({title:"Units Created",description:`${s.length} units have been created successfully.`})},onError:s=>{i({title:"Error",description:s.message||"Failed to create units",variant:"destructive"})}});U({mutationFn:async({unitId:s,rentAmount:t})=>{const a=await fetch(`http://localhost:3000/api/units/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({rentAmount:t})});if(!a.ok){const n=await a.text();throw new Error(`HTTP ${a.status}: ${n}`)}return a.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["/api/units"]}),ge(null),Hs(""),i({title:"Unit Updated",description:"Rent amount has been updated successfully."})},onError:s=>{i({title:"Error",description:s.message||"Failed to update unit",variant:"destructive"})}});const Qe=U({mutationFn:async s=>{const t=await fetch("http://localhost:3000/api/charge-codes",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok){const a=await t.text();throw new Error(`HTTP ${t.status}: ${a}`)}return t.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/charge-codes"]}),_.reset(),_.setValue("propertyId",l||""),i({title:"Charge Code Added",description:"New charge code has been created successfully."})},onError:s=>{i({title:"Error",description:s.message||"Failed to add charge code",variant:"destructive"})}}),ve=U({mutationFn:async s=>{console.log("Deleting charge code with ID:",s);const t=await fetch(`http://localhost:3000/api/charge-codes/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(console.log("Delete response status:",t.status),!t.ok){const a=await t.text();throw console.error("Delete error:",a),new Error(`HTTP ${t.status}: ${a}`)}return t.status===204?{success:!0}:t.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/charge-codes"]}),ze(null),_e(!1),i({title:"Charge Code Deleted",description:"Charge code has been deleted successfully."})},onError:s=>{i({title:"Error",description:s.message||"Failed to delete charge code",variant:"destructive"})}}),zs=s=>{const t={...s,propertyId:l};Qe.mutate(t)},E=U({mutationFn:async({houseTypeId:s,field:t,value:a})=>{if(!a||a.trim()==="")throw new Error("Value cannot be empty");let n={};if(t.startsWith("charge_")){const h=t.replace("charge_",""),p=Array.isArray(P)?P.find(f=>f.id===s):null;let x={};try{p?.chargeAmounts&&p.chargeAmounts!=="null"&&p.chargeAmounts!==""&&(x=JSON.parse(p.chargeAmounts))}catch(f){console.warn("Failed to parse chargeAmounts JSON:",f),x={}}x[h]=a,n.chargeAmounts=JSON.stringify(x)}else n[t]=a;if(Object.keys(n).length===0)throw new Error("No valid data to update");console.log("Updating house type with data:",n),console.log("Field being updated:",t),console.log("Value being set:",a),console.log("House type ID:",s);const m=await fetch(`http://localhost:3000/api/house-types/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)});if(!m.ok){const h=await m.text();throw console.error("House type update failed:",h),console.error("Response status:",m.status),new Error(`HTTP ${m.status}: ${h}`)}const u=Array.isArray(I)?I.filter(h=>h.houseTypeId===s):[];for(const h of u){const p={};if(t==="baseRentAmount")p.rentAmount=a;else if(t==="rentDepositAmount")p.rentDepositAmount=a;else if(t==="waterRatePerUnit")p.waterRateAmount=a;else if(t==="waterFlatRate")p.waterRateAmount=a;else if(t.startsWith("charge_")){const x=t.replace("charge_","");let f={};try{h.chargeAmounts&&h.chargeAmounts!=="null"&&h.chargeAmounts!==""&&(f=JSON.parse(h.chargeAmounts))}catch(K){console.warn("Failed to parse unit chargeAmounts JSON:",K),f={}}f[x]=a,p.chargeAmounts=JSON.stringify(f)}if(Object.keys(p).length>0){const x=await fetch(`http://localhost:3000/api/units/${h.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(p)});x.ok||console.error(`Failed to update unit ${h.id}:`,await x.text())}}return{success:!0,updatedUnits:u.length}},onSuccess:s=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/house-types"]}),v.invalidateQueries({queryKey:["http://localhost:3000/api/units"]}),ie(null),le(null),T(""),X(null),Y(!1),i({title:"House Type and Units Updated",description:`House type has been updated successfully. ${s.updatedUnits} related units have been updated with the new rates.`})},onError:s=>{X(null),Y(!1),i({title:"Error",description:s.message||"Failed to update house type and related units",variant:"destructive"})}}),Ne=U({mutationFn:async({houseTypeId:s,field:t,value:a})=>{let n={};if(t.startsWith("charge_")){const u=t.replace("charge_",""),h=Array.isArray(P)?P.find(x=>x.id===s):null;let p={};try{h?.chargeAmounts&&h.chargeAmounts!=="null"&&h.chargeAmounts!==""&&(p=JSON.parse(h.chargeAmounts))}catch(x){console.warn("Failed to parse chargeAmounts JSON:",x),p={}}p[u]=a,n.chargeAmounts=JSON.stringify(p)}else n[t]=a;const m=await fetch(`http://localhost:3000/api/house-types/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)});if(!m.ok){const u=await m.text();throw new Error(`HTTP ${m.status}: ${u}`)}return m.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/house-types"]}),ie(null),le(null),T(""),X(null),Y(!1),i({title:"House Type Updated",description:"House type has been updated successfully. New units will use these rates."})},onError:s=>{X(null),Y(!1),i({title:"Error",description:s.message||"Failed to update house type",variant:"destructive"})}}),_s=U({mutationFn:async s=>{const t=await fetch(`http://localhost:3000/api/house-types/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const a=await t.text();throw new Error(`HTTP ${t.status}: ${a}`)}return t.status===204?{success:!0}:t.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/house-types"]}),v.invalidateQueries({queryKey:["http://localhost:3000/api/units"]}),i({title:"House Type Deleted",description:"House type has been deleted successfully."}),window.location.reload()},onError:s=>{i({title:"Error",description:s.message||"Failed to delete house type",variant:"destructive"})}}),xs=U({mutationFn:async s=>{const t=await fetch("http://localhost:3000/api/units/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({unitIds:s})});if(!t.ok){const a=await t.text();throw new Error(`HTTP ${t.status}: ${a}`)}return t.json()},onSuccess:s=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/units"]}),je([]),s.failed.length>0?i({title:"Partial Success",description:`${s.success.length} units deleted successfully. ${s.failed.length} units could not be deleted due to active leases.`,variant:"destructive"}):i({title:"Units Deleted",description:`${s.success.length} units have been deleted successfully.`})},onError:s=>{i({title:"Error",description:s.message||"Failed to delete units",variant:"destructive"})}}),ee=U({mutationFn:async({unitId:s,field:t,value:a})=>{const n=await fetch(`http://localhost:3000/api/units/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({[t]:a})});if(!n.ok){const m=await n.text();throw new Error(`HTTP ${n.status}: ${m}`)}return n.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["http://localhost:3000/api/units"]}),ge(null),Le(null),M(""),i({title:"Unit Updated",description:"Field has been updated successfully."})},onError:s=>{i({title:"Error",description:s.message||"Failed to update unit",variant:"destructive"})}}),We=U({mutationFn:async s=>await(await te("POST",`/api/property-sms-settings?propertyId=${l}`,s)).json(),onSuccess:()=>{qs(),fe(!1),i({title:"SMS Settings Saved",description:"Property SMS settings have been updated successfully."})},onError:s=>{i({title:"Error",description:s.message||"Failed to save SMS settings",variant:"destructive"})}}),Js=()=>{l&&We.mutate(Z)},Vs=s=>{if(console.log("Creating house type with data:",s),console.log("Form data keys:",Object.keys(s)),console.log("Form data values:",Object.values(s)),!l){i({title:"Property Required",description:"Please select a property first",variant:"destructive"});return}const t={};R.forEach(a=>{const n=os[a.id]||"0.00";parseFloat(n)>0&&(t[a.id]=n)}),Ve.mutate({...s,propertyId:l,chargeAmounts:Object.keys(t).length>0?JSON.stringify(t):void 0})},Bs=s=>{const{numberOfUnits:t,unitPrefix:a,startNumber:n}=s;Be.mutate({numberOfUnits:t,unitPrefix:a,startNumber:n,propertyId:l,houseTypeId:ne?.id,houseType:ne})},Qs=s=>{_s.mutate(s)},Ws=s=>{je(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},Gs=()=>{$.length===w.length?je([]):je(w.map(s=>s.id))},Ys=()=>{$.length!==0&&confirm(`Are you sure you want to delete ${$.length} unit(s)? Units with active leases cannot be deleted.`)&&xs.mutate($)},we=(s,t,a)=>{ge(s),Le(t),M(a)},be=s=>{if(H)if(H.startsWith("charge_")){const t=H.replace("charge_",""),a=w.find(m=>m.id===s),n=a?.chargeAmounts?JSON.parse(a.chargeAmounts):{};n[t]=W,ee.mutate({unitId:s,field:"chargeAmounts",value:JSON.stringify(n)})}else ee.mutate({unitId:s,field:H,value:W})},Se=()=>{ge(null),Le(null),M("")},de=(s,t,a)=>{ie(s),le(t),T(a)},ce=s=>{if(!q)return;const t=G.trim();if(!t||isNaN(parseFloat(t))){i({title:"Invalid Input",description:"Please enter a valid number",variant:"destructive"});return}if(parseFloat(t)<0){i({title:"Invalid Input",description:"Amount cannot be negative",variant:"destructive"});return}X({houseTypeId:s,field:q,value:t}),Y(!0)},gs=s=>{Me&&(s?E.mutate(Me):Ne.mutate(Me))},ue=()=>{ie(null),le(null),T("")},Ae=Array.isArray(P)?P.filter(s=>!ae||ae.trim()===""?!0:s.name.toLowerCase().includes(ae.toLowerCase())||s.description?.toLowerCase().includes(ae.toLowerCase())):[];console.log("Filtered house types:",Ae),console.log("Filtered house types length:",Ae.length);const Xs=s=>Array.isArray(I)?I.filter(t=>t.houseTypeId===s).length:0,Zs=s=>Array.isArray(I)?I.filter(t=>{const a=t.houseTypeId===s,n=t.status==="occupied";return a&&n}).length:0,et=()=>hs().get("property")&&l,js=s=>{cs(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},w=Array.isArray(I)?I.filter(s=>!(oe.length>0&&!oe.includes(s.houseTypeId))):[];if(console.log("filteredUnits:",w),w.length>0&&(console.log("First unit data:",w[0]),console.log("First unit rentDepositAmount:",w[0].rentDepositAmount),console.log("First unit waterRateAmount:",w[0].waterRateAmount)),ms)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsxs("span",{children:["Error loading house types: ",ms.message]})]})});const st=()=>{if(!Je){i({title:"Error",description:"Please enter a top-up amount",variant:"destructive"});return}i({title:"SMS Top-up",description:`KSh ${Je} SMS units added successfully`}),ds("")};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>us("/properties"),children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Back to Properties"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2","data-testid":"houses-title",children:[e.jsx(Ce,{className:"h-8 w-8"}),o?`${o.name} - House Management`:"Houses"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage house types, rates, and unit allocations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",onClick:()=>fe(!0),disabled:!l,children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"SMS Settings"]}),e.jsxs(r,{variant:"outline",onClick:()=>{Ie(!0),_.setValue("propertyId",l||"")},disabled:!l,children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Configure Charges"]}),e.jsxs(Fe,{open:He,onOpenChange:$e,children:[e.jsx(ot,{asChild:!0,children:e.jsxs(r,{"data-testid":"button-add-house-type",disabled:!o,children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Add House Type"]})}),e.jsxs(Pe,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto p-8",children:[e.jsxs(Ue,{children:[e.jsx(Te,{children:"Add New House Type"}),e.jsx(ke,{children:"Create a new house type with base rent and water rates."})]}),!o&&e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg border border-destructive/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Please select a property first"})]})}),e.jsx(Ye,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(Vs),className:"space-y-6",children:[e.jsx(b,{control:g.control,name:"name",render:({field:s})=>e.jsxs(S,{children:[e.jsxs(A,{children:["House Type Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(C,{children:e.jsx(c,{placeholder:"e.g., Bedsitter, 1 Bedroom, 2 Bedroom","data-testid":"input-house-type-name",required:!0,...s})}),e.jsx(F,{})]})}),e.jsx(b,{control:g.control,name:"description",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Description"}),e.jsx(C,{children:e.jsx(ws,{placeholder:"Describe the house type features...","data-testid":"input-description",...s})}),e.jsx(F,{})]})}),e.jsx(b,{control:g.control,name:"baseRentAmount",render:({field:s})=>e.jsxs(S,{children:[e.jsxs(A,{children:["Base Rent Amount (KSh) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(C,{children:e.jsx(c,{type:"number",step:"0.01",placeholder:"e.g., 25000","data-testid":"input-base-rent",required:!0,min:"0.01",...s})}),e.jsx(F,{})]})}),e.jsx(b,{control:g.control,name:"rentDepositAmount",render:({field:s})=>e.jsxs(S,{children:[e.jsxs(A,{children:["Rent Deposit Amount (KSh) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(C,{children:e.jsx(c,{type:"number",step:"0.01",placeholder:"e.g., 25000","data-testid":"input-rent-deposit",required:!0,min:"0",...s})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:g.control,name:"waterRateType",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Water Rate Type"}),e.jsxs(bs,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(C,{children:e.jsx(Ss,{children:e.jsx(As,{placeholder:"Select water rate type"})})}),e.jsxs(Cs,{children:[e.jsx(De,{value:"unit_based",children:"Unit Based (Per Unit)"}),e.jsx(De,{value:"flat_rate",children:"Flat Rate (Fixed Amount)"})]})]}),e.jsx(F,{})]})}),g.watch("waterRateType")==="unit_based"&&e.jsx(b,{control:g.control,name:"waterRatePerUnit",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Water Rate Per Unit (KSh)"}),e.jsx(C,{children:e.jsx(c,{type:"number",step:"0.01",placeholder:"e.g., 15.50","data-testid":"input-water-rate",...s})}),e.jsx(F,{})]})}),g.watch("waterRateType")==="flat_rate"&&e.jsx(b,{control:g.control,name:"waterFlatRate",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Water Flat Rate (KSh)"}),e.jsx(C,{children:e.jsx(c,{type:"number",step:"0.01",placeholder:"e.g., 500","data-testid":"input-water-flat-rate",...s})}),e.jsx(F,{})]})})]}),o&&R.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Other Property Charge Codes"}),e.jsx("div",{className:"space-y-3",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(c,{type:"number",step:"0.01",placeholder:"Rate",className:"w-24",value:os[s.id]||"0.00",onChange:t=>{const a=t.target.value;ye(n=>({...n,[s.id]:a}))}})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>$e(!1),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:Ve.isPending||!o,children:Ve.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):"Add House Type"})]})]})})]})]}),e.jsx(Fe,{open:Rs,onOpenChange:pe,children:e.jsxs(Pe,{className:"sm:max-w-[500px]",children:[e.jsxs(Ue,{children:[e.jsx(Te,{children:"Add Multiple Units"}),e.jsxs(ke,{children:["Create multiple units for ",ne?.name," at ",o?.name]})]}),e.jsx(Ye,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(Bs),className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Unit Details Preview"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Property: ",o?.name]}),e.jsxs("div",{children:["House Type: ",ne?.name]}),e.jsxs("div",{children:["Base Rent: KSh ",ne?.baseRentAmount]})]})]}),e.jsx(b,{control:y.control,name:"numberOfUnits",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Number of Units"}),e.jsx(C,{children:e.jsx(c,{type:"number",min:"1",max:"50",placeholder:"e.g., 5",...s,onChange:t=>s.onChange(parseInt(t.target.value)||1)})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{control:y.control,name:"unitPrefix",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Unit Prefix"}),e.jsx(C,{children:e.jsx(c,{placeholder:"e.g., A, B, 1",...s})}),e.jsx(F,{})]})}),e.jsx(b,{control:y.control,name:"startNumber",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Start Number"}),e.jsx(C,{children:e.jsx(c,{type:"number",min:"1",placeholder:"e.g., 101",...s,onChange:t=>s.onChange(parseInt(t.target.value)||101)})}),e.jsx(F,{})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Preview:"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:y.watch("numberOfUnits")>0&&e.jsxs(e.Fragment,{children:[Array.from({length:Math.min(y.watch("numberOfUnits"),5)},(s,t)=>e.jsxs("span",{children:[y.watch("unitPrefix"),y.watch("startNumber")+t,t<Math.min(y.watch("numberOfUnits"),5)-1&&", "]},t)),y.watch("numberOfUnits")>5&&"..."]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>pe(!1),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:Be.isPending,children:Be.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):`Create ${y.watch("numberOfUnits")} Units`})]})]})})]})}),e.jsx(Fe,{open:Es,onOpenChange:Ie,children:e.jsxs(Pe,{className:"sm:max-w-[600px]",children:[e.jsxs(Ue,{children:[e.jsx(Te,{children:"Configure Charge Codes"}),e.jsxs(ke,{children:["Manage charge codes for ",o?.name," (e.g., Garbage Fee, Security Fee, Maintenance Fee)"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h4",{className:"text-lg font-semibold",children:"Current Charge Codes"})}),Ms?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(L,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{children:"Loading charge codes..."})]}):R.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No charge codes configured yet"}),e.jsx("p",{className:"text-sm",children:"Add charge codes like Garbage Fee, Security Fee, etc."})]}):e.jsx("div",{className:"space-y-3",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{ze(s),_e(!0)},disabled:ve.isPending,children:e.jsx(Xe,{className:"h-3 w-3"})})]},s.id))})]}),e.jsx(Ye,{..._,children:e.jsxs("form",{onSubmit:_.handleSubmit(zs),className:"space-y-4",children:[e.jsx(b,{control:_.control,name:"name",render:({field:s})=>e.jsxs(S,{children:[e.jsxs(A,{children:["Charge Code Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(C,{children:e.jsx(c,{placeholder:"e.g., Garbage Fee, Security Fee, Maintenance Fee",required:!0,...s})}),e.jsx(F,{})]})}),e.jsx(b,{control:_.control,name:"description",render:({field:s})=>e.jsxs(S,{children:[e.jsx(A,{children:"Description (Optional)"}),e.jsx(C,{children:e.jsx(ws,{placeholder:"Describe what this charge covers...",...s})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>Ie(!1),children:"Close"}),e.jsx(r,{type:"submit",disabled:Qe.isPending,children:Qe.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):"Add Charge Code"})]})]})})]})}),e.jsx(Fe,{open:Ks,onOpenChange:fe,children:e.jsxs(Pe,{className:"sm:max-w-[500px]",children:[e.jsxs(Ue,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5"}),"SMS Settings"]}),e.jsxs(ke,{children:["Configure AdvantaSMS credentials for ",o?.name,". These credentials will be used for sending SMS to tenants."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"sms-api-url",children:"API URL"}),e.jsx(c,{id:"sms-api-url",placeholder:"https://quicksms.advantasms.com/api/services/sendsms/",value:Z.apiUrl,onChange:s=>z(t=>({...t,apiUrl:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"sms-api-key",children:"API Key"}),e.jsx(c,{id:"sms-api-key",type:"password",placeholder:"Your AdvantaSMS API Key",value:Z.apiKey,onChange:s=>z(t=>({...t,apiKey:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"sms-partner-id",children:"Partner ID"}),e.jsx(c,{id:"sms-partner-id",placeholder:"Your Partner ID",value:Z.partnerId,onChange:s=>z(t=>({...t,partnerId:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"sms-shortcode",children:"Shortcode / Sender ID"}),e.jsx(c,{id:"sms-shortcode",placeholder:"e.g., AdvantaSMS",value:Z.shortcode,onChange:s=>z(t=>({...t,shortcode:s.target.value}))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"sms-enabled",checked:Z.enabled,onChange:s=>z(t=>({...t,enabled:s.target.checked})),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(V,{htmlFor:"sms-enabled",children:"Enable SMS for this property"})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Note:"}),e.jsx("p",{className:"text-muted-foreground",children:"SMS sent to tenants of this property will use these credentials. The SMS cost will be charged to this property's account."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>fe(!1),children:"Cancel"}),e.jsx(r,{onClick:Js,disabled:We.isPending,children:We.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Settings"})]})]})})]})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx(Re,{children:e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"Customer Details"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Address:"}),e.jsx("span",{children:o.address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Landlord:"}),e.jsx("span",{children:o.landlordName})]})]}),e.jsxs("div",{className:"space-y-2",children:[o.landlordPhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{children:o.landlordPhone})]}),o.landlordEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:o.landlordEmail})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(r,{variant:"outline",onClick:()=>{i({title:"Send Login Details",description:"Feature coming soon - dialog with resend/generate options"})},children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"Send Login Details"]}),e.jsxs(r,{variant:"outline",onClick:()=>{i({title:"Reset Password",description:"Feature coming soon - will generate new temp password"})},children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Reset Password"]})]})]})]}),e.jsxs(B,{children:[e.jsxs(Re,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5"}),"SMS Units Top-up"]}),e.jsx(es,{children:"Add SMS units to this property's account for tenant communications"})]}),e.jsx(Q,{children:e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{htmlFor:"sms-amount",children:"Amount (KSh)"}),e.jsx(c,{id:"sms-amount",type:"number",placeholder:"e.g., 1000",value:Je,onChange:s=>ds(s.target.value)})]}),e.jsxs(r,{onClick:st,children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),"Top Up SMS Units"]})]})})]})]}),et()?e.jsx(B,{className:"border-primary/20 bg-primary/5",children:e.jsxs(Q,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary/10 p-3 rounded-lg",children:e.jsx(Ce,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-primary",children:"Property of Interest"}),e.jsx("p",{className:"text-muted-foreground",children:"Currently managing house types and units for this property"})]})]}),e.jsx(r,{variant:"outline",onClick:()=>{setSelectedProperty(null),us("/houses")},children:"View All Properties"})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ht,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Property Name"})]}),e.jsx("p",{className:"text-lg font-semibold",children:o?.name})]}),e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ks,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Address"})]}),e.jsx("p",{className:"text-sm",children:o?.address})]}),e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Status"})]}),e.jsx(me,{variant:o?.status==="active"?"default":"secondary",children:o?.status})]})]})]})}):e.jsx(B,{children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{htmlFor:"property-select",className:"text-sm font-medium",children:"Filter by Property"}),e.jsxs(bs,{value:o?.id||"all-properties",onValueChange:s=>{if(s==="all-properties")setSelectedProperty(null);else{const t=Array.isArray(j)?j.find(a=>a.id===s):null;setSelectedProperty(t||null)}},children:[e.jsx(Ss,{id:"property-select",className:"w-full",children:e.jsx(As,{placeholder:"Select a property to filter house types and units"})}),e.jsxs(Cs,{children:[e.jsx(De,{value:"all-properties",children:"All Properties"}),Array.isArray(j)?j.map(s=>e.jsx(De,{value:s.id,children:s.name},s.id)):null]})]})]}),o&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing data for: ",e.jsx("span",{className:"font-medium text-foreground",children:o.name})]})]})})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(c,{placeholder:o?`Search house types in ${o.name}...`:"Search house types...",value:ae,onChange:s=>Ds(s.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Ls?e.jsxs("div",{className:"col-span-full flex items-center justify-center py-8",children:[e.jsx(L,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading house types..."})]}):Ae.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-muted-foreground",children:Array.isArray(P)&&P.length===0?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No house types created yet"}),e.jsx("p",{children:'Click "Add House Type" to create your first house type'})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No house types match your search"}),e.jsx("p",{children:"Try adjusting your search terms"})]})}):Ae.map(s=>{const t=j.find(n=>n.id===s.propertyId),a=oe.includes(s.id);return e.jsxs(B,{className:`hover:shadow-md transition-all cursor-pointer ${a?"ring-2 ring-primary shadow-lg":""}`,onClick:()=>js(s.id),children:[e.jsxs(Re,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Ee,{className:"text-lg",children:s.name}),t&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Ce,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(me,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Inactive"}),a&&e.jsx(me,{variant:"outline",className:"bg-primary/10 text-primary border-primary",children:"Filtered"})]})]}),s.description&&e.jsx(es,{children:s.description})]}),e.jsxs(Q,{className:"space-y-4",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Base Rent"}),re===s.id&&q==="baseRentAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",step:"0.01",min:"0",value:G,onChange:n=>T(n.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>ce(s.id),disabled:E.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"font-semibold cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>de(s.id,"baseRentAmount",s.baseRentAmount),children:["KSh ",parseFloat(s.baseRentAmount).toLocaleString(),e.jsx(Oe,{className:"h-3 w-3 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Rent Deposit"}),re===s.id&&q==="rentDepositAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",step:"0.01",min:"0",value:G,onChange:n=>T(n.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>ce(s.id),disabled:E.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"font-semibold cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>de(s.id,"rentDepositAmount",s.rentDepositAmount||"0"),children:["KSh ",parseFloat(s.rentDepositAmount||"0").toLocaleString(),e.jsx(Oe,{className:"h-3 w-3 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Water Rate"}),re===s.id&&q==="waterRatePerUnit"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",step:"0.01",min:"0",value:G,onChange:n=>T(n.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>ce(s.id),disabled:E.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):re===s.id&&q==="waterFlatRate"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",step:"0.01",min:"0",value:G,onChange:n=>T(n.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>ce(s.id),disabled:E.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"font-semibold cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>{s.waterRateType==="unit_based"?de(s.id,"waterRatePerUnit",s.waterRatePerUnit||"0"):de(s.id,"waterFlatRate",s.waterFlatRate||"0")},children:[s.waterRateType==="unit_based"?`KSh ${parseFloat(s.waterRatePerUnit||"0").toFixed(2)}/unit`:`KSh ${parseFloat(s.waterFlatRate||"0").toFixed(2)} flat`,e.jsx(Oe,{className:"h-3 w-3 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Units"}),e.jsx("div",{className:"font-semibold",children:Xs(s.id)})]})]}),R.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Additional Charges"}),e.jsx("div",{className:"space-y-1",children:R.map(n=>{let m="0.00";try{s.chargeAmounts&&s.chargeAmounts!=="null"&&s.chargeAmounts!==""&&(m=JSON.parse(s.chargeAmounts)[n.id]||"0.00")}catch(u){console.warn("Failed to parse chargeAmounts for display:",u),m="0.00"}return e.jsxs("div",{className:"flex justify-between text-xs items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:n.name}),re===s.id&&q===`charge_${n.id}`?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{type:"number",step:"0.01",min:"0",value:G,onChange:u=>T(u.target.value),className:"h-6 text-xs w-20",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>ce(s.id),disabled:E.isPending,className:"h-6 w-6 p-0",children:e.jsx(O,{className:"h-2 w-2"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,className:"h-6 w-6 p-0",children:e.jsx(se,{className:"h-2 w-2"})})]}):e.jsxs("span",{className:"font-medium cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>de(s.id,`charge_${n.id}`,m),children:["KSh ",parseFloat(m).toFixed(2),e.jsx(Oe,{className:"h-2 w-2 text-muted-foreground"})]})]},n.id)})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Occupied"}),e.jsx("div",{className:"font-semibold",children:Zs(s.id)})]})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{Os(s),pe(!0),y.setValue("unitPrefix","A"),y.setValue("startNumber",101)},children:[e.jsx(Ns,{className:"h-3 w-3 mr-1"}),"Add Units"]}),e.jsxs(ss,{children:[e.jsx(mt,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",children:e.jsx(Xe,{className:"h-3 w-3"})})}),e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsx(ns,{children:"Delete House Type"}),e.jsxs(rs,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All units of this type will also be affected.']})]}),e.jsxs(is,{children:[e.jsx(ls,{children:"Cancel"}),e.jsx(Ps,{onClick:()=>Qs(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})]},s.id)})}),oe.length>0&&e.jsx(B,{className:"bg-primary/5 border-primary/20",children:e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map(s=>{const t=P.find(a=>a.id===s);return t?e.jsxs(me,{variant:"secondary",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground",onClick:()=>js(s),children:[t.name,e.jsx(se,{className:"h-3 w-3 ml-1"})]},s):null})})]}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>cs([]),children:"Clear All Filters"})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:["Showing ",w.length," unit(s) matching selected house types"]})]})}),e.jsxs(B,{children:[e.jsxs(Re,{children:[e.jsxs(Ee,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"All Units"]}),$.length>0&&e.jsxs(r,{variant:"destructive",size:"sm",onClick:Ys,disabled:xs.isPending,children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Delete Selected (",$.length,")"]})]}),e.jsx(es,{children:o?`Units in ${o.name}`:"Overview of all units across all properties and house types"})]}),e.jsx(Q,{children:e.jsxs(pt,{children:[e.jsx(xt,{children:e.jsxs(Us,{children:[e.jsx(k,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:$.length===w.length&&w.length>0,onChange:Gs,className:"rounded"})}),e.jsx(k,{children:"Unit Number"}),e.jsx(k,{children:"Property"}),e.jsx(k,{children:"House Type"}),e.jsx(k,{children:"Rent Amount"}),e.jsx(k,{children:"Rent Deposit"}),e.jsx(k,{children:"Water Rate"}),R.map(s=>e.jsx(k,{children:s.name},s.id)),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(gt,{children:w.map(s=>{const t=Array.isArray(j)?j.find(n=>n.id===s.propertyId):null,a=Array.isArray(P)?P.find(n=>n.id===s.houseTypeId):null;return e.jsxs(Us,{children:[e.jsx(D,{children:e.jsx("input",{type:"checkbox",checked:$.includes(s.id),onChange:()=>Ws(s.id),className:"rounded"})}),e.jsx(D,{className:"font-medium",children:s.unitNumber}),e.jsx(D,{children:t?.name||"Unknown"}),e.jsx(D,{children:a?.name||"Unknown"}),e.jsx(D,{children:xe===s.id&&H==="rentAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",value:W,onChange:n=>M(n.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>be(s.id),disabled:ee.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Se,children:"×"})]}):e.jsxs("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>we(s.id,"rentAmount",s.rentAmount),children:["KSh ",parseFloat(s.rentAmount).toLocaleString()]})}),e.jsx(D,{children:xe===s.id&&H==="rentDepositAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",value:W,onChange:n=>M(n.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>be(s.id),disabled:ee.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Se,children:"×"})]}):e.jsxs("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>we(s.id,"rentDepositAmount",s.rentDepositAmount||"0"),children:["KSh ",parseFloat(s.rentDepositAmount||"0").toLocaleString()]})}),e.jsx(D,{children:xe===s.id&&H==="waterRateAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",value:W,onChange:n=>M(n.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>be(s.id),disabled:ee.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Se,children:"×"})]}):e.jsxs("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>we(s.id,"waterRateAmount",s.waterRateAmount||"0"),children:["KSh ",parseFloat(s.waterRateAmount||"0").toLocaleString(),"/unit"]})}),R.map(n=>{const u=(s.chargeAmounts?JSON.parse(s.chargeAmounts):{})[n.id]||"0.00";return e.jsx(D,{children:xe===s.id&&H===`charge_${n.id}`?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"number",value:W,onChange:h=>M(h.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>be(s.id),disabled:ee.isPending,children:e.jsx(O,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Se,children:"×"})]}):e.jsx("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>we(s.id,`charge_${n.id}`,u),children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["KSh ",parseFloat(u).toLocaleString()]})})},n.id)}),e.jsx(D,{children:e.jsx(me,{variant:s.status==="occupied"?"default":s.status==="vacant"?"secondary":"destructive",children:s.status})}),e.jsx(D,{children:e.jsxs(r,{variant:"outline",size:"sm",children:[e.jsx(jt,{className:"h-3 w-3 mr-1"}),"View"]})})]},s.id)})})]})})]}),e.jsx(ss,{open:$s,onOpenChange:s=>{Y(s),s||(X(null),ie(null),le(null),T(""))},children:e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsx(ns,{children:"Update House Type Rates"}),e.jsxs(rs,{children:["How would you like to apply this rate change?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"New Units Only:"})," The new rate will only apply to units created after this update.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Update Existing Units:"})," All existing units with this house type will be updated to the new rate."]})]}),e.jsxs(is,{children:[e.jsx(ls,{children:"Cancel"}),e.jsx(r,{variant:"outline",onClick:()=>gs(!1),disabled:Ne.isPending||E.isPending,children:"New Units Only"}),e.jsx(r,{onClick:()=>gs(!0),disabled:Ne.isPending||E.isPending,children:E.isPending||Ne.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Updating..."]}):"Update Existing Units"})]})]})}),e.jsx(ss,{open:Is,onOpenChange:s=>{_e(s),s||ze(null)},children:e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsx(ns,{children:"Delete Charge Code"}),e.jsxs(rs,{children:['Are you sure you want to delete "',qe?.name,'"?',e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"Warning:"})," This will affect all unit rates in ",o?.name||"this property",":",e.jsx("br",{}),"• All house types in this property will lose this charge code",e.jsx("br",{}),"• All existing units in this property will lose this charge code",e.jsx("br",{}),"• Future units will not include this charge code",e.jsx("br",{}),e.jsx("br",{}),"This action cannot be undone."]})]}),e.jsxs(is,{children:[e.jsx(ls,{children:"Cancel"}),e.jsx(Ps,{onClick:()=>{qe&&ve.mutate(qe.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:ve.isPending,children:ve.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Charge Code"})]})]})})]})}export{Ct as Houses};

import{b as nt,u as rt,a as it,e as as,d as me,q as j,f as U,j as e,T as ys,x as r,a1 as lt,B as ke,a2 as vs,J as dt,P as Ns,O as Re,V as De,W as Ee,X as Ie,Y as Oe,Z as He,_ as _e,$ as ns,D as Te,g as Ke,h as qe,i as Le,k as $e,F as rs,l as w,m as C,n as A,o as S,I as u,p as F,a3 as bs,S as ct,r as ot,s as ut,v as mt,w as ws,a4 as ht,L as q,R as is,K as he,C as Z,z as ls,A as ds,U as cs,G as ee,a5 as pt,a6 as xt,a7 as gt,y as pe,E as Cs,a8 as H,a9 as se,Q as jt,aa as ft,ab as yt,ac as As,ad as R,ae as vt,af as D,H as Nt,t as Ss,a0 as h}from"./index-D3-Phv8z.js";import{r as d}from"./vendor-BBpupLJz.js";import{h as bt,a as wt}from"./schema-ChL10cc-.js";import{M as Fs}from"./map-pin-B_2aw_SQ.js";import{P as Me}from"./pencil-BpDMQQo5.js";function Rt(){const[te,Ps]=d.useState(""),[ze,B]=d.useState(!1),[Us,xe]=d.useState(!1),[ks,ae]=d.useState(!1),{selectedPropertyId:i,selectedLandlordId:f,setSelectedPropertyId:ge}=nt();d.useState("all");const[ne,Rs]=d.useState(null),[je,fe]=d.useState(null),[Ct,Ds]=d.useState(""),[_,Ve]=d.useState(null),[Q,L]=d.useState(""),[re,ie]=d.useState(null),[$,le]=d.useState(null),[W,k]=d.useState(""),[T,ye]=d.useState([]),[Es,G]=d.useState(!1),[Be,J]=d.useState(null),[os,ve]=d.useState({}),[Qe,Ne]=d.useState({}),[Is,be]=d.useState(!1),[We,Ge]=d.useState(null),[Os,Je]=d.useState(!1),[Hs,we]=d.useState(!1),[Y,M]=d.useState({apiUrl:"",apiKey:"",partnerId:"",shortcode:"",enabled:!1}),[de,Ye]=d.useState([]),[,us]=rt(),{toast:l}=it(),z=s=>{if(!s||s==="null"||s==="")return{};if(typeof s=="string")try{const t=JSON.parse(s);return t&&typeof t=="object"?t:{}}catch(t){return console.warn("Failed to parse chargeAmounts JSON:",t),{}}return typeof s=="object"?s:{}},_s=s=>({...s,propertyId:s.propertyId??s.property_id,baseRentAmount:s.baseRentAmount??s.base_rent_amount??"0",rentDepositAmount:s.rentDepositAmount??s.rent_deposit_amount??"0",waterRatePerUnit:s.waterRatePerUnit??s.water_rate_per_unit??"0",waterRateType:s.waterRateType??s.water_rate_type??"unit_based",waterFlatRate:s.waterFlatRate??s.water_flat_rate??"0",chargeAmounts:s.chargeAmounts??s.charge_amounts??null,isActive:s.isActive??s.is_active??"true"}),Ts=s=>({...s,propertyId:s.propertyId??s.property_id,houseTypeId:s.houseTypeId??s.house_type_id,unitNumber:s.unitNumber??s.unit_number,rentAmount:s.rentAmount??s.rent_amount??"0",rentDepositAmount:s.rentDepositAmount??s.rent_deposit_amount??"0",waterRateAmount:s.waterRateAmount??s.water_rate_amount??"0",chargeAmounts:s.chargeAmounts??s.charge_amounts??null,status:s.status??"vacant"}),ms=()=>typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,p=as({resolver:Ss(bt),defaultValues:{name:"",description:"",baseRentAmount:"",rentDepositAmount:"",waterRatePerUnit:"15.50",waterRateType:"unit_based",waterFlatRate:"0.00",isActive:"true"}}),g=as({defaultValues:{numberOfUnits:1,unitPrefix:"A",startNumber:101}}),E=as({resolver:Ss(wt),defaultValues:{propertyId:"",name:"",description:"",isActive:"true"}}),{data:P=[],isLoading:Ks,error:hs}=me({queryKey:["/api/house-types",i,f],queryFn:async()=>{const s=new URLSearchParams;i&&s.append("propertyId",i),f&&s.append("landlordId",f);const t=`/api/house-types${s.toString()?`?${s}`:""}`,a=await(await h("GET",t)).json();return Array.isArray(a)?a.map(_s):a}}),{data:y=[],isLoading:ps}=me({queryKey:["/api/properties",f,i],queryFn:async()=>{const s=new URLSearchParams;f&&s.append("landlordId",f),i&&s.append("propertyId",i);const t=`/api/properties${s.toString()?`?${s}`:""}`;return await(await h("GET",t)).json()}}),c=i?y.find(s=>s.id===i):null,{data:K=[],isLoading:At}=me({queryKey:["/api/units",i,f],queryFn:async()=>{const s=new URLSearchParams;i&&s.append("propertyId",i),f&&s.append("landlordId",f);const t=`/api/units${s.toString()?`?${s}`:""}`,a=await(await h("GET",t)).json();return Array.isArray(a)?a.map(Ts):a}}),{data:I=[],isLoading:qs}=me({queryKey:["/api/charge-codes",i,f],queryFn:async()=>{const s=new URLSearchParams;i&&s.append("propertyId",i),f&&s.append("landlordId",f);const t=`/api/charge-codes${s.toString()?`?${s}`:""}`;return await(await h("GET",t)).json()},enabled:!!i||!!f}),{data:V,refetch:Ls}=me({queryKey:["/api/property-sms-settings",i],queryFn:async()=>await(await h("GET",`/api/property-sms-settings?propertyId=${i}`)).json(),enabled:!!i});d.useEffect(()=>{M(V?{apiUrl:V.api_url||"",apiKey:V.api_key||"",partnerId:V.partner_id||"",shortcode:V.shortcode||"",enabled:V.enabled===1}:{apiUrl:"",apiKey:"",partnerId:"",shortcode:"",enabled:!1})},[V]),d.useEffect(()=>{j.invalidateQueries({queryKey:["/api/house-types"]}),j.invalidateQueries({queryKey:["/api/units"]}),j.invalidateQueries({queryKey:["/api/charge-codes"]})},[]),d.useEffect(()=>{if(ps)return;const t=ms().get("property");if(t==="new"&&Array.isArray(y)&&y.length>0){const n=y[y.length-1];ge(n.id)}else if(t&&t!=="new"&&Array.isArray(y)&&y.length>0){const n=y.find(a=>a.id===t);n?ge(n.id):l({title:"Property Not Found",description:"The requested property could not be found.",variant:"destructive"})}},[y,ps,ge,l]),d.useEffect(()=>{const s=p.watch("waterRateType");s==="unit_based"?p.setValue("waterFlatRate","0.00"):s==="flat_rate"&&p.setValue("waterRatePerUnit","0.00")},[p.watch("waterRateType")]),d.useEffect(()=>{ze||(ve({}),Ne({}))},[ze]),d.useEffect(()=>{ve({}),Ne({})},[i]),d.useEffect(()=>{i||Ye([])},[i]);const Xe=U({mutationFn:async s=>{console.log("Sending house type data to API:",s);const n=await(await h("POST","/api/house-types",s)).json();return console.log("API Response:",n),n},onSuccess:s=>{j.invalidateQueries({queryKey:["/api/house-types"]}),B(!1),p.reset(),ve({}),Ne({}),l({title:"House Type Added",description:"New house type has been created successfully."})},onError:s=>{console.error("House type creation failed:",s),l({title:"Error",description:s.message||"Failed to add house type",variant:"destructive"})}}),Ze=U({mutationFn:async({numberOfUnits:s,unitPrefix:t,startNumber:n,propertyId:a,houseTypeId:m,houseType:o})=>{const x=[];for(let b=0;b<s;b++){const ts=`${t}${n+b}`,fs=z(o?.chargeAmounts);x.push({propertyId:a,houseTypeId:m,unitNumber:ts,rentAmount:o.baseRentAmount,rentDepositAmount:o.rentDepositAmount||"0.00",waterRateAmount:o.waterRateType==="unit_based"?o.waterRatePerUnit||"0.00":o.waterFlatRate||"0.00",chargeAmounts:Object.keys(fs).length>0?fs:void 0,status:"vacant"})}const N=x.map(b=>h("POST","/api/units",b).then(ts=>ts.json()));return Promise.all(N)},onSuccess:s=>{j.invalidateQueries({queryKey:["/api/units"]}),xe(!1),g.reset(),l({title:"Units Created",description:`${s.length} units have been created successfully.`})},onError:s=>{l({title:"Error",description:s.message||"Failed to create units",variant:"destructive"})}});U({mutationFn:async({unitId:s,rentAmount:t})=>(await h("PUT",`/api/units/${s}`,{rentAmount:t})).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/units"]}),fe(null),Ds(""),l({title:"Unit Updated",description:"Rent amount has been updated successfully."})},onError:s=>{l({title:"Error",description:s.message||"Failed to update unit",variant:"destructive"})}});const es=U({mutationFn:async s=>(await h("POST","/api/charge-codes",s)).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/charge-codes"]}),E.reset(),E.setValue("propertyId",i||""),l({title:"Charge Code Added",description:"New charge code has been created successfully."})},onError:s=>{l({title:"Error",description:s.message||"Failed to add charge code",variant:"destructive"})}}),Ce=U({mutationFn:async s=>{console.log("Deleting charge code with ID:",s);const t=await h("DELETE",`/api/charge-codes/${s}`);return console.log("Delete response status:",t.status),t.status===204?{success:!0}:t.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/charge-codes"]}),Ge(null),Je(!1),l({title:"Charge Code Deleted",description:"Charge code has been deleted successfully."})},onError:s=>{l({title:"Error",description:s.message||"Failed to delete charge code",variant:"destructive"})}}),$s=s=>{const t={...s,propertyId:i};es.mutate(t)},O=U({mutationFn:async({houseTypeId:s,field:t,value:n})=>{if(!n||n.trim()==="")throw new Error("Value cannot be empty");let a={};if(t.startsWith("charge_")){const o=t.replace("charge_",""),x=Array.isArray(P)?P.find(b=>b.id===s):null,N=z(x?.chargeAmounts);N[o]=n,a.chargeAmounts=N}else a[t]=n;if(Object.keys(a).length===0)throw new Error("No valid data to update");console.log("Updating house type with data:",a),console.log("Field being updated:",t),console.log("Value being set:",n),console.log("House type ID:",s),await h("PUT",`/api/house-types/${s}`,a);const m=Array.isArray(K)?K.filter(o=>o.houseTypeId===s):[];for(const o of m){const x={};if(t==="baseRentAmount")x.rentAmount=n;else if(t==="rentDepositAmount")x.rentDepositAmount=n;else if(t==="waterRatePerUnit")x.waterRateAmount=n;else if(t==="waterFlatRate")x.waterRateAmount=n;else if(t.startsWith("charge_")){const N=t.replace("charge_",""),b=z(o.chargeAmounts);b[N]=n,x.chargeAmounts=b}if(Object.keys(x).length>0)try{await h("PUT",`/api/units/${o.id}`,x)}catch(N){console.error(`Failed to update unit ${o.id}:`,N?.message||N)}}return{success:!0,updatedUnits:m.length}},onSuccess:s=>{j.invalidateQueries({queryKey:["/api/house-types"]}),j.invalidateQueries({queryKey:["/api/units"]}),ie(null),le(null),k(""),J(null),G(!1),l({title:"House Type and Units Updated",description:`House type has been updated successfully. ${s.updatedUnits} related units have been updated with the new rates.`})},onError:s=>{J(null),G(!1),l({title:"Error",description:s.message||"Failed to update house type and related units",variant:"destructive"})}}),Ae=U({mutationFn:async({houseTypeId:s,field:t,value:n})=>{let a={};if(t.startsWith("charge_")){const o=t.replace("charge_",""),x=Array.isArray(P)?P.find(b=>b.id===s):null,N=z(x?.chargeAmounts);N[o]=n,a.chargeAmounts=N}else a[t]=n;return(await h("PUT",`/api/house-types/${s}`,a)).json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/house-types"]}),ie(null),le(null),k(""),J(null),G(!1),l({title:"House Type Updated",description:"House type has been updated successfully. New units will use these rates."})},onError:s=>{J(null),G(!1),l({title:"Error",description:s.message||"Failed to update house type",variant:"destructive"})}}),Ms=U({mutationFn:async s=>{const t=await h("DELETE",`/api/house-types/${s}`);return t.status===204?{success:!0}:t.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/house-types"]}),j.invalidateQueries({queryKey:["/api/units"]}),l({title:"House Type Deleted",description:"House type has been deleted successfully."}),window.location.reload()},onError:s=>{l({title:"Error",description:s.message||"Failed to delete house type",variant:"destructive"})}}),xs=U({mutationFn:async s=>(await h("POST","/api/units/bulk-delete",{unitIds:s})).json(),onSuccess:s=>{j.invalidateQueries({queryKey:["/api/units"]}),ye([]),s.failed.length>0?l({title:"Partial Success",description:`${s.success.length} units deleted successfully. ${s.failed.length} units could not be deleted due to active leases.`,variant:"destructive"}):l({title:"Units Deleted",description:`${s.success.length} units have been deleted successfully.`})},onError:s=>{l({title:"Error",description:s.message||"Failed to delete units",variant:"destructive"})}}),X=U({mutationFn:async({unitId:s,field:t,value:n})=>(await h("PUT",`/api/units/${s}`,{[t]:n})).json(),onSuccess:()=>{j.invalidateQueries({queryKey:["/api/units"]}),fe(null),Ve(null),L(""),l({title:"Unit Updated",description:"Field has been updated successfully."})},onError:s=>{l({title:"Error",description:s.message||"Failed to update unit",variant:"destructive"})}}),ss=U({mutationFn:async s=>await(await h("POST",`/api/property-sms-settings?propertyId=${i}`,s)).json(),onSuccess:()=>{Ls(),we(!1),l({title:"SMS Settings Saved",description:"Property SMS settings have been updated successfully."})},onError:s=>{l({title:"Error",description:s.message||"Failed to save SMS settings",variant:"destructive"})}}),zs=()=>{i&&ss.mutate(Y)},Vs=()=>{if(!i){l({title:"Property Required",description:"Please select a property in the header before adding a house type.",variant:"destructive"});return}if(I.length===0){be(!0);return}B(!0)},Bs=()=>{if(!i){l({title:"Property Required",description:"Please select a property in the header before configuring charge codes.",variant:"destructive"});return}ae(!0),E.setValue("propertyId",i||"")},Qs=()=>{be(!1),ae(!0),E.setValue("propertyId",i||"")},Ws=()=>{be(!1),B(!0)},Gs=s=>{if(console.log("Creating house type with data:",s),console.log("Form data keys:",Object.keys(s)),console.log("Form data values:",Object.values(s)),!i){l({title:"Property Required",description:"Please select a property first",variant:"destructive"});return}const t={},n=Object.keys(Qe).filter(a=>Qe[a]);for(const a of n){const m=os[a];if(!m||parseFloat(m)<=0){l({title:"Charge Amount Required",description:"Please enter a valid amount for each selected charge code.",variant:"destructive"});return}t[a]=m}Xe.mutate({...s,propertyId:i,chargeAmounts:Object.keys(t).length>0?t:void 0})},Js=s=>{const{numberOfUnits:t,unitPrefix:n,startNumber:a}=s;Ze.mutate({numberOfUnits:t,unitPrefix:n,startNumber:a,propertyId:i,houseTypeId:ne?.id,houseType:ne})},Ys=s=>{Ms.mutate(s)},Xs=s=>{ye(t=>t.includes(s)?t.filter(n=>n!==s):[...t,s])},Zs=()=>{T.length===v.length?ye([]):ye(v.map(s=>s.id))},et=()=>{T.length!==0&&confirm(`Are you sure you want to delete ${T.length} unit(s)? Units with active leases cannot be deleted.`)&&xs.mutate(T)},Se=(s,t,n)=>{fe(s),Ve(t),L(n)},Fe=s=>{if(_)if(_.startsWith("charge_")){const t=_.replace("charge_",""),n=v.find(m=>m.id===s),a=z(n?.chargeAmounts);a[t]=Q,X.mutate({unitId:s,field:"chargeAmounts",value:JSON.stringify(a)})}else X.mutate({unitId:s,field:_,value:Q})},Pe=()=>{fe(null),Ve(null),L("")},ce=(s,t,n)=>{ie(s),le(t),k(n)},oe=s=>{if(!$)return;const t=W.trim();if(!t||isNaN(parseFloat(t))){l({title:"Invalid Input",description:"Please enter a valid number",variant:"destructive"});return}if(parseFloat(t)<0){l({title:"Invalid Input",description:"Amount cannot be negative",variant:"destructive"});return}J({houseTypeId:s,field:$,value:t}),G(!0)},gs=s=>{Be&&(s?O.mutate(Be):Ae.mutate(Be))},ue=()=>{ie(null),le(null),k("")},Ue=Array.isArray(P)?P.filter(s=>!te||te.trim()===""?!0:s.name.toLowerCase().includes(te.toLowerCase())||s.description?.toLowerCase().includes(te.toLowerCase())):[];console.log("Filtered house types:",Ue),console.log("Filtered house types length:",Ue.length);const st=s=>Array.isArray(K)?K.filter(t=>t.houseTypeId===s).length:0,tt=s=>Array.isArray(K)?K.filter(t=>{const n=t.houseTypeId===s,a=t.status==="occupied";return n&&a}).length:0,at=()=>ms().get("property")&&i,js=s=>{Ye(t=>t.includes(s)?t.filter(n=>n!==s):[...t,s])},v=Array.isArray(K)?K.filter(s=>!(de.length>0&&!de.includes(s.houseTypeId))):[];return console.log("filteredUnits:",v),v.length>0&&(console.log("First unit data:",v[0]),console.log("First unit rentDepositAmount:",v[0].rentDepositAmount),console.log("First unit waterRateAmount:",v[0].waterRateAmount)),hs?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsxs("span",{children:["Error loading house types: ",hs.message]})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>us("/properties"),children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Back to Properties"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2","data-testid":"houses-title",children:[e.jsx(ke,{className:"h-8 w-8"}),c?`${c.name} - House Management`:"Houses"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage house types, rates, and unit allocations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",onClick:()=>we(!0),disabled:!i,children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"SMS Settings"]}),e.jsxs(r,{variant:"outline",onClick:Bs,children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Configure Charges"]}),e.jsxs(r,{"data-testid":"button-add-house-type",onClick:Vs,children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Add House Type"]}),e.jsx(Re,{open:Is,onOpenChange:be,children:e.jsxs(De,{children:[e.jsxs(Ee,{children:[e.jsx(Ie,{children:"Configure Charge Codes?"}),e.jsx(Oe,{children:"This property has no charge codes yet. Do you want to configure charges before adding a house type?"})]}),e.jsxs(He,{children:[e.jsx(_e,{onClick:Ws,children:"Continue Without Charges"}),e.jsx(ns,{onClick:Qs,children:"Configure Charges"})]})]})}),e.jsx(Te,{open:ze,onOpenChange:B,children:e.jsxs(Ke,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto p-8",children:[e.jsxs(qe,{children:[e.jsx(Le,{children:"Add New House Type"}),e.jsx($e,{children:"Create a new house type with base rent and water rates."})]}),!c&&e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg border border-destructive/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Please select a property first"})]})}),e.jsx(rs,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(Gs),className:"space-y-6",children:[e.jsx(w,{control:p.control,name:"name",render:({field:s})=>e.jsxs(C,{children:[e.jsxs(A,{children:["House Type Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(S,{children:e.jsx(u,{placeholder:"e.g., Bedsitter, 1 Bedroom, 2 Bedroom","data-testid":"input-house-type-name",required:!0,...s})}),e.jsx(F,{})]})}),e.jsx(w,{control:p.control,name:"description",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Description"}),e.jsx(S,{children:e.jsx(bs,{placeholder:"Describe the house type features...","data-testid":"input-description",...s})}),e.jsx(F,{})]})}),e.jsx(w,{control:p.control,name:"baseRentAmount",render:({field:s})=>e.jsxs(C,{children:[e.jsxs(A,{children:["Base Rent Amount (KSh) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(S,{children:e.jsx(u,{type:"number",step:"0.01",placeholder:"e.g., 25000","data-testid":"input-base-rent",required:!0,min:"0.01",...s})}),e.jsx(F,{})]})}),e.jsx(w,{control:p.control,name:"rentDepositAmount",render:({field:s})=>e.jsxs(C,{children:[e.jsxs(A,{children:["Rent Deposit Amount (KSh) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(S,{children:e.jsx(u,{type:"number",step:"0.01",placeholder:"e.g., 25000","data-testid":"input-rent-deposit",required:!0,min:"0",...s})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{control:p.control,name:"waterRateType",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Water Rate Type"}),e.jsxs(ct,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(S,{children:e.jsx(ot,{children:e.jsx(ut,{placeholder:"Select water rate type"})})}),e.jsxs(mt,{children:[e.jsx(ws,{value:"unit_based",children:"Unit Based (Per Unit)"}),e.jsx(ws,{value:"flat_rate",children:"Flat Rate (Fixed Amount)"})]})]}),e.jsx(F,{})]})}),p.watch("waterRateType")==="unit_based"&&e.jsx(w,{control:p.control,name:"waterRatePerUnit",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Water Rate Per Unit (KSh)"}),e.jsx(S,{children:e.jsx(u,{type:"number",step:"0.01",placeholder:"e.g., 15.50","data-testid":"input-water-rate",...s})}),e.jsx(F,{})]})}),p.watch("waterRateType")==="flat_rate"&&e.jsx(w,{control:p.control,name:"waterFlatRate",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Water Flat Rate (KSh)"}),e.jsx(S,{children:e.jsx(u,{type:"number",step:"0.01",placeholder:"e.g., 500","data-testid":"input-water-flat-rate",...s})}),e.jsx(F,{})]})})]}),c&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Property Charge Codes"}),I.length===0?e.jsxs("div",{className:"rounded-lg border border-dashed p-4 text-sm text-muted-foreground",children:[e.jsx("div",{className:"mb-3",children:"No charge codes configured for this property yet."}),e.jsx(r,{type:"button",variant:"outline",onClick:()=>{B(!1),ae(!0),E.setValue("propertyId",i||"")},children:"Configure Charge Codes"})]}):e.jsx("div",{className:"space-y-3",children:I.map(s=>{const t=!!Qe[s.id];return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ht,{checked:t,onCheckedChange:n=>{Ne(a=>({...a,[s.id]:!!n}))}}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(u,{type:"number",step:"0.01",placeholder:"Rate",className:"w-24",disabled:!t,value:os[s.id]||"",onChange:n=>{const a=n.target.value;ve(m=>({...m,[s.id]:a}))}})})]},s.id)})})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>B(!1),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:Xe.isPending||!c,children:Xe.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):"Add House Type"})]})]})})]})}),e.jsx(Te,{open:Us,onOpenChange:xe,children:e.jsxs(Ke,{className:"sm:max-w-[500px]",children:[e.jsxs(qe,{children:[e.jsx(Le,{children:"Add Multiple Units"}),e.jsxs($e,{children:["Create multiple units for ",ne?.name," at ",c?.name]})]}),e.jsx(rs,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(Js),className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Unit Details Preview"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Property: ",c?.name]}),e.jsxs("div",{children:["House Type: ",ne?.name]}),e.jsxs("div",{children:["Base Rent: KSh ",ne?.baseRentAmount]})]})]}),e.jsx(w,{control:g.control,name:"numberOfUnits",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Number of Units"}),e.jsx(S,{children:e.jsx(u,{type:"number",min:"1",max:"50",placeholder:"e.g., 5",...s,onChange:t=>s.onChange(parseInt(t.target.value)||1)})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{control:g.control,name:"unitPrefix",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Unit Prefix"}),e.jsx(S,{children:e.jsx(u,{placeholder:"e.g., A, B, 1",...s})}),e.jsx(F,{})]})}),e.jsx(w,{control:g.control,name:"startNumber",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Start Number"}),e.jsx(S,{children:e.jsx(u,{type:"number",min:"1",placeholder:"e.g., 101",...s,onChange:t=>s.onChange(parseInt(t.target.value)||101)})}),e.jsx(F,{})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Preview:"}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:g.watch("numberOfUnits")>0&&e.jsxs(e.Fragment,{children:[Array.from({length:Math.min(g.watch("numberOfUnits"),5)},(s,t)=>e.jsxs("span",{children:[g.watch("unitPrefix"),g.watch("startNumber")+t,t<Math.min(g.watch("numberOfUnits"),5)-1&&", "]},t)),g.watch("numberOfUnits")>5&&"..."]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>xe(!1),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:Ze.isPending,children:Ze.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):`Create ${g.watch("numberOfUnits")} Units`})]})]})})]})}),e.jsx(Te,{open:ks,onOpenChange:ae,children:e.jsxs(Ke,{className:"sm:max-w-[600px]",children:[e.jsxs(qe,{children:[e.jsx(Le,{children:"Configure Charge Codes"}),e.jsxs($e,{children:["Manage charge codes for ",c?.name," (e.g., Garbage Fee, Security Fee, Maintenance Fee)"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h4",{className:"text-lg font-semibold",children:"Current Charge Codes"})}),qs?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(q,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{children:"Loading charge codes..."})]}):I.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No charge codes configured yet"}),e.jsx("p",{className:"text-sm",children:"Add charge codes like Garbage Fee, Security Fee, etc."})]}):e.jsx("div",{className:"space-y-3",children:I.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{Ge(s),Je(!0)},disabled:Ce.isPending,children:e.jsx(is,{className:"h-3 w-3"})})]},s.id))})]}),e.jsx(rs,{...E,children:e.jsxs("form",{onSubmit:E.handleSubmit($s),className:"space-y-4",children:[e.jsx(w,{control:E.control,name:"name",render:({field:s})=>e.jsxs(C,{children:[e.jsxs(A,{children:["Charge Code Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(S,{children:e.jsx(u,{placeholder:"e.g., Garbage Fee, Security Fee, Maintenance Fee",required:!0,...s})}),e.jsx(F,{})]})}),e.jsx(w,{control:E.control,name:"description",render:({field:s})=>e.jsxs(C,{children:[e.jsx(A,{children:"Description (Optional)"}),e.jsx(S,{children:e.jsx(bs,{placeholder:"Describe what this charge covers...",...s})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>ae(!1),children:"Close"}),e.jsx(r,{type:"submit",disabled:es.isPending,children:es.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):"Add Charge Code"})]})]})})]})}),e.jsx(Te,{open:Hs,onOpenChange:we,children:e.jsxs(Ke,{className:"sm:max-w-[500px]",children:[e.jsxs(qe,{children:[e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5"}),"SMS Settings"]}),e.jsxs($e,{children:["Configure AdvantaSMS credentials for ",c?.name,". These credentials will be used for sending SMS to tenants."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{htmlFor:"sms-api-url",children:"API URL"}),e.jsx(u,{id:"sms-api-url",placeholder:"https://quicksms.advantasms.com/api/services/sendsms/",value:Y.apiUrl,onChange:s=>M(t=>({...t,apiUrl:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{htmlFor:"sms-api-key",children:"API Key"}),e.jsx(u,{id:"sms-api-key",type:"password",placeholder:"Your AdvantaSMS API Key",value:Y.apiKey,onChange:s=>M(t=>({...t,apiKey:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{htmlFor:"sms-partner-id",children:"Partner ID"}),e.jsx(u,{id:"sms-partner-id",placeholder:"Your Partner ID",value:Y.partnerId,onChange:s=>M(t=>({...t,partnerId:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{htmlFor:"sms-shortcode",children:"Shortcode / Sender ID"}),e.jsx(u,{id:"sms-shortcode",placeholder:"e.g., AdvantaSMS",value:Y.shortcode,onChange:s=>M(t=>({...t,shortcode:s.target.value}))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"sms-enabled",checked:Y.enabled,onChange:s=>M(t=>({...t,enabled:s.target.checked})),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(he,{htmlFor:"sms-enabled",children:"Enable SMS for this property"})]}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Note:"}),e.jsx("p",{className:"text-muted-foreground",children:"SMS sent to tenants of this property will use these credentials. The SMS cost will be charged to this property's account."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>we(!1),children:"Cancel"}),e.jsx(r,{onClick:zs,disabled:ss.isPending,children:ss.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Settings"})]})]})})]})]}),c&&e.jsx(e.Fragment,{children:e.jsxs(Z,{children:[e.jsx(ls,{children:e.jsxs(ds,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5"}),"Customer Details"]})}),e.jsx(ee,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Address:"}),e.jsx("span",{children:c.address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Landlord:"}),e.jsx("span",{children:c.landlordName})]})]}),e.jsxs("div",{className:"space-y-2",children:[c.landlordPhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("span",{children:c.landlordPhone})]}),c.landlordEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:c.landlordEmail})]})]})]})})]})}),at()?e.jsx(Z,{className:"border-primary/20 bg-primary/5",children:e.jsxs(ee,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-primary/10 p-3 rounded-lg",children:e.jsx(ke,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-primary",children:"Property of Interest"}),e.jsx("p",{className:"text-muted-foreground",children:"Currently managing house types and units for this property"})]})]}),e.jsx(r,{variant:"outline",onClick:()=>{ge(null),us("/houses")},children:"View All Properties"})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Property Name"})]}),e.jsx("p",{className:"text-lg font-semibold",children:c?.name})]}),e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Fs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Address"})]}),e.jsx("p",{className:"text-sm",children:c?.address})]}),e.jsxs("div",{className:"bg-background/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(cs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Status"})]}),e.jsx(pe,{variant:c?.status==="active"?"default":"secondary",children:c?.status})]})]})]})}):null,c&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(u,{placeholder:`Search house types in ${c.name}...`,value:te,onChange:s=>Ps(s.target.value),className:"max-w-sm"})}),c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Ks?e.jsxs("div",{className:"col-span-full flex items-center justify-center py-8",children:[e.jsx(q,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading house types..."})]}):Ue.length===0?e.jsx("div",{className:"col-span-full text-center py-8 text-muted-foreground",children:Array.isArray(P)&&P.length===0?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No house types created yet"}),e.jsx("p",{children:'Click "Add House Type" to create your first house type'})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No house types match your search"}),e.jsx("p",{children:"Try adjusting your search terms"})]})}):Ue.map(s=>{const t=y.find(a=>a.id===s.propertyId),n=de.includes(s.id);return e.jsxs(Z,{className:`hover:shadow-md transition-all cursor-pointer ${n?"ring-2 ring-primary shadow-lg":""}`,onClick:()=>js(s.id),children:[e.jsxs(ls,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(ds,{className:"text-lg",children:s.name}),t&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ke,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(pe,{variant:s.isActive==="true"?"default":"secondary",children:s.isActive==="true"?"Active":"Inactive"}),n&&e.jsx(pe,{variant:"outline",className:"bg-primary/10 text-primary border-primary",children:"Filtered"})]})]}),s.description&&e.jsx(Cs,{children:s.description})]}),e.jsxs(ee,{className:"space-y-4",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Base Rent"}),re===s.id&&$==="baseRentAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",step:"0.01",min:"0",value:W,onChange:a=>k(a.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>oe(s.id),disabled:O.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"font-semibold cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>ce(s.id,"baseRentAmount",s.baseRentAmount),children:["KSh ",parseFloat(s.baseRentAmount).toLocaleString(),e.jsx(Me,{className:"h-3 w-3 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Rent Deposit"}),re===s.id&&$==="rentDepositAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",step:"0.01",min:"0",value:W,onChange:a=>k(a.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>oe(s.id),disabled:O.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"font-semibold cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>ce(s.id,"rentDepositAmount",s.rentDepositAmount||"0"),children:["KSh ",parseFloat(s.rentDepositAmount||"0").toLocaleString(),e.jsx(Me,{className:"h-3 w-3 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Water Rate"}),re===s.id&&$==="waterRatePerUnit"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",step:"0.01",min:"0",value:W,onChange:a=>k(a.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>oe(s.id),disabled:O.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):re===s.id&&$==="waterFlatRate"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",step:"0.01",min:"0",value:W,onChange:a=>k(a.target.value),className:"h-8 text-sm",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>oe(s.id),disabled:O.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,children:e.jsx(se,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"font-semibold cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>{s.waterRateType==="unit_based"?ce(s.id,"waterRatePerUnit",s.waterRatePerUnit||"0"):ce(s.id,"waterFlatRate",s.waterFlatRate||"0")},children:[s.waterRateType==="unit_based"?`KSh ${parseFloat(s.waterRatePerUnit||"0").toFixed(2)}/unit`:`KSh ${parseFloat(s.waterFlatRate||"0").toFixed(2)} flat`,e.jsx(Me,{className:"h-3 w-3 text-muted-foreground"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Units"}),e.jsx("div",{className:"font-semibold",children:st(s.id)})]})]}),I.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Additional Charges"}),e.jsx("div",{className:"space-y-1",children:I.map(a=>{let m="0.00";try{s.chargeAmounts&&s.chargeAmounts!=="null"&&s.chargeAmounts!==""&&(m=z(s.chargeAmounts)[a.id]||"0.00")}catch(o){console.warn("Failed to parse chargeAmounts for display:",o),m="0.00"}return e.jsxs("div",{className:"flex justify-between text-xs items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:a.name}),re===s.id&&$===`charge_${a.id}`?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{type:"number",step:"0.01",min:"0",value:W,onChange:o=>k(o.target.value),className:"h-6 text-xs w-20",autoFocus:!0}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>oe(s.id),disabled:O.isPending,className:"h-6 w-6 p-0",children:e.jsx(H,{className:"h-2 w-2"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:ue,className:"h-6 w-6 p-0",children:e.jsx(se,{className:"h-2 w-2"})})]}):e.jsxs("span",{className:"font-medium cursor-pointer hover:bg-muted/50 p-1 rounded flex items-center gap-1",onClick:()=>ce(s.id,`charge_${a.id}`,m),children:["KSh ",parseFloat(m).toFixed(2),e.jsx(Me,{className:"h-2 w-2 text-muted-foreground"})]})]},a.id)})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Occupied"}),e.jsx("div",{className:"font-semibold",children:tt(s.id)})]})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{Rs(s),xe(!0),g.setValue("unitPrefix","A"),g.setValue("startNumber",101)},children:[e.jsx(Ns,{className:"h-3 w-3 mr-1"}),"Add Units"]}),e.jsxs(Re,{children:[e.jsx(jt,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",children:e.jsx(is,{className:"h-3 w-3"})})}),e.jsxs(De,{children:[e.jsxs(Ee,{children:[e.jsx(Ie,{children:"Delete House Type"}),e.jsxs(Oe,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All units of this type will also be affected.']})]}),e.jsxs(He,{children:[e.jsx(_e,{children:"Cancel"}),e.jsx(ns,{onClick:()=>Ys(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})]},s.id)})}),de.length>0&&e.jsx(Z,{className:"bg-primary/5 border-primary/20",children:e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:de.map(s=>{const t=P.find(n=>n.id===s);return t?e.jsxs(pe,{variant:"secondary",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground",onClick:()=>js(s),children:[t.name,e.jsx(se,{className:"h-3 w-3 ml-1"})]},s):null})})]}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>Ye([]),children:"Clear All Filters"})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:["Showing ",v.length," unit(s) matching selected house types"]})]})})]}):e.jsx(Z,{className:"border-dashed",children:e.jsx(ee,{className:"p-6 text-sm text-muted-foreground",children:"Select a property in the header to view house types. Units across all properties are listed below."})}),e.jsxs(Z,{children:[e.jsxs(ls,{children:[e.jsxs(ds,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"All Units"]}),T.length>0&&e.jsxs(r,{variant:"destructive",size:"sm",onClick:et,disabled:xs.isPending,children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Delete Selected (",T.length,")"]})]}),e.jsx(Cs,{children:c?`Units in ${c.name}`:"Overview of all units across all properties and house types"})]}),e.jsx(ee,{children:e.jsxs(ft,{children:[e.jsx(yt,{children:e.jsxs(As,{children:[e.jsx(R,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:T.length===v.length&&v.length>0,onChange:Zs,className:"rounded"})}),e.jsx(R,{children:"Unit Number"}),e.jsx(R,{children:"Property"}),e.jsx(R,{children:"House Type"}),e.jsx(R,{children:"Rent Amount"}),e.jsx(R,{children:"Rent Deposit"}),e.jsx(R,{children:"Water Rate"}),I.map(s=>e.jsx(R,{children:s.name},s.id)),e.jsx(R,{children:"Status"}),e.jsx(R,{children:"Actions"})]})}),e.jsx(vt,{children:v.map(s=>{const t=Array.isArray(y)?y.find(a=>a.id===s.propertyId):null,n=Array.isArray(P)?P.find(a=>a.id===s.houseTypeId):null;return e.jsxs(As,{children:[e.jsx(D,{children:e.jsx("input",{type:"checkbox",checked:T.includes(s.id),onChange:()=>Xs(s.id),className:"rounded"})}),e.jsx(D,{className:"font-medium",children:s.unitNumber}),e.jsx(D,{children:t?.name||"Unknown"}),e.jsx(D,{children:n?.name||"Unknown"}),e.jsx(D,{children:je===s.id&&_==="rentAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",value:Q,onChange:a=>L(a.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Fe(s.id),disabled:X.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Pe,children:"×"})]}):e.jsxs("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>Se(s.id,"rentAmount",s.rentAmount),children:["KSh ",parseFloat(s.rentAmount).toLocaleString()]})}),e.jsx(D,{children:je===s.id&&_==="rentDepositAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",value:Q,onChange:a=>L(a.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Fe(s.id),disabled:X.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Pe,children:"×"})]}):e.jsxs("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>Se(s.id,"rentDepositAmount",s.rentDepositAmount||"0"),children:["KSh ",parseFloat(s.rentDepositAmount||"0").toLocaleString()]})}),e.jsx(D,{children:je===s.id&&_==="waterRateAmount"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",value:Q,onChange:a=>L(a.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Fe(s.id),disabled:X.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Pe,children:"×"})]}):e.jsxs("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>Se(s.id,"waterRateAmount",s.waterRateAmount||"0"),children:["KSh ",parseFloat(s.waterRateAmount||"0").toLocaleString(),"/unit"]})}),I.map(a=>{const o=z(s.chargeAmounts)[a.id]||"0.00";return e.jsx(D,{children:je===s.id&&_===`charge_${a.id}`?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{type:"number",value:Q,onChange:x=>L(x.target.value),className:"w-24 h-8",step:"0.01",min:"0"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>Fe(s.id),disabled:X.isPending,children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:Pe,children:"×"})]}):e.jsx("div",{className:"cursor-pointer hover:bg-muted/50 p-1 rounded",onClick:()=>Se(s.id,`charge_${a.id}`,o),children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["KSh ",parseFloat(o).toLocaleString()]})})},a.id)}),e.jsx(D,{children:e.jsx(pe,{variant:s.status==="occupied"?"default":s.status==="vacant"?"secondary":"destructive",children:s.status})}),e.jsx(D,{children:e.jsxs(r,{variant:"outline",size:"sm",children:[e.jsx(Nt,{className:"h-3 w-3 mr-1"}),"View"]})})]},s.id)})})]})})]}),e.jsx(Re,{open:Es,onOpenChange:s=>{G(s),s||(J(null),ie(null),le(null),k(""))},children:e.jsxs(De,{children:[e.jsxs(Ee,{children:[e.jsx(Ie,{children:"Update House Type Rates"}),e.jsxs(Oe,{children:["How would you like to apply this rate change?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"New Units Only:"})," The new rate will only apply to units created after this update.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Update Existing Units:"})," All existing units with this house type will be updated to the new rate."]})]}),e.jsxs(He,{children:[e.jsx(_e,{children:"Cancel"}),e.jsx(r,{variant:"outline",onClick:()=>gs(!1),disabled:Ae.isPending||O.isPending,children:"New Units Only"}),e.jsx(r,{onClick:()=>gs(!0),disabled:Ae.isPending||O.isPending,children:O.isPending||Ae.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Updating..."]}):"Update Existing Units"})]})]})}),e.jsx(Re,{open:Os,onOpenChange:s=>{Je(s),s||Ge(null)},children:e.jsxs(De,{children:[e.jsxs(Ee,{children:[e.jsx(Ie,{children:"Delete Charge Code"}),e.jsxs(Oe,{children:['Are you sure you want to delete "',We?.name,'"?',e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{className:"text-destructive",children:"Warning:"})," This will affect all unit rates in ",c?.name||"this property",":",e.jsx("br",{}),"• All house types in this property will lose this charge code",e.jsx("br",{}),"• All existing units in this property will lose this charge code",e.jsx("br",{}),"• Future units will not include this charge code",e.jsx("br",{}),e.jsx("br",{}),"This action cannot be undone."]})]}),e.jsxs(He,{children:[e.jsx(_e,{children:"Cancel"}),e.jsx(ns,{onClick:()=>{We&&Ce.mutate(We.id)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:Ce.isPending,children:Ce.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Charge Code"})]})]})})]})}export{Rt as Houses};

import{a as gt,b as yt,f as oe,d as N,j as t,C as X,G as ee,x as u,a8 as Fe,a6 as ke,a2 as qe,R as Ke,I as ce,S as ft,r as vt,s as St,v as Nt,w as te,z as wt,A as bt,a4 as _e,E as Dt,aa as Ue,ab as ze,ac as se,ad as x,ae as Qe,af as j,H as It,al as Re,ar as Oe,ah as Pt,D as ue,g as me,h as pe,i as he,k as xe,L as je,K as R,a3 as Ct,a0 as m,q as f,au as Lt,y as A,az as $t}from"./index-D3-Phv8z.js";import{r as v,Y as Tt,Z as Et}from"./vendor-BBpupLJz.js";import{D as Be}from"./download-BIGyNlOu.js";import{U as At}from"./undo-2-BRAlXuVT.js";function zt(){const[O,Me]=v.useState(""),[F,ge]=v.useState("all"),[g,k]=v.useState([]),[Ge,B]=v.useState(!1),[Ve,M]=v.useState(!1),[He,G]=v.useState(!1),[a,ae]=v.useState(null),{toast:o}=gt(),{selectedPropertyId:l,selectedLandlordId:c}=yt(),V=!l,q=v.useRef({}),H=v.useRef(null),Y=e=>e?`INV-${e.replace(/[^a-zA-Z0-9]/g,"").slice(-6).toUpperCase()}`:"INV-UNKNOWN",Ye=async e=>{const i=await(await fetch(e)).blob();return await new Promise((r,d)=>{const n=new FileReader;n.onload=()=>r(n.result),n.onerror=()=>d(new Error("Failed to read logo")),n.readAsDataURL(i)})},We={all:"border-primary/40 bg-primary/10 text-primary",pending:"border-amber-500/40 bg-amber-500/10 text-amber-100",partially_paid:"border-sky-500/40 bg-sky-500/10 text-sky-100",paid:"border-green-500/40 bg-green-500/10 text-green-100"},K=async(e,s)=>{await m("PUT",`/api/invoices/${e}`,{status:s})},ne=oe({mutationFn:async({invoiceId:e,data:s})=>{if(V)throw new Error("Select a property in the header to edit invoices.");return await m("PUT",`/api/invoices/${e}`,s)},onSuccess:()=>{f.invalidateQueries({queryKey:["/api/invoices"]}),f.invalidateQueries({queryKey:["/api/invoice-items"]}),o({title:"Invoice Updated",description:"Invoice has been successfully updated."}),M(!1)},onError:e=>{o({title:"Update Failed",description:"Failed to update invoice. Please try again.",variant:"destructive"})}}),ie=oe({mutationFn:async e=>{if(V)throw new Error("Select a property in the header to send invoices.");return await m("POST",`/api/invoices/${e}/send-email`)},onSuccess:async()=>{a?.id&&await K(a.id,"sent"),f.invalidateQueries({queryKey:["/api/invoices"]}),o({title:"Email Sent",description:"Sent 1 email successfully."}),G(!1)},onError:e=>{o({title:"Send Failed",description:"Failed to send email. Please try again.",variant:"destructive"})}}),re=oe({mutationFn:async e=>{if(V)throw new Error("Select a property in the header to send invoices.");return await m("POST",`/api/invoices/${e}/send-sms`)},onSuccess:async()=>{a?.id&&await K(a.id,"sent"),f.invalidateQueries({queryKey:["/api/invoices"]}),o({title:"SMS Sent",description:"Sent 1 SMS successfully."}),G(!1)},onError:e=>{o({title:"Send Failed",description:"Failed to send SMS. Please try again.",variant:"destructive"})}}),b=N({queryKey:["/api/invoices",l,c],queryFn:async()=>{const e=new URLSearchParams;l&&e.append("propertyId",l),c&&e.append("landlordId",c);const s=`/api/invoices${e.toString()?`?${e}`:""}`;return await(await m("GET",s)).json()}}),D=N({queryKey:["/api/invoice-items"]}),I=N({queryKey:["/api/tenants",l,c],queryFn:async()=>{const e=new URLSearchParams;l&&e.append("propertyId",l),c&&e.append("landlordId",c);const s=`/api/tenants${e.toString()?`?${e}`:""}`;return await(await m("GET",s)).json()}}),P=N({queryKey:["/api/units",l,c],queryFn:async()=>{const e=new URLSearchParams;l&&e.append("propertyId",l),c&&e.append("landlordId",c);const s=`/api/units${e.toString()?`?${e}`:""}`;return await(await m("GET",s)).json()}}),w=N({queryKey:["/api/properties",c,l],queryFn:async()=>{const e=new URLSearchParams;c&&e.append("landlordId",c),l&&e.append("propertyId",l);const s=`/api/properties${e.toString()?`?${e}`:""}`;return await(await m("GET",s)).json()}}),Ze=N({queryKey:["/api/settings/invoice",c,l],queryFn:async()=>{const e=new URLSearchParams;c&&e.append("landlordId",c),l&&e.append("propertyId",l);const s=`/api/settings/invoice${e.toString()?`?${e}`:""}`;return await(await m("GET",s)).json()}}),ye=N({queryKey:["/api/activity-logs","payment",l],queryFn:async()=>{const e=new URLSearchParams;return e.append("type","payment"),l&&e.append("propertyId",l),await(await m("GET",`/api/activity-logs?${e.toString()}`)).json()},enabled:!!l,refetchInterval:3e4});v.useEffect(()=>{const e=ye.data;if(!Array.isArray(e)||e.length===0)return;const s=e[0];if(!H.current){H.current=s.id;return}s.id!==H.current&&(H.current=s.id,o({title:"Payment received",description:s.details||"A new payment was recorded."}))},[ye.data,o]);const C=N({queryKey:["/api/leases",l,c],queryFn:async()=>{const e=new URLSearchParams;l&&e.append("propertyId",l),c&&e.append("landlordId",c);const s=`/api/leases${e.toString()?`?${e}`:""}`;return await(await m("GET",s)).json()}}),W=N({queryKey:["/api/payments"],queryFn:async()=>await(await m("GET","/api/payments")).json()}),fe=b.data||[],Je=D.data||[],ve=I.data||[],Se=P.data||[],Ne=w.data||[],we=C.data||[],be=W.data||[],De=[b.status==="success",D.status==="success",I.status==="success",P.status==="success",w.status==="success",C.status==="success",W.status==="success"].every(Boolean),Ie=[b.isLoading,D.isLoading,I.isLoading,P.isLoading,w.isLoading,C.isLoading,W.isLoading].some(Boolean);if([b.error,D.error,I.error,P.error,w.error,C.error,W.error].some(Boolean))return t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold","data-testid":"invoices-title",children:"Invoices"}),t.jsx("p",{className:"text-muted-foreground",children:"Error loading invoice data"})]})}),t.jsx(X,{children:t.jsx(ee,{className:"p-6",children:t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("div",{className:"text-destructive",children:"Failed to load invoice data"}),t.jsxs("div",{className:"text-sm",children:[b.error&&"â€¢ Invoices data failed",D.error&&"â€¢ Invoice items data failed",I.error&&"â€¢ Tenants data failed",P.error&&"â€¢ Units data failed",w.error&&"â€¢ Properties data failed",C.error&&"â€¢ Leases data failed"]})]})})})]});if(Ie||!De)return t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold","data-testid":"invoices-title",children:"Invoices"}),t.jsx("p",{className:"text-muted-foreground",children:"Loading invoice data and related information..."})]})}),t.jsx(X,{children:t.jsx(ee,{className:"p-6",children:t.jsxs("div",{className:"text-center space-y-2",children:[t.jsx("div",{children:"Loading invoices data..."}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[b.isLoading&&"â€¢ Loading invoices...",D.isLoading&&"â€¢ Loading invoice items...",I.isLoading&&"â€¢ Loading tenants...",P.isLoading&&"â€¢ Loading units...",w.isLoading&&"â€¢ Loading properties...",C.isLoading&&"â€¢ Loading leases...",!Ie&&!De&&"â€¢ Waiting for all data to be ready..."]})]})})})]});const Xe=Array.isArray(fe)?fe.map(e=>({...e,leaseId:e.leaseId??e.lease_id,unitId:e.unitId??e.unit_id,propertyId:e.propertyId??e.property_id,tenantId:e.tenantId??e.tenant_id,dueDate:e.dueDate??e.due_date,issueDate:e.issueDate??e.issue_date,invoiceNumber:e.invoiceNumber??e.invoice_number,createdAt:e.createdAt??e.created_at})):[],et=Array.isArray(we)?we.map(e=>({...e,tenantId:e.tenantId??e.tenant_id,unitId:e.unitId??e.unit_id})):[],tt=Array.isArray(ve)?ve.map(e=>({...e,fullName:e.fullName??e.full_name})):[],st=Array.isArray(Se)?Se.map(e=>({...e,unitNumber:e.unitNumber??e.unit_number,propertyId:e.propertyId??e.property_id})):[],at=Array.isArray(Ne)?Ne.map(e=>({...e})):[],nt=(Array.isArray(be)?be.map(e=>({...e,invoiceId:e.invoiceId??e.invoice_id,amount:parseFloat(e.amount??0)})):[]).reduce((e,s)=>(s.invoiceId&&(e[s.invoiceId]=(e[s.invoiceId]||0)+(s.amount||0)),e),{}),L=Xe.map(e=>{const s=et.find(p=>p.id===e.leaseId),i=e.tenantId??s?.tenantId,r=i?tt.find(p=>p.id===i):null,d=e.unitId??s?.unitId,n=d?st.find(p=>p.id===d):null,S=e.propertyId??n?.propertyId,_=S?at.find(p=>p.id===S):null,de=Je.filter(p=>p.invoiceId===e.id),$=parseFloat(e.amount??0),T=nt[e.id]||0,U=Math.max(0,$-T),J=U<=0&&$>0?"paid":T>0?"partially_paid":"pending";return{...e,tenant:r?.fullName||"Direct Billing",unit:n?.unitNumber||"N/A",property:_?.name||"N/A",tenantData:r,unitData:n,propertyData:_,leaseData:s,amount:$,paidAmount:T,balance:U,paymentStatus:J,workflowStatus:e.status,charges:de.map(p=>({name:p.description,amount:parseFloat(p.amount)}))}}),y=L.filter(e=>{const s=O.toLowerCase(),i=!O||(e.id||"").toLowerCase().includes(s)||(e.tenant||"").toLowerCase().includes(s)||(e.unit||"").toLowerCase().includes(s)||(e.property||"").toLowerCase().includes(s),r=F==="all"||e.paymentStatus===F;return i&&r}),it=e=>{ae(e),B(!0)},Pe=e=>{ae(e),M(!0)},Ce=e=>{ae(e),G(!0)},Le=async e=>{try{const s=new Tt,i=e.issueDate||e.createdAt||Date.now(),r=new Date(i).toISOString().slice(0,10),d=e.unit?String(e.unit).replace(/\s+/g,"-"):"unit",n=e.invoiceNumber??e.invoice_number??e.id,S=Ze.data||{},_=S.logo_url||"",de=S.company_name||"Company",$=S.company_phone||"",T=S.company_email||"",U=S.company_address||"",J=String(S.payment_options||"").split(`
`).map(h=>h.trim()).filter(Boolean),Te=(Array.isArray(w.data)?w.data:[]).find(h=>h.id===e.propertyId||h.name===e.property),Ee=Te?.accountPrefix??Te?.account_prefix??"",Ae=Ee&&e.unit?`${Ee}${e.unit}`:"";let E=20;if(_)try{const h=await Ye(_),Q=h.includes("image/png")?"PNG":"JPEG";s.addImage(h,Q,20,12,24,18),E=50}catch{E=20}s.setFontSize(14),s.text(de.toUpperCase(),E,20),s.setFontSize(9),U&&s.text(U,E,26),$&&s.text(`Tel: ${$}`,E,31),T&&s.text(`Email: ${T}`,E,36),s.setFontSize(11),s.text(`Invoice #${n}`,150,20),s.setFontSize(9),s.text(`Date: ${new Date(i).toLocaleDateString()}`,150,26),s.text(`Due: ${new Date(e.dueDate).toLocaleDateString()}`,150,31),s.line(20,42,190,42),s.setFontSize(10),s.text("BILL TO",20,52),s.text(String(e.tenant||"Tenant"),20,58),e.tenantData?.email&&s.text(String(e.tenantData.email),20,63),e.tenantData?.phone&&s.text(String(e.tenantData.phone),20,68),s.text("PROPERTY",120,52),s.text(String(e.property||"â€”"),120,58),s.text(`House: ${e.unit||"â€”"}`,120,63),Ae&&s.text(`Account: ${Ae}`,120,68);const ht=e.charges.map((h,Q)=>[String(Q+1),h.name,h.description||"",`KES ${Number(h.amount||0).toLocaleString()}`]);Et(s,{head:[["#","Item","Description","Total"]],body:ht,startY:78,theme:"grid",headStyles:{fillColor:[56,78,84],textColor:255},styles:{fontSize:9}});const z=s.lastAutoTable?.finalY||140,xt=Number(e.paidAmount||0),jt=Number(e.balance||0);s.setFontSize(10),s.text(`Sub - Total: KES ${Number(e.amount||0).toLocaleString()}`,120,z+12),s.text(`Paid: KES ${xt.toLocaleString()}`,120,z+18),s.text(`Balance: KES ${jt.toLocaleString()}`,120,z+24),J.length&&(s.text("Payment Options:",20,z+12),J.forEach((h,Q)=>{s.text(`- ${h}`,20,z+18+Q*5)})),s.save(`${d}-${r}-invoice.pdf`),o({title:"Invoice Downloaded",description:`Invoice ${n} has been downloaded as PDF.`})}catch(s){console.error("Error generating PDF:",s),o({title:"Download Failed",description:"Failed to generate PDF. Please try again.",variant:"destructive"})}},rt=async e=>{ie.mutate(e.id)},lt=async e=>{re.mutate(e.id)},dt=e=>{const s=document.getElementById("edit-invoice-form");if(!s){console.error("ðŸ”§ Frontend: Form not found!");return}const i=s.querySelector('[name="description"]'),r=s.querySelector('[name="amount"]'),d=s.querySelector('[name="dueDate"]'),n={description:i?.value||e.description,amount:String(r?.value||e.amount),dueDate:d?.value||e.dueDate};console.log("ðŸ”§ Frontend: Sending update data:",n),console.log("ðŸ”§ Frontend: Invoice ID:",e.id),ne.mutate({invoiceId:e.id,data:n})},ot=(e,s)=>{k(s?[...g,e]:g.filter(i=>i!==e))},ct=()=>{g.length===y.length?k([]):k(y.map(e=>e.id))},Z=e=>{switch(console.log(`Performing ${e} on invoices:`,g),e){case"approve":Promise.resolve().then(async()=>{const s=y.filter(n=>g.includes(n.id)&&n.status!=="approved"),i=await Promise.allSettled(s.map(n=>K(n.id,"approved"))),r=i.filter(n=>n.status==="fulfilled").length,d=i.length-r;r>0&&o({title:"Invoices Approved",description:`Approved ${r} invoice${r===1?"":"s"} successfully.`}),d>0&&o({title:"Approval Issues",description:`${d} invoice${d===1?"":"s"} failed to approve.`,variant:"destructive"}),f.invalidateQueries({queryKey:["/api/invoices"]})});break;case"send-email":Promise.resolve().then(async()=>{const s=y.filter(n=>g.includes(n.id)),i=await Promise.allSettled(s.map(n=>m("POST",`/api/invoices/${n.id}/send-email`))),r=i.filter(n=>n.status==="fulfilled").length,d=i.length-r;r>0&&(await Promise.allSettled(s.map(n=>K(n.id,"sent"))),o({title:"Emails Sent",description:`Sent ${r} email${r===1?"":"s"} successfully.`})),d>0&&o({title:"Email Issues",description:`${d} email${d===1?"":"s"} failed to send.`,variant:"destructive"}),f.invalidateQueries({queryKey:["/api/invoices"]})});break;case"send-sms":Promise.resolve().then(async()=>{const s=y.filter(n=>g.includes(n.id)),i=await Promise.allSettled(s.map(n=>m("POST",`/api/invoices/${n.id}/send-sms`))),r=i.filter(n=>n.status==="fulfilled").length,d=i.length-r;r>0&&(await Promise.allSettled(s.map(n=>K(n.id,"sent"))),o({title:"SMS Sent",description:`Sent ${r} SMS message${r===1?"":"s"} successfully.`})),d>0&&o({title:"SMS Issues",description:`${d} SMS message${d===1?"":"s"} failed to send.`,variant:"destructive"}),f.invalidateQueries({queryKey:["/api/invoices"]})});break;case"delete":g.forEach(s=>$e(s));break}k([])},$e=e=>{if(V){o({title:"Property Required",description:"Select a property in the header before deleting invoices.",variant:"destructive"});return}q.current[e]&&clearTimeout(q.current[e]);const s=setTimeout(async()=>{await m("DELETE",`/api/invoices/${e}`),delete q.current[e],f.invalidateQueries({queryKey:["/api/invoices"]}),f.invalidateQueries({queryKey:["/api/invoice-items"]}),f.invalidateQueries({queryKey:["/api/stats"]})},5e3);q.current[e]=s,o({title:"Invoice delete scheduled",description:"Invoice will be deleted in 5 seconds.",action:t.jsxs(Lt,{altText:"Undo delete",onClick:()=>{clearTimeout(s),delete q.current[e],o({title:"Delete canceled",description:"The invoice was not deleted."})},children:[t.jsx(At,{className:"h-4 w-4 mr-1"}),"Undo"]})})},le=e=>{switch(e){case"paid":return t.jsx(A,{variant:"default",className:"bg-green-100 text-green-800",children:"Paid"});case"partially_paid":return t.jsx(A,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"Partially Paid"});default:return t.jsx(A,{variant:"outline",className:"bg-amber-100 text-amber-800",children:"Pending"})}},ut=e=>{switch(e){case"draft":return t.jsx(A,{variant:"secondary",children:"Draft"});case"approved":return t.jsx(A,{variant:"default",children:"Approved"});case"sent":return t.jsx(A,{variant:"outline",children:"Sent"});default:return null}},mt={all:L.length,pending:L.filter(e=>e.paymentStatus==="pending").length,partially_paid:L.filter(e=>e.paymentStatus==="partially_paid").length,paid:L.filter(e=>e.paymentStatus==="paid").length},pt=e=>e==="all"?"Total":e==="partially_paid"?"Partially Paid":e.charAt(0).toUpperCase()+e.slice(1);return t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold","data-testid":"invoices-title",children:"Invoices"}),t.jsx("p",{className:"text-muted-foreground",children:"Review, approve and send invoices to tenants"})]}),g.length>0&&t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Z("approve"),"data-testid":"button-bulk-approve",children:[t.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Approve (",g.length,")"]}),t.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Z("send-email"),"data-testid":"button-bulk-email",children:[t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Email"]}),t.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Z("send-sms"),"data-testid":"button-bulk-sms",children:[t.jsx(qe,{className:"h-4 w-4 mr-2"}),"SMS"]}),t.jsxs(u,{variant:"destructive",size:"sm",onClick:()=>Z("delete"),"data-testid":"button-bulk-delete",children:[t.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(mt).map(([e,s],i)=>{const r=$t(i);return t.jsx(X,{className:`cursor-pointer hover-elevate border ${We[e]??""} ${F===e?"ring-2 ring-primary":""}`,onClick:()=>ge(e),children:t.jsxs(ee,{className:"p-4 text-center",children:[t.jsx("div",{className:`text-2xl font-bold ${r.accentText}`,children:s}),t.jsx("div",{className:"text-sm text-muted-foreground",children:pt(e)})]})},e)})}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx(ce,{placeholder:"Search invoices...",value:O,onChange:e=>Me(e.target.value),className:"max-w-sm","data-testid":"input-search-invoices"})}),t.jsxs(ft,{value:F,onValueChange:ge,children:[t.jsx(vt,{className:"w-48","data-testid":"select-status-filter",children:t.jsx(St,{placeholder:"Filter by status"})}),t.jsxs(Nt,{children:[t.jsx(te,{value:"all",children:"All Statuses"}),t.jsx(te,{value:"pending",children:"Pending"}),t.jsx(te,{value:"partially_paid",children:"Partially Paid"}),t.jsx(te,{value:"paid",children:"Paid"})]})]})]}),t.jsxs(X,{children:[t.jsxs(wt,{children:[t.jsxs(bt,{className:"flex items-center justify-between",children:["Invoices List",t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(_e,{checked:g.length===y.length&&y.length>0,onCheckedChange:ct,"data-testid":"checkbox-select-all"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"Select All"})]})]}),t.jsxs(Dt,{children:["Showing ",y.length," of ",L.length," invoices"]})]}),t.jsxs(ee,{children:[t.jsxs(Ue,{children:[t.jsx(ze,{children:t.jsxs(se,{children:[t.jsx(x,{className:"w-12"}),t.jsx(x,{children:"Invoice ID"}),t.jsx(x,{children:"Tenant"}),t.jsx(x,{children:"Unit"}),t.jsx(x,{children:"Property"}),t.jsx(x,{children:"Amount"}),t.jsx(x,{children:"Balance"}),t.jsx(x,{children:"Due Date"}),t.jsx(x,{children:"Status"}),t.jsx(x,{children:"Actions"}),t.jsx(x,{children:"Note"})]})}),t.jsx(Qe,{children:y.map(e=>t.jsxs(se,{className:"hover-elevate",children:[t.jsx(j,{children:t.jsx(_e,{checked:g.includes(e.id),onCheckedChange:s=>ot(e.id,!!s),"data-testid":`checkbox-${e.id}`})}),t.jsx(j,{className:"font-mono text-sm",children:Y(e.id)}),t.jsxs(j,{children:[t.jsx("div",{className:"font-medium",children:e.tenant}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.tenantData?.phone||"â€”"})]}),t.jsx(j,{children:e.unit}),t.jsx(j,{className:"text-sm text-muted-foreground",children:e.property}),t.jsxs(j,{className:"font-mono",children:["KSh ",e.amount.toLocaleString()]}),t.jsxs(j,{className:"font-mono",children:["KSh ",e.balance.toLocaleString()]}),t.jsx(j,{children:e.dueDate&&!Number.isNaN(new Date(e.dueDate).getTime())?new Date(e.dueDate).toLocaleDateString():"â€”"}),t.jsx(j,{children:le(e.paymentStatus)}),t.jsx(j,{children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>it(e),"data-testid":`button-view-${e.id}`,children:t.jsx(It,{className:"h-4 w-4"})}),e.status==="draft"&&t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Pe(e),"data-testid":`button-edit-${e.id}`,children:t.jsx(Re,{className:"h-4 w-4"})}),(e.status==="approved"||e.status==="draft")&&t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Ce(e),"data-testid":`button-send-${e.id}`,children:t.jsx(Oe,{className:"h-4 w-4"})}),t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Le(e),"data-testid":`button-download-${e.id}`,children:t.jsx(Be,{className:"h-4 w-4"})}),t.jsx(u,{variant:"ghost",size:"sm",onClick:()=>$e(e.id),"data-testid":`button-delete-${e.id}`,children:t.jsx(Ke,{className:"h-4 w-4 text-destructive"})})]})}),t.jsx(j,{children:ut(e.workflowStatus)})]},e.id))})]}),y.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Pt,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"No invoices found"}),t.jsx("p",{className:"text-muted-foreground",children:O||F!=="all"?"Try adjusting your search or filter criteria":"Create your first invoice to get started"})]})]})]}),t.jsx(ue,{open:Ge,onOpenChange:B,children:t.jsxs(me,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[t.jsxs(pe,{children:[t.jsx(he,{children:"Invoice Details"}),t.jsxs(xe,{children:["Complete details for invoice ",Y(a?.id)]})]}),a&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Invoice Information"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Invoice ID:"})," ",Y(a.id)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Date:"})," ",new Date(a.createdAt||Date.now()).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Due Date:"})," ",new Date(a.dueDate).toLocaleDateString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Status:"})," ",le(a.paymentStatus)]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Tenant Information"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Name:"})," ",a.tenant]}),a.tenantData?.email&&t.jsxs("div",{children:[t.jsx("strong",{children:"Email:"})," ",a.tenantData.email]}),a.tenantData?.phone&&t.jsxs("div",{children:[t.jsx("strong",{children:"Phone:"})," ",a.tenantData.phone]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Property Information"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Property:"})," ",a.property]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Unit:"})," ",a.unit]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Charges"}),t.jsxs(Ue,{children:[t.jsx(ze,{children:t.jsxs(se,{children:[t.jsx(x,{children:"Description"}),t.jsx(x,{className:"text-right",children:"Amount"})]})}),t.jsx(Qe,{children:a.charges.map((e,s)=>t.jsxs(se,{children:[t.jsx(j,{children:e.name}),t.jsxs(j,{className:"text-right font-mono",children:["KSh ",e.amount.toLocaleString()]})]},s))})]}),t.jsxs("div",{className:"text-right mt-4 text-lg font-semibold",children:["Total: KSh ",a.amount.toLocaleString()]})]}),t.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[t.jsxs(u,{onClick:()=>Le(a),children:[t.jsx(Be,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(a.status==="approved"||a.status==="draft")&&t.jsxs(u,{variant:"outline",onClick:()=>{B(!1),Ce(a)},children:[t.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Send Invoice"]}),a.status==="draft"&&t.jsxs(u,{variant:"outline",onClick:()=>{B(!1),Pe(a)},children:[t.jsx(Re,{className:"h-4 w-4 mr-2"}),"Edit Invoice"]})]})]})]})}),t.jsx(ue,{open:He,onOpenChange:G,children:t.jsxs(me,{children:[t.jsxs(pe,{children:[t.jsx(he,{children:"Send Invoice"}),t.jsxs(xe,{children:["Send invoice ",a?.id," to ",a?.tenant]})]}),a&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Invoice will be sent to:",t.jsxs("div",{className:"mt-2 p-3 bg-muted rounded",children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Tenant:"})," ",a.tenant]}),a.tenantData?.email&&t.jsxs("div",{children:[t.jsx("strong",{children:"Email:"})," ",a.tenantData.email]}),a.tenantData?.phone&&t.jsxs("div",{children:[t.jsx("strong",{children:"Phone:"})," ",a.tenantData.phone]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Amount:"})," KSh ",a.amount.toLocaleString()]})]})]}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[t.jsxs(u,{onClick:()=>rt(a),className:"flex-1",disabled:ie.isPending,children:[ie.isPending?t.jsx(je,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(ke,{className:"h-4 w-4 mr-2"}),"Send via Email"]}),t.jsxs(u,{onClick:()=>lt(a),variant:"outline",className:"flex-1",disabled:re.isPending,children:[re.isPending?t.jsx(je,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(qe,{className:"h-4 w-4 mr-2"}),"Send via SMS"]})]})]})]})}),t.jsx(ue,{open:Ve,onOpenChange:M,children:t.jsxs(me,{className:"max-w-2xl",children:[t.jsxs(pe,{children:[t.jsx(he,{children:"Edit Invoice"}),t.jsxs(xe,{children:["Edit invoice ",Y(a?.id)]})]}),a&&t.jsxs("form",{id:"edit-invoice-form",className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(R,{htmlFor:"description",children:"Description"}),t.jsx(Ct,{id:"description",name:"description",defaultValue:a.description,className:"min-h-20"})]}),t.jsxs("div",{children:[t.jsx(R,{htmlFor:"amount",children:"Amount (KSh)"}),t.jsx(ce,{id:"amount",name:"amount",type:"number",step:"0.01",defaultValue:a.amount})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx(R,{htmlFor:"dueDate",children:"Due Date"}),t.jsx(ce,{id:"dueDate",name:"dueDate",type:"date",defaultValue:a.dueDate})]}),t.jsxs("div",{children:[t.jsx(R,{children:"Status"}),t.jsx("div",{className:"mt-2",children:le(a.paymentStatus)})]})]}),t.jsxs("div",{children:[t.jsx(R,{children:"Current Charges"}),t.jsxs("div",{className:"mt-2 p-3 bg-muted rounded text-sm",children:[a.charges.map((e,s)=>t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:e.name}),t.jsxs("span",{children:["KSh ",e.amount.toLocaleString()]})]},s)),t.jsxs("div",{className:"border-t pt-2 mt-2 font-semibold flex justify-between",children:[t.jsx("span",{children:"Total"}),t.jsxs("span",{children:["KSh ",a.amount.toLocaleString()]})]})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"To modify charges, use the invoice items management section."})]}),t.jsxs("div",{className:"flex gap-2 pt-4",children:[t.jsxs(u,{type:"button",onClick:()=>dt(a),disabled:ne.isPending,children:[ne.isPending?t.jsx(je,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Save Changes"]}),t.jsx(u,{type:"button",variant:"outline",onClick:()=>M(!1),children:"Cancel"})]})]})]})})]})}export{zt as Invoices};

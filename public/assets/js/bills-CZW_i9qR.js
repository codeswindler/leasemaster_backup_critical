import{a as J,b as X,d as Z,f as k,j as e,D as _,aj as ee,x as n,P as se,g as te,h as ae,i as re,k as le,K as l,I as o,S as x,r as j,s as p,v as g,w as t,a3 as ne,C as S,G as w,z as F,A as T,E as L,aa as ie,ab as de,ac as A,ad as i,ae as ce,af as d,H as oe,al as he,aq as v,q as E,y as f,ah as ue,T as me,aA as xe,a0 as je}from"./index-D3-Phv8z.js";import{r as c}from"./vendor-BBpupLJz.js";function Ce(){const{toast:h}=J(),[u,I]=c.useState(""),[y,C]=c.useState("all"),[O,N]=c.useState(!1),{selectedPropertyId:q}=X(),m=!q,[pe,K]=c.useState(!1),[ge,M]=c.useState(!1),[ve,D]=c.useState(!1),[fe,b]=c.useState(null),[ye,P]=c.useState({billId:"",amount:"",method:"mpesa",reference:""}),{data:a=[],isLoading:Ne,error:be}=Z({queryKey:["/api/bills"],queryFn:()=>je("GET","/api/bills")});k({mutationFn:async s=>{if(m)throw new Error("Select a property in the header to record bill payments.");return Promise.resolve({id:`PAY-${Date.now()}`,billId:s.billId,amount:s.amount,method:s.method,reference:s.reference,status:"completed",timestamp:new Date().toISOString()})},onSuccess:s=>{h({title:"Payment Successful",description:`Payment of KSh ${s.amount.toLocaleString()} has been processed successfully.`}),D(!1),P({billId:"",amount:"",method:"mpesa",reference:""}),E.invalidateQueries({queryKey:["/api/bills"]})},onError:s=>{h({title:"Payment Failed",description:s.message||"Failed to process payment",variant:"destructive"})}});const V=k({mutationFn:async({billId:s,status:r})=>{if(m)throw new Error("Select a property in the header to update bills.");return Promise.resolve({id:s,status:r})},onSuccess:s=>{h({title:"Bill Updated",description:`Bill status updated to ${s.status}`}),E.invalidateQueries({queryKey:["/api/bills"]})},onError:s=>{h({title:"Update Failed",description:s.message||"Failed to update bill status",variant:"destructive"})}}),$=s=>{b(s),K(!0)},R=s=>{b(s),M(!0)},z=s=>{b(s),P({billId:s.id,amount:s.amount.toString(),method:"mpesa",reference:""}),D(!0)},H=s=>{V.mutate({billId:s.id,status:"pending"})},B=a.filter(s=>{const r=s.id.toLowerCase().includes(u.toLowerCase())||s.vendor.toLowerCase().includes(u.toLowerCase())||s.property.toLowerCase().includes(u.toLowerCase())||s.category.toLowerCase().includes(u.toLowerCase()),Y=y==="all"||s.status===y;return r&&Y}),Q=s=>{switch(s){case"draft":return e.jsx(f,{variant:"secondary",children:"Draft"});case"pending":return e.jsx(f,{variant:"outline",children:"Pending"});case"paid":return e.jsx(f,{variant:"default",className:"bg-green-100 text-green-800",children:"Paid"});case"overdue":return e.jsx(f,{variant:"destructive",children:"Overdue"});default:return e.jsx(f,{variant:"outline",children:"Unknown"})}},U=s=>{switch(s){case"paid":return e.jsx(v,{className:"h-4 w-4 text-green-500"});case"pending":return e.jsx(xe,{className:"h-4 w-4 text-blue-500"});case"overdue":return e.jsx(me,{className:"h-4 w-4 text-red-500"});default:return e.jsx(ue,{className:"h-4 w-4 text-gray-500"})}},G=()=>{if(m){h({title:"Property Required",description:"Select a property in the header to add bills.",variant:"destructive"});return}console.log("Add bill form submitted"),N(!1)},W={all:a.length,draft:a.filter(s=>s.status==="draft").length,pending:a.filter(s=>s.status==="pending").length,paid:a.filter(s=>s.status==="paid").length,overdue:a.filter(s=>s.status==="overdue").length};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold","data-testid":"bills-title",children:"Bills"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage property expenses and vendor bills"})]}),e.jsxs(_,{open:O,onOpenChange:N,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(n,{"data-testid":"button-add-bill",disabled:m,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Add Bill"]})}),e.jsxs(te,{className:"sm:max-w-[500px]",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Add New Bill"}),e.jsx(le,{children:"Enter bill details to track property expenses."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"vendor",children:"Vendor Name"}),e.jsx(o,{id:"vendor",placeholder:"e.g., Kenya Power & Lighting","data-testid":"input-vendor"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"property",children:"Property"}),e.jsxs(x,{children:[e.jsx(j,{"data-testid":"select-property",children:e.jsx(p,{placeholder:"Select property"})}),e.jsxs(g,{children:[e.jsx(t,{value:"all",children:"All Properties"}),e.jsx(t,{value:"bigrock",children:"BigRock Apartments"}),e.jsx(t,{value:"riverside",children:"Riverside Complex"}),e.jsx(t,{value:"garden",children:"Garden View Estates"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"category",children:"Category"}),e.jsxs(x,{children:[e.jsx(j,{"data-testid":"select-category",children:e.jsx(p,{placeholder:"Select category"})}),e.jsxs(g,{children:[e.jsx(t,{value:"electricity",children:"Electricity"}),e.jsx(t,{value:"water",children:"Water"}),e.jsx(t,{value:"security",children:"Security"}),e.jsx(t,{value:"maintenance",children:"Maintenance"}),e.jsx(t,{value:"cleaning",children:"Cleaning"}),e.jsx(t,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"amount",children:"Amount"}),e.jsx(o,{id:"amount",type:"number",placeholder:"Enter bill amount","data-testid":"input-amount"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"due-date",children:"Due Date"}),e.jsx(o,{id:"due-date",type:"date","data-testid":"input-due-date"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"account-number",children:"Account Number"}),e.jsx(o,{id:"account-number",placeholder:"Vendor account number","data-testid":"input-account-number"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(ne,{id:"description",placeholder:"Bill description or notes",rows:3,"data-testid":"textarea-description"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(n,{onClick:G,disabled:m,"data-testid":"button-submit-bill",children:"Add Bill"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:Object.entries(W).map(([s,r])=>e.jsx(S,{className:`cursor-pointer hover-elevate ${y===s?"ring-2 ring-primary":""}`,onClick:()=>C(s),children:e.jsxs(w,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),e.jsx("div",{className:"text-sm text-muted-foreground capitalize",children:s==="all"?"Total":s})]})},s))}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(o,{placeholder:"Search bills...",value:u,onChange:s=>I(s.target.value),className:"max-w-sm","data-testid":"input-search-bills"})}),e.jsxs(x,{value:y,onValueChange:C,children:[e.jsx(j,{className:"w-48","data-testid":"select-status-filter",children:e.jsx(p,{placeholder:"Filter by status"})}),e.jsxs(g,{children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"draft",children:"Draft"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"paid",children:"Paid"}),e.jsx(t,{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs(S,{children:[e.jsxs(F,{children:[e.jsx(T,{children:"Bills List"}),e.jsxs(L,{children:["Showing ",B.length," of ",a.length," bills"]})]}),e.jsx(w,{children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs(A,{children:[e.jsx(i,{children:"Bill ID"}),e.jsx(i,{children:"Vendor"}),e.jsx(i,{children:"Property"}),e.jsx(i,{children:"Category"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Due Date"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(ce,{children:B.map(s=>e.jsxs(A,{className:"hover-elevate",children:[e.jsx(d,{className:"font-mono text-sm",children:s.id}),e.jsx(d,{className:"font-medium",children:s.vendor}),e.jsx(d,{children:s.property}),e.jsx(d,{children:s.category}),e.jsxs(d,{className:"font-mono",children:["KSh ",s.amount.toLocaleString()]}),e.jsx(d,{children:new Date(s.dueDate).toLocaleDateString()}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[U(s.status),Q(s.status)]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm","data-testid":`button-view-${s.id}`,onClick:()=>$(s),children:e.jsx(oe,{className:"h-4 w-4"})}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"ghost",size:"sm","data-testid":`button-edit-${s.id}`,onClick:()=>R(s),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"sm","data-testid":`button-confirm-${s.id}`,onClick:()=>H(s),children:e.jsx(v,{className:"h-4 w-4"})})]}),(s.status==="pending"||s.status==="overdue")&&e.jsx(n,{variant:"ghost",size:"sm","data-testid":`button-pay-${s.id}`,onClick:()=>z(s),children:e.jsx(v,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsxs(S,{children:[e.jsxs(F,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5 text-green-500"}),"Make Payment"]}),e.jsx(L,{children:"Settle outstanding bills and expenses"})]}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Payment"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"bill-select",children:"Select Bill"}),e.jsxs(x,{children:[e.jsx(j,{id:"bill-select",children:e.jsx(p,{placeholder:"Choose a bill to pay"})}),e.jsx(g,{children:a.filter(s=>s.status==="pending").map(s=>e.jsxs(t,{value:s.id,children:[s.id," - ",s.vendor," - KSh ",s.amount.toLocaleString()]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment-method",children:"Payment Method"}),e.jsxs(x,{children:[e.jsx(j,{id:"payment-method",children:e.jsx(p,{placeholder:"Select payment method"})}),e.jsxs(g,{children:[e.jsx(t,{value:"mpesa",children:"M-Pesa"}),e.jsx(t,{value:"bank-transfer",children:"Bank Transfer"}),e.jsx(t,{value:"cash",children:"Cash"}),e.jsx(t,{value:"cheque",children:"Cheque"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment-reference",children:"Payment Reference"}),e.jsx(o,{id:"payment-reference",placeholder:"Enter payment reference or transaction ID"})]}),e.jsxs(n,{className:"w-full","data-testid":"button-make-payment",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Make Payment"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Payment Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Outstanding Bills"}),e.jsxs("span",{className:"font-mono font-semibold",children:["KSh ",a.filter(s=>s.status==="pending").reduce((s,r)=>s+r.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overdue Bills"}),e.jsxs("span",{className:"font-mono font-semibold text-destructive",children:["KSh ",a.filter(s=>s.status==="overdue").reduce((s,r)=>s+r.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Paid This Month"}),e.jsxs("span",{className:"font-mono font-semibold text-green-600 dark:text-green-400",children:["KSh ",a.filter(s=>s.status==="paid").reduce((s,r)=>s+r.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Payment Tips"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsx("li",{children:"• Always verify payment references"}),e.jsx("li",{children:"• Keep receipts for accounting"}),e.jsx("li",{children:"• Update bill status after payment"})]})]})]})]})})]})]})}export{Ce as Bills};
